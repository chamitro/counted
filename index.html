<!DOCTYPE html>
<html lang="en">
<head>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-16DYQBCFQS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-16DYQBCFQS');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>COUNTED</title>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;600;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#08080c;--surface:#111118;--surface2:#1a1a24;--border:#252530;
    --text:#e8e8f0;--text2:#7a7a90;--accent:#6C5CE7;--accent2:#a29bfe;
    --pink:#fd79a8;--green:#00b894;--orange:#fdcb6e;--red:#d63031;--blue:#0984e3;--cyan:#00cec9;
  }
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{font-family:'Bricolage Grotesque',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
  .header{text-align:center;padding:44px 20px 28px;background:linear-gradient(180deg,#12101f,var(--bg))}
  .header-tag{font-family:'Space Mono',monospace;font-size:10px;color:var(--accent2);letter-spacing:5px;margin-bottom:10px}
  .header h1{font-size:44px;font-weight:800;color:#fff;letter-spacing:-1px;margin-bottom:8px}
  .header h1 span{color:var(--accent)}
  .header p{font-size:15px;color:var(--text2);font-weight:400}
  .content{max-width:600px;margin:0 auto;padding:0 16px 60px}
  .form-section{padding:24px 0}
  .form-group{margin-bottom:16px}
  .form-label{display:block;font-family:'Space Mono',monospace;font-size:11px;color:var(--accent2);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
  .form-input{width:100%;padding:14px 16px;background:var(--surface);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:16px;font-family:'Bricolage Grotesque',sans-serif;outline:none;transition:border-color .2s;-webkit-appearance:none}
  .form-input:focus{border-color:var(--accent)}
  .form-input::placeholder{color:var(--text2)}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  select.form-input{cursor:pointer}
  .submit-btn{display:block;width:100%;padding:18px;background:linear-gradient(135deg,var(--accent),#8b5cf6);color:#fff;border:none;border-radius:14px;font-size:18px;font-weight:800;font-family:inherit;cursor:pointer;margin-top:24px;transition:transform .15s}
  .submit-btn:active{transform:scale(.97)}
  .submit-btn:disabled{opacity:0.5;cursor:not-allowed}
  .category{margin-bottom:28px}
  .cat-header{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--border)}
  .cat-icon{font-size:22px}
  .cat-title{font-family:'Space Mono',monospace;font-size:12px;color:var(--accent2);letter-spacing:3px;text-transform:uppercase}
  .fact-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:8px}
  .fact-number{font-family:'Space Mono',monospace;font-size:26px;font-weight:700;line-height:1.2;margin-bottom:4px}
  .fact-text{font-size:14px;color:var(--text2);line-height:1.5}
  .fact-text strong{color:var(--text)}
  .fact-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .fact-card.small{padding:12px}
  .fact-card.small .fact-number{font-size:20px}
  .fact-card.small .fact-text{font-size:12px}
  .color-accent{color:var(--accent2)}.color-pink{color:var(--pink)}.color-green{color:var(--green)}
  .color-orange{color:var(--orange)}.color-red{color:var(--red)}.color-blue{color:var(--blue)}.color-cyan{color:var(--cyan)}
  .source-tag{font-family:'Space Mono',monospace;font-size:9px;color:var(--text2);opacity:0.5;margin-top:6px;letter-spacing:1px}
  .rarity-meter{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:8px;text-align:center}
  .rarity-bar-bg{width:100%;height:12px;background:var(--surface2);border-radius:6px;margin:16px 0 8px;overflow:hidden}
  .rarity-bar-fill{height:100%;border-radius:6px;background:linear-gradient(90deg,var(--accent),var(--pink),var(--orange));transition:width 1s ease}
  .rarity-big{font-family:'Space Mono',monospace;font-size:36px;font-weight:700;color:#fff}
  .rarity-label{font-size:13px;color:var(--text2);margin-top:4px}
  .dna-card{background:linear-gradient(135deg,#0d1117,#111128);border:1px solid var(--accent);border-radius:16px;padding:20px;margin-bottom:8px;position:relative;overflow:hidden}
  .dna-card::before{content:'ğŸ§¬';position:absolute;top:-10px;right:-10px;font-size:80px;opacity:.07}
  .share-card{background:linear-gradient(135deg,#1a1030,#0a1828);border:1px solid var(--accent);border-radius:20px;padding:28px 24px;text-align:center;margin:32px 0}
  .share-name{font-size:28px;font-weight:800;color:#fff;margin-bottom:4px}
  .share-sub{font-family:'Space Mono',monospace;font-size:12px;color:var(--accent2);letter-spacing:2px;margin-bottom:20px}
  .share-stats{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:20px}
  .share-stat{background:rgba(108,92,231,.15);border-radius:10px;padding:10px 14px;text-align:center}
  .share-stat-num{font-family:'Space Mono',monospace;font-size:16px;font-weight:700;color:#fff}
  .share-stat-label{font-size:10px;color:var(--text2);letter-spacing:1px;text-transform:uppercase;margin-top:2px}
  .share-quote{font-size:15px;color:var(--text2);font-style:italic;line-height:1.6}
  .reset-btn{display:block;width:100%;max-width:340px;margin:0 auto;padding:18px;background:var(--accent);color:#fff;border:none;border-radius:14px;font-size:17px;font-weight:700;font-family:inherit;cursor:pointer}
  .hidden{display:none!important}
  .form-error{display:none;background:#1a1111;border:1px solid #4a2222;border-radius:10px;padding:14px;margin-top:16px;color:#ff6666;font-size:14px;text-align:center}
  .loading-overlay{text-align:center;padding:60px 20px}
  .loading-text{font-family:'Space Mono',monospace;font-size:14px;color:var(--accent2);letter-spacing:2px;margin-bottom:16px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 16px}
  .loading-step{font-size:13px;color:var(--text2);margin-top:8px}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
  .anim{animation:fadeUp .4s ease forwards;opacity:0}
</style>
</head>
<body>

<div id="screen-form">
  <div class="header">
    <div class="header-tag">YOUR LIFE IN</div>
    <h1>COUNT<span>ED</span></h1>
    <p>Enter your details. Get mind-blowing facts.</p>
  </div>
  <div class="content"><div class="form-section">
    <div class="form-group"><label class="form-label">Your Name</label><input class="form-input" id="f-name" type="text" placeholder="e.g. Harry" autocomplete="given-name"></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Age</label><input class="form-input" id="f-age" type="number" placeholder="32" min="1" max="120"></div>
      <div class="form-group"><label class="form-label">Gender</label><select class="form-input" id="f-gender"><option value="male">Male</option><option value="female">Female</option></select></div>
    </div>
    <div class="form-group"><label class="form-label">Birthday</label>
      <div style="display:grid;grid-template-columns:1fr 2fr 1.2fr;gap:8px">
        <select class="form-input" id="f-bd-day"><option value="">Day</option></select>
        <select class="form-input" id="f-bd-month">
          <option value="">Month</option>
          <option value="01">January</option><option value="02">February</option><option value="03">March</option>
          <option value="04">April</option><option value="05">May</option><option value="06">June</option>
          <option value="07">July</option><option value="08">August</option><option value="09">September</option>
          <option value="10">October</option><option value="11">November</option><option value="12">December</option>
        </select>
        <input class="form-input" id="f-bd-year" type="number" placeholder="1993" min="1900" max="2025" inputmode="numeric">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">City</label><input class="form-input" id="f-city" type="text" placeholder="e.g. Athens" autocomplete="address-level2"></div>
      <div class="form-group"><label class="form-label">Country</label><input class="form-input" id="f-country" type="text" placeholder="e.g. Greece" autocomplete="country-name"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Height (cm)</label><input class="form-input" id="f-height" type="number" placeholder="178" min="50" max="250"></div>
      <div class="form-group"><label class="form-label">Weight (kg)</label><input class="form-input" id="f-weight" type="number" placeholder="75" min="20" max="300"></div>
    </div>
    <div class="form-group"><label class="form-label">Job / Profession</label>
      <select class="form-input" id="f-job">
        <option value="">â€” Select your profession â€”</option>
        <option value="doctor">ğŸ¥ Doctor / Physician</option>
        <option value="nurse">ğŸ¥ Nurse / Midwife</option>
        <option value="dentist">ğŸ¥ Dentist / Pharmacist</option>
        <option value="therapist">ğŸ¥ Therapist / Psychologist</option>
        <option value="veterinarian">ğŸ¥ Veterinarian</option>
        <option value="researcher">ğŸ”¬ Researcher / Scientist</option>
        <option value="professor">ğŸ“ Professor / Lecturer</option>
        <option value="teacher">ğŸ“ Teacher / Tutor</option>
        <option value="student">ğŸ“š Student / Intern</option>
        <option value="software_engineer">ğŸ’» Software Engineer / Developer</option>
        <option value="data_scientist">ğŸ’» Data Scientist / ML Engineer</option>
        <option value="it_support">ğŸ’» IT Support / Sysadmin</option>
        <option value="designer">ğŸ¨ Designer (UI/UX/Graphic)</option>
        <option value="photographer">ğŸ¨ Photographer / Videographer</option>
        <option value="architect">ğŸ¨ Architect</option>
        <option value="lawyer">âš–ï¸ Lawyer / Attorney</option>
        <option value="judge">âš–ï¸ Judge / Paralegal</option>
        <option value="accountant">ğŸ“Š Accountant / Auditor</option>
        <option value="banker">ğŸ“Š Banker / Financial Analyst</option>
        <option value="trader">ğŸ“Š Trader / Investment Manager</option>
        <option value="manager">ğŸ‘” Manager / Director</option>
        <option value="executive">ğŸ‘” Executive (CEO/CTO/VP)</option>
        <option value="consultant">ğŸ‘” Consultant</option>
        <option value="hr">ğŸ‘” HR / Recruiter</option>
        <option value="marketer">ğŸ“¢ Marketing / Advertising</option>
        <option value="sales">ğŸ›’ Sales / Real Estate Agent</option>
        <option value="retail">ğŸ›’ Retail / Cashier</option>
        <option value="journalist">âœï¸ Journalist / Writer</option>
        <option value="editor">âœï¸ Editor / Content Creator</option>
        <option value="chef">ğŸ‘¨â€ğŸ³ Chef / Cook</option>
        <option value="barista">ğŸ‘¨â€ğŸ³ Barista / Bartender</option>
        <option value="waiter">ğŸ‘¨â€ğŸ³ Waiter / Hospitality</option>
        <option value="hotel">ğŸ‘¨â€ğŸ³ Hotel / Tourism</option>
        <option value="construction">ğŸ”¨ Construction Worker</option>
        <option value="electrician">ğŸ”¨ Electrician / Plumber</option>
        <option value="mechanic">ğŸ”¨ Mechanic / Technician</option>
        <option value="carpenter">ğŸ”¨ Carpenter / Welder</option>
        <option value="driver">ğŸš› Driver / Trucker</option>
        <option value="pilot">ğŸš› Pilot / Captain</option>
        <option value="delivery">ğŸš› Delivery / Courier</option>
        <option value="musician">ğŸµ Musician / DJ</option>
        <option value="actor">ğŸ­ Actor / Performer</option>
        <option value="athlete">âš½ Athlete / Sports Coach</option>
        <option value="fitness">âš½ Fitness Trainer / Yoga</option>
        <option value="farmer">ğŸŒ¾ Farmer / Agriculture</option>
        <option value="police">ğŸ›¡ï¸ Police / Detective</option>
        <option value="military">ğŸ›¡ï¸ Military / Security</option>
        <option value="firefighter">ğŸ›¡ï¸ Firefighter / Paramedic</option>
        <option value="social_worker">ğŸ¤ Social Worker / NGO</option>
        <option value="civil_servant">ğŸ›ï¸ Civil Servant / Government</option>
        <option value="entrepreneur">ğŸš€ Entrepreneur / Startup Founder</option>
        <option value="freelancer">ğŸš€ Freelancer / Self-employed</option>
        <option value="homemaker">ğŸ  Homemaker / Caregiver</option>
        <option value="retired">ğŸŒ… Retired</option>
        <option value="other">ğŸ’¼ Other</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Work Hours / Day</label>
        <input class="form-input" id="f-workhrs" type="number" placeholder="8" min="0" max="16" value="8" step="0.5">
      </div>
      <div class="form-group"><label class="form-label">Homemade Meals / Week</label>
        <input class="form-input" id="f-homemeals" type="number" placeholder="7" min="0" max="21" value="7">
      </div>
    </div>
    <div style="padding:12px 0 4px;border-top:1px solid var(--border);margin-top:12px"><span style="font-family:'Space Mono',monospace;font-size:10px;color:var(--accent2);letter-spacing:3px;text-transform:uppercase">FAMILY</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Mother's Age <span style="font-size:10px;color:var(--text2)">(or age at passing)</span></label><input class="form-input" id="f-mom" type="number" placeholder="58" min="15" max="120" inputmode="numeric"></div>
      <div class="form-group"><label class="form-label">Father's Age <span style="font-size:10px;color:var(--text2)">(or age at passing)</span></label><input class="form-input" id="f-dad" type="number" placeholder="60" min="15" max="120" inputmode="numeric"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Mother</label>
        <select class="form-input" id="f-mom-alive">
          <option value="alive">Alive ğŸ’š</option>
          <option value="passed">Passed away ğŸ•Šï¸</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Father</label>
        <select class="form-input" id="f-dad-alive">
          <option value="alive">Alive ğŸ’š</option>
          <option value="passed">Passed away ğŸ•Šï¸</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Parents</label>
        <select class="form-input" id="f-parents">
          <option value="together">Together ğŸ’‘</option>
          <option value="divorced">Divorced / Separated</option>
          <option value="single_mom">Raised by mother only</option>
          <option value="single_dad">Raised by father only</option>
          <option value="other_guardian">Other guardian</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Number of Siblings</label><input class="form-input" id="f-siblings" type="number" placeholder="1" min="0" max="10" value="0" onchange="updateSiblingInputs()" oninput="updateSiblingInputs()"></div>
    </div>
    <div id="sibling-ages-container"></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Blood Type</label>
        <select class="form-input" id="f-blood">
          <option value="">â€” Select â€”</option>
          <option value="O+">O+</option><option value="O-">Oâˆ’</option>
          <option value="A+">A+</option><option value="A-">Aâˆ’</option>
          <option value="B+">B+</option><option value="B-">Bâˆ’</option>
          <option value="AB+">AB+</option><option value="AB-">ABâˆ’</option>
          <option value="unknown">Don't know</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Dominant Hand</label>
        <select class="form-input" id="f-hand">
          <option value="right">Right âœ‹</option>
          <option value="left">Left ğŸ¤š</option>
          <option value="ambidextrous">Both ğŸ™Œ</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Eye Color</label>
        <select class="form-input" id="f-eyes">
          <option value="brown">ğŸŸ¤ Brown</option>
          <option value="blue">ğŸ”µ Blue</option>
          <option value="green">ğŸŸ¢ Green</option>
          <option value="hazel">ğŸŸ¡ Hazel</option>
          <option value="gray">âšª Gray</option>
          <option value="amber">ğŸŸ  Amber</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Sleep (hrs/night)</label>
        <input class="form-input" id="f-sleep" type="number" placeholder="7" min="2" max="14" step="0.5" value="7">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Languages Spoken</label>
        <input class="form-input" id="f-languages" type="number" placeholder="2" min="1" max="20" value="1">
      </div>
      <div class="form-group"><label class="form-label">Glasses / Contacts?</label>
        <select class="form-input" id="f-glasses">
          <option value="no">No ğŸ‘ï¸</option>
          <option value="yes">Yes ğŸ‘“</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Daily Coffee â˜•</label>
        <input class="form-input" id="f-coffee" type="number" placeholder="2" min="0" max="20" value="2">
      </div>
      <div class="form-group"><label class="form-label">Pets Owned</label>
        <input class="form-input" id="f-pets" type="number" placeholder="1" min="0" max="50" value="0">
      </div>
    </div>
    <div style="padding:12px 0 4px;border-top:1px solid var(--border);margin-top:12px"><span style="font-family:'Space Mono',monospace;font-size:10px;color:var(--accent2);letter-spacing:3px;text-transform:uppercase">LIFESTYLE</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Relationship</label>
        <select class="form-input" id="f-relationship">
          <option value="single">Single ğŸ’”</option>
          <option value="dating">In a relationship ğŸ’•</option>
          <option value="married">Married ğŸ’</option>
          <option value="divorced">Divorced ğŸ“‹</option>
          <option value="widowed">Widowed ğŸ•Šï¸</option>
          <option value="complicated">It's complicated ğŸ¤·</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">How Long? (years)</label>
        <input class="form-input" id="f-relduration" type="number" placeholder="3" min="0" max="80" value="0" step="0.5">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Kids</label>
        <input class="form-input" id="f-kids" type="number" placeholder="0" min="0" max="20" value="0">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Exercise</label>
        <select class="form-input" id="f-exercise">
          <option value="0">Never ğŸ›‹ï¸</option>
          <option value="1">1Ã—/week</option>
          <option value="2">2-3Ã—/week ğŸ’ª</option>
          <option value="4">4-5Ã—/week ğŸ”¥</option>
          <option value="6">6-7Ã—/week ğŸ†</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Days with Friends / Week</label>
        <input class="form-input" id="f-frienddays" type="number" placeholder="2" min="0" max="7" value="2">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Alcohol</label>
        <select class="form-input" id="f-alcohol">
          <option value="never">Never ğŸš«</option>
          <option value="rarely">Rarely (few/year)</option>
          <option value="social">Social (1-2/week) ğŸ·</option>
          <option value="regular">Regular (3-5/week) ğŸº</option>
          <option value="daily">Daily ğŸ¥ƒ</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Cigarettes / Day ğŸš¬</label>
        <input class="form-input" id="f-cigs" type="number" placeholder="0" min="0" max="60" value="0">
      </div>
      <div class="form-group"><label class="form-label">Chronotype</label>
        <select class="form-input" id="f-chronotype">
          <option value="early">Early bird ğŸŒ…</option>
          <option value="night">Night owl ğŸ¦‰</option>
          <option value="neither">Neither ğŸ¤·</option>
        </select>
      </div>
    </div>
    <div style="padding:12px 0 4px;border-top:1px solid var(--border);margin-top:12px"><span style="font-family:'Space Mono',monospace;font-size:10px;color:var(--accent2);letter-spacing:3px;text-transform:uppercase">LIFE SKILLS</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Can you swim?</label>
        <select class="form-input" id="f-swim">
          <option value="yes">Yes ğŸŠ</option>
          <option value="no">No</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Can you drive?</label>
        <select class="form-input" id="f-drive">
          <option value="yes">Yes ğŸš—</option>
          <option value="no">No</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Ride a bicycle?</label>
        <select class="form-input" id="f-bike">
          <option value="yes">Yes ğŸš²</option>
          <option value="no">No</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Can you cook?</label>
        <select class="form-input" id="f-cook">
          <option value="no">Barely ğŸ˜…</option>
          <option value="basic">Basic meals ğŸ³</option>
          <option value="good">Good cook ğŸ‘¨â€ğŸ³</option>
          <option value="pro">Excellent / pro ğŸ§‘â€ğŸ³</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Play instrument?</label>
        <select class="form-input" id="f-instrument">
          <option value="no">No ğŸ™…</option>
          <option value="yes">Yes ğŸ¸</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Know CPR / First Aid?</label>
        <select class="form-input" id="f-cpr">
          <option value="no">No</option>
          <option value="yes">Yes ğŸ©º</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Education</label>
        <select class="form-input" id="f-education">
          <option value="school">High School ğŸ«</option>
          <option value="bachelor">Bachelor's degree ğŸ“</option>
          <option value="master">Master's degree ğŸ“œ</option>
          <option value="phd">PhD / Doctorate ğŸ“ğŸ“</option>
          <option value="none">No formal education</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Passport / traveled abroad?</label>
        <select class="form-input" id="f-passport">
          <option value="yes">Yes ğŸ›‚</option>
          <option value="no">No</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Have a tattoo?</label>
        <select class="form-input" id="f-tattoo">
          <option value="no">No</option>
          <option value="1">Yes â€” 1 ğŸ–‹ï¸</option>
          <option value="2-5">Yes â€” 2-5</option>
          <option value="6+">Yes â€” 6+ ğŸ¨</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Ever broken a bone?</label>
        <select class="form-input" id="f-bone">
          <option value="no">No ğŸ’ª</option>
          <option value="yes">Yes ğŸ¦´</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Donated blood?</label>
        <select class="form-input" id="f-donated">
          <option value="no">No</option>
          <option value="yes">Yes ğŸ©¸</option>
        </select>
      </div>
    </div>
    <div id="form-error" class="form-error"></div>
    <button class="submit-btn" id="submit-btn" onclick="startGenerate()">âš¡ Count My Life</button>
    <div style="text-align:center;margin-top:16px">
      <button onclick="clearCache()" style="background:none;border:none;color:var(--text2);font-size:11px;font-family:'Space Mono',monospace;cursor:pointer;letter-spacing:1px;opacity:0.5">CLEAR CACHE</button>
    </div>
  </div></div>
</div>

<div id="screen-loading" class="hidden">
  <div class="header">
    <div class="header-tag">YOUR LIFE IN</div>
    <h1>COUNT<span>ED</span></h1>
  </div>
  <div class="content">
    <div class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">COUNTING YOUR LIFE</div>
      <div class="loading-step" id="loading-step">Fetching name data...</div>
    </div>
  </div>
</div>

<div id="screen-results" class="hidden">
  <div class="content" style="padding-top:24px"><div id="results-container"></div></div>
</div>

<script>
const WORLD_POP = 8200000000; // UN 2026 estimate
const COUNTRY_POP = {
  'CN':1425000000,'IN':1428000000,'US':340000000,'ID':277000000,'PK':230000000,'BR':216000000,
  'NG':224000000,'BD':172000000,'RU':144000000,'MX':129000000,'JP':124000000,'ET':126000000,
  'PH':117000000,'EG':111000000,'VN':99000000,'DE':84000000,'TR':86000000,'IR':88000000,
  'TH':72000000,'GB':68000000,'FR':68000000,'IT':59000000,'ZA':60000000,'KR':52000000,
  'CO':52000000,'ES':48000000,'UA':37000000,'AR':46000000,'PL':38000000,'CA':39000000,
  'AU':26000000,'NL':18000000,'BE':12000000,'CZ':11000000,'GR':10700000,'PT':10300000,
  'SE':10500000,'HU':10000000,'AT':9200000,'CH':9000000,'IL':9700000,'DK':5900000,
  'FI':5600000,'NO':5500000,'IE':5200000,'NZ':5200000,'HR':3900000,'RS':6700000,
  'RO':19000000,'CY':1200000,'BG':6500000,'SK':5400000,'LT':2800000,'LV':1800000,
  'EE':1400000,'SI':2100000,'LU':660000,'MT':520000,'IS':380000
};
const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const zodiacSigns = [
  {n:"Capricorn",s:"â™‘",m1:1,d1:1,m2:1,d2:19,e:"Earth",t:"ambitious and disciplined"},
  {n:"Aquarius",s:"â™’",m1:1,d1:20,m2:2,d2:18,e:"Air",t:"independent and humanitarian"},
  {n:"Pisces",s:"â™“",m1:2,d1:19,m2:3,d2:20,e:"Water",t:"intuitive and artistic"},
  {n:"Aries",s:"â™ˆ",m1:3,d1:21,m2:4,d2:19,e:"Fire",t:"bold and energetic"},
  {n:"Taurus",s:"â™‰",m1:4,d1:20,m2:5,d2:20,e:"Earth",t:"reliable and patient"},
  {n:"Gemini",s:"â™Š",m1:5,d1:21,m2:6,d2:20,e:"Air",t:"curious and adaptable"},
  {n:"Cancer",s:"â™‹",m1:6,d1:21,m2:7,d2:22,e:"Water",t:"protective and caring"},
  {n:"Leo",s:"â™Œ",m1:7,d1:23,m2:8,d2:22,e:"Fire",t:"confident and dramatic"},
  {n:"Virgo",s:"â™",m1:8,d1:23,m2:9,d2:22,e:"Earth",t:"analytical and thoughtful"},
  {n:"Libra",s:"â™",m1:9,d1:23,m2:10,d2:22,e:"Air",t:"diplomatic and harmonious"},
  {n:"Scorpio",s:"â™",m1:10,d1:23,m2:11,d2:21,e:"Water",t:"intense and strategic"},
  {n:"Sagittarius",s:"â™",m1:11,d1:22,m2:12,d2:21,e:"Fire",t:"adventurous and optimistic"},
  {n:"Capricorn",s:"â™‘",m1:12,d1:22,m2:12,d2:31,e:"Earth",t:"ambitious and disciplined"},
];

function getZodiac(m,d){for(const z of zodiacSigns){if(z.m1===z.m2){if(m===z.m1&&d>=z.d1&&d<=z.d2)return z}else{if((m===z.m1&&d>=z.d1)||(m===z.m2&&d<=z.d2))return z}}return zodiacSigns[0]}
function fmt(n){if(n>=1e12)return(n/1e12).toFixed(1)+'T';if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1e3)return Math.round(n).toLocaleString();return n.toString()}
function fmtE(n){return Math.round(n).toLocaleString()}
function distKm(a,b,c,d){const R=6371,dL=(c-a)*Math.PI/180,dN=(d-b)*Math.PI/180;const x=Math.sin(dL/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dN/2)**2;return Math.round(R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)))}
function card(n,t,c){return'<div class="fact-card"><div class="fact-number '+c+'">'+n+'</div><div class="fact-text">'+t+'</div></div>'}
function cardS(n,t,c){return'<div class="fact-card small"><div class="fact-number '+c+'">'+n+'</div><div class="fact-text">'+t+'</div></div>'}
function dnaCard(n,t,c){return'<div class="dna-card"><div class="fact-number '+c+'">'+n+'</div><div class="fact-text">'+t+'</div></div>'}
function src(t){return'<div class="source-tag">'+t+'</div>'}

// Populate birthday day dropdown
(function(){const s=document.getElementById('f-bd-day');for(let i=1;i<=31;i++){const o=document.createElement('option');o.value=String(i).padStart(2,'0');o.textContent=i;s.appendChild(o);}})();

// Dynamic sibling age inputs
function updateSiblingInputs() {
  const n = parseInt(document.getElementById('f-siblings').value) || 0;
  const container = document.getElementById('sibling-ages-container');
  container.innerHTML = '';
  if (n === 0) return;
  let html = '<div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px">';
  for (let i = 0; i < Math.min(n, 10); i++) {
    html += '<div style="flex:1;min-width:60px;max-width:100px"><label class="form-label" style="font-size:10px">' + (n===1?'Sibling':'Sib '+(i+1)) + ' age</label>';
    html += '<input class="form-input" id="f-sib-age-'+i+'" type="number" placeholder="'+(25+i*3)+'" min="0" max="120" style="padding:10px 8px;font-size:14px" inputmode="numeric"></div>';
  }
  html += '</div>';
  container.innerHTML = html;
}

function show(id){['screen-form','screen-loading','screen-results'].forEach(s=>document.getElementById(s).classList.add('hidden'));document.getElementById(id).classList.remove('hidden');window.scrollTo(0,0)}
function step(t){document.getElementById('loading-step').textContent=t}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CACHE LAYER â€” localStorage + in-memory fallback
// Saves API results so repeat lookups cost 0 requests
// localStorage works on GitHub Pages; in-memory works in Claude preview
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const memoryCache = {};

function cacheGet(key) {
  try {
    const raw = localStorage.getItem('counted_' + key);
    if (raw) {
      const parsed = JSON.parse(raw);
      // Cache for 30 days
      if (parsed.ts && (Date.now() - parsed.ts) < 30 * 24 * 60 * 60 * 1000) {
        return parsed.data;
      }
    }
  } catch(e) { /* localStorage unavailable */ }
  // Fallback to memory cache
  const mem = memoryCache[key];
  if (mem && (Date.now() - mem.ts) < 30 * 24 * 60 * 60 * 1000) {
    return mem.data;
  }
  return null;
}

function cacheSet(key, data) {
  const entry = { data, ts: Date.now() };
  memoryCache[key] = entry;
  try {
    localStorage.setItem('counted_' + key, JSON.stringify(entry));
  } catch(e) { /* localStorage unavailable or full */ }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API CALLS â€” all free, no key required
// Results are cached to avoid wasting requests
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function fetchNameData(name) {
  const cacheKey = 'name_' + name.toLowerCase().trim();
  const cached = cacheGet(cacheKey);
  if (cached) { cached.source += ' (cached)'; return cached; }

  // Fetch all 3 sources independently â€” any can fail without breaking others
  let genderRes = null, nationRes = null, forebears = null;

  const results = await Promise.allSettled([
    fetch('https://api.genderize.io/?name=' + encodeURIComponent(name)).then(r=>r.json()),
    fetch('https://api.nationalize.io/?name=' + encodeURIComponent(name)).then(r=>r.json()),
    fetch('https://forebears.io/forenames/' + encodeURIComponent(name.toLowerCase())).then(r=>r.ok?r.text():null),
  ]);

  if (results[0].status === 'fulfilled' && results[0].value) genderRes = results[0].value;
  if (results[1].status === 'fulfilled' && results[1].value) nationRes = results[1].value;

  // Parse forebears HTML if available
  if (results[2].status === 'fulfilled' && results[2].value) {
    try {
      const html = results[2].value;
      const worldMatch = html.match(/borne by ([\d,]+) people/i);
      if (worldMatch) {
        const worldIncidence = parseInt(worldMatch[1].replace(/,/g,''));
        const countryData = [];
        const rowRegex = /data-iso="([^"]+)"[^>]*>.*?<td[^>]*>([\d,]+)<\/td>/gs;
        let m;
        while ((m = rowRegex.exec(html)) !== null) {
          countryData.push({ iso: m[1].toUpperCase(), incidence: parseInt(m[2].replace(/,/g,'')) });
        }
        if (worldIncidence > 0) {
          forebears = { world: worldIncidence, countries: countryData };
        }
      }
    } catch(e) {}
  }

  const countries = nationRes ? (nationRes.country || [])
    .filter(c => c.probability > 0.01).slice(0, 5)
    .map(c => ({id: c.country_id, prob: c.probability})) : [];

  // Compute global estimate from best available source
  let globalEstimate = 50000; // safe default
  let nameSource = 'estimated';

  if (forebears && forebears.world > 0) {
    globalEstimate = forebears.world;
    nameSource = 'forebears.io (4B person database)';
  } else if (genderRes && genderRes.count) {
    const rawFreq = genderRes.count / 200000000;
    let genderizeEst = Math.round(rawFreq * WORLD_POP);
    genderizeEst = Math.max(5000, Math.min(genderizeEst, 200000000));

    // If nationalize shows strong country association, genderize is underrepresenting
    if (countries.length > 0 && countries[0].prob > 0.5) {
      const topPop = COUNTRY_POP[countries[0].id] || 50000000;
      const countryEst = Math.round(topPop * countries[0].prob * 0.006);
      globalEstimate = Math.max(genderizeEst, countryEst);
      nameSource = 'nationalize.io corrected';
    } else {
      globalEstimate = genderizeEst;
      nameSource = 'genderize.io';
    }
  } else if (countries.length > 0 && countries[0].prob > 0.3) {
    // Even if genderize failed, use nationalize alone
    const topPop = COUNTRY_POP[countries[0].id] || 50000000;
    globalEstimate = Math.round(topPop * countries[0].prob * 0.006);
    nameSource = 'nationalize.io estimate';
  }

  const result = {
    estimated_global: globalEstimate,
    gender_prob: genderRes ? (genderRes.probability || 0.5) : 0.5,
    db_count: genderRes ? (genderRes.count || 0) : 0,
    countries: countries,
    forebears: forebears,
    source: nameSource
  };
  cacheSet(cacheKey, result);
  return result;
}

async function fetchCityData(cityName) {
  const cacheKey = 'city_' + cityName.toLowerCase().trim();
  const cached = cacheGet(cacheKey);
  if (cached) { cached.source += ' (cached)'; return cached; }

  // Nominatim (OpenStreetMap) â€” free geocoding
  // Returns coordinates + display name + place details
  try {
    const res = await fetch(
      'https://nominatim.openstreetmap.org/search?q=' + encodeURIComponent(cityName) +
      '&format=json&limit=1&addressdetails=1&extratags=1',
      { headers: { 'Accept-Language': 'en' } }
    );
    const data = await res.json();
    if (!data || !data.length) throw new Error('City not found');

    const place = data[0];
    const lat = parseFloat(place.lat);
    const lon = parseFloat(place.lon);
    const country = place.address ? (place.address.country || '') : '';
    const countryCode = place.address ? (place.address.country_code || '').toUpperCase() : '';
    const displayName = place.display_name || cityName;

    // Try to get population from extratags or estimate from place type
    let population = 0;
    if (place.extratags && place.extratags.population) {
      population = parseInt(place.extratags.population);
    }

    // If no population from Nominatim, try Wikidata
    if (!population && place.extratags && place.extratags.wikidata) {
      try {
        const wdId = place.extratags.wikidata;
        const wdRes = await fetch(
          'https://www.wikidata.org/wiki/Special:EntityData/' + wdId + '.json'
        );
        const wdData = await wdRes.json();
        const entity = wdData.entities[wdId];
        if (entity && entity.claims && entity.claims.P1082) {
          // P1082 = population, get most recent
          const popClaims = entity.claims.P1082;
          const latest = popClaims[popClaims.length - 1];
          if (latest && latest.mainsnak && latest.mainsnak.datavalue) {
            population = parseInt(latest.mainsnak.datavalue.value.amount);
          }
        }
      } catch(e) { /* Wikidata failed, continue without */ }
    }

    // If still no population, estimate from place type
    if (!population) {
      if (place.type === 'city') population = 500000;
      else if (place.type === 'town') population = 50000;
      else if (place.type === 'village') population = 5000;
      else population = 200000;
    }

    const result = {
      lat, lon, country, countryCode, population, displayName,
      source: 'OpenStreetMap Nominatim' + (population ? ' + Wikidata' : ' (pop estimated)')
    };
    cacheSet(cacheKey, result);
    return result;
  } catch(e) {
    return null;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Country code to name mapping (for nationalize.io results)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Life expectancy by country â€” World Bank API (free, no key)
async function fetchLifeExpectancy(countryCode) {
  if (!countryCode) return null;
  const cc = countryCode.toUpperCase();
  const cacheKey = 'le_' + cc;
  const cached = cacheGet(cacheKey);
  if (cached) return cached;

  try {
    // Fetch male + female life expectancy in parallel (mrv=1 = most recent value)
    const [maleRes, femaleRes] = await Promise.all([
      fetch('https://api.worldbank.org/v2/country/' + cc + '/indicator/SP.DYN.LE00.MA.IN?format=json&per_page=1&mrv=1').then(r => r.json()),
      fetch('https://api.worldbank.org/v2/country/' + cc + '/indicator/SP.DYN.LE00.FE.IN?format=json&per_page=1&mrv=1').then(r => r.json()),
    ]);

    const maleLE = maleRes[1] && maleRes[1][0] ? Math.round(maleRes[1][0].value) : null;
    const femaleLE = femaleRes[1] && femaleRes[1][0] ? Math.round(femaleRes[1][0].value) : null;
    const year = maleRes[1] && maleRes[1][0] ? maleRes[1][0].date : '?';

    if (maleLE && femaleLE) {
      const result = { male: maleLE, female: femaleLE, year: year, source: 'World Bank API' };
      cacheSet(cacheKey, result);
      return result;
    }
    return null;
  } catch(e) {
    return null;
  }
}

// Antipodal point reverse geocoding
async function fetchAntipodalName(lat, lon) {
  const antiLat = -lat;
  const antiLon = lon > 0 ? lon - 180 : lon + 180;
  const cacheKey = 'anti_' + antiLat.toFixed(2) + '_' + antiLon.toFixed(2);
  const cached = cacheGet(cacheKey);
  if (cached) return cached;

  // Try reverse geocoding the antipodal point
  try {
    const res = await fetch(
      'https://nominatim.openstreetmap.org/reverse?lat=' + antiLat + '&lon=' + antiLon +
      '&format=json&zoom=5&accept-language=en',
      { headers: { 'Accept-Language': 'en' } }
    );
    const data = await res.json();
    if (data && data.display_name && !data.error) {
      const parts = data.display_name.split(', ');
      const placeName = parts.length > 2 ? parts.slice(-2).join(', ') : data.display_name;
      const result = { name: placeName, lat: antiLat, lon: antiLon, isLand: true };
      cacheSet(cacheKey, result);
      return result;
    }
  } catch(e) { /* reverse geocode failed */ }

  // If reverse geocoding returned nothing â†’ it's in an ocean
  // Determine which ocean based on coordinates
  let ocean = 'the middle of the ocean';
  if (antiLon >= -80 && antiLon <= 0 && antiLat >= -60 && antiLat <= 60) ocean = 'the Atlantic Ocean';
  else if (antiLon >= 20 && antiLon <= 150 && antiLat >= -60 && antiLat <= 30) ocean = 'the Indian Ocean';
  else if ((antiLon >= 100 || antiLon <= -60) && antiLat >= -60 && antiLat <= 60) ocean = 'the Pacific Ocean';
  else if (antiLat <= -60) ocean = 'the Southern Ocean (near Antarctica)';
  else if (antiLat >= 70) ocean = 'the Arctic Ocean';

  const result = { name: ocean, lat: antiLat, lon: antiLon, isLand: false };
  cacheSet(cacheKey, result);
  return result;
}
const COUNTRIES = {
  US:"USA",GB:"UK",DE:"Germany",FR:"France",IT:"Italy",ES:"Spain",PT:"Portugal",
  NL:"Netherlands",BE:"Belgium",AT:"Austria",CH:"Switzerland",SE:"Sweden",NO:"Norway",
  DK:"Denmark",FI:"Finland",PL:"Poland",CZ:"Czech Republic",HU:"Hungary",RO:"Romania",
  BG:"Bulgaria",GR:"Greece",TR:"Turkey",RU:"Russia",UA:"Ukraine",IE:"Ireland",
  CA:"Canada",AU:"Australia",NZ:"New Zealand",BR:"Brazil",AR:"Argentina",MX:"Mexico",
  CO:"Colombia",CL:"Chile",PE:"Peru",JP:"Japan",KR:"South Korea",CN:"China",
  IN:"India",PK:"Pakistan",BD:"Bangladesh",TH:"Thailand",VN:"Vietnam",ID:"Indonesia",
  PH:"Philippines",MY:"Malaysia",SG:"Singapore",TW:"Taiwan",HK:"Hong Kong",
  IL:"Israel",SA:"Saudi Arabia",AE:"UAE",EG:"Egypt",NG:"Nigeria",ZA:"South Africa",
  KE:"Kenya",GH:"Ghana",ET:"Ethiopia",MA:"Morocco",DZ:"Algeria",TN:"Tunisia",
  IR:"Iran",IQ:"Iraq",LB:"Lebanon",JO:"Jordan",CY:"Cyprus",MT:"Malta",
  IS:"Iceland",HR:"Croatia",RS:"Serbia",SK:"Slovakia",SI:"Slovenia",EE:"Estonia",
  LV:"Latvia",LT:"Lithuania",CU:"Cuba",VE:"Venezuela",UY:"Uruguay",
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function startGenerate() {
  const name = document.getElementById('f-name').value.trim();
  const age = parseInt(document.getElementById('f-age').value);
  const gender = document.getElementById('f-gender').value;
  const bdDay = document.getElementById('f-bd-day').value;
  const bdMonth = document.getElementById('f-bd-month').value;
  const bdYear = document.getElementById('f-bd-year').value;
  const bdStr = bdYear && bdMonth && bdDay ? bdYear+'-'+bdMonth+'-'+bdDay : '';
  const city = document.getElementById('f-city').value.trim();
  const userCountry = document.getElementById('f-country').value.trim();
  const cityQuery = userCountry ? city + ', ' + userCountry : city;
  const height = parseFloat(document.getElementById('f-height').value);
  const weight = parseFloat(document.getElementById('f-weight').value);
  const job = document.getElementById('f-job').value.trim();
  const siblings = parseInt(document.getElementById('f-siblings').value) || 0;
  const momAge = parseInt(document.getElementById('f-mom').value) || 0;
  const dadAge = parseInt(document.getElementById('f-dad').value) || 0;
  const parentsStatus = document.getElementById('f-parents').value;
  const siblingAges = [];
  for (let i = 0; i < siblings; i++) {
    const el = document.getElementById('f-sib-age-'+i);
    if (el && el.value) siblingAges.push(parseInt(el.value));
  }
  const blood = document.getElementById('f-blood').value;
  const hand = document.getElementById('f-hand').value;
  const eyes = document.getElementById('f-eyes').value;
  const sleepHrs = parseFloat(document.getElementById('f-sleep').value) || 7;
  const languages = parseInt(document.getElementById('f-languages').value) || 1;
  const glasses = document.getElementById('f-glasses').value;
  const coffeePerDay = parseInt(document.getElementById('f-coffee').value) || 0;
  const pets = parseInt(document.getElementById('f-pets').value) || 0;
  const extra = { blood, hand, eyes, sleepHrs, languages, glasses, coffeePerDay, pets,
    relationship: document.getElementById('f-relationship').value,
    kids: parseInt(document.getElementById('f-kids').value) || 0,
    exercise: parseInt(document.getElementById('f-exercise').value) || 0,
    alcohol: document.getElementById('f-alcohol').value,
    cigsPerDay: parseInt(document.getElementById('f-cigs').value) || 0,
    chronotype: document.getElementById('f-chronotype').value,
    canSwim: document.getElementById('f-swim').value,
    canDrive: document.getElementById('f-drive').value,
    canBike: document.getElementById('f-bike').value,
    cookLevel: document.getElementById('f-cook').value,
    workHrsPerDay: parseFloat(document.getElementById('f-workhrs').value) || 8,
    homeMealsPerWeek: parseInt(document.getElementById('f-homemeals').value) || 7,
    friendDaysPerWeek: parseInt(document.getElementById('f-frienddays').value) || 2,
    relDuration: parseFloat(document.getElementById('f-relduration').value) || 0,
    instrument: document.getElementById('f-instrument').value,
    cpr: document.getElementById('f-cpr').value,
    education: document.getElementById('f-education').value,
    passport: document.getElementById('f-passport').value,
    tattoo: document.getElementById('f-tattoo').value,
    brokenBone: document.getElementById('f-bone').value,
    donatedBlood: document.getElementById('f-donated').value,
    momAge, dadAge, parentsStatus, siblingAges,
    momAlive: document.getElementById('f-mom-alive').value,
    dadAlive: document.getElementById('f-dad-alive').value,
  };

  if(!name||isNaN(age)||!age||!bdStr||!city||!userCountry||isNaN(height)||!height||isNaN(weight)||!weight||!job){
    document.getElementById('form-error').textContent='âš ï¸ Please fill in all fields';
    document.getElementById('form-error').style.display='block';
    return;
  }
  document.getElementById('form-error').style.display='none';

  // Show loading
  show('screen-loading');

  try {
    // Fetch data in parallel
    step('Fetching name data...');
    const nameDataPromise = fetchNameData(name);

    step('Locating your city...');
    const cityDataPromise = fetchCityData(cityQuery);

    const [nameData, cityData] = await Promise.all([nameDataPromise, cityDataPromise]);

    // Fetch antipodal point name + life expectancy
    step('Finding your antipodal point & life expectancy...');
    let antipodalData = null;
    let lifeExpData = null;
    if (cityData) {
      [antipodalData, lifeExpData] = await Promise.all([
        fetchAntipodalName(cityData.lat, cityData.lon),
        fetchLifeExpectancy(cityData.countryCode)
      ]);
    }

    const cachedCount = (nameData.source.includes('cached') ? 1 : 0) + (cityData && cityData.source.includes('cached') ? 1 : 0);
    if (cachedCount > 0) step('Loaded ' + cachedCount + ' from cache âš¡');
    else step('Calculating your life...');
    await new Promise(r => setTimeout(r, cachedCount > 0 ? 200 : 400));

    generateResults(name, age, gender, bdStr, city, height, weight, job, siblings, nameData, cityData, extra, antipodalData, lifeExpData);
  } catch(err) {
    show('screen-form');
    document.getElementById('form-error').textContent='âš ï¸ Error: '+err.message;
    document.getElementById('form-error').style.display='block';
  }
}

function generateResults(name, age, gender, bdStr, city, height, weight, job, siblings, nameData, cityData, extra, antipodalData, lifeExpData) {
  try {
  const bd = new Date(bdStr);
  const now = new Date();
  const daysAlive = Math.floor((now-bd)/86400000);
  const secondsAlive = daysAlive * 86400;
  const hoursAlive = daysAlive*24;
  const bM=bd.getMonth()+1, bD=bd.getDate(), bY=bd.getFullYear();
  const dayOW = dayNames[bd.getDay()];
  const zodiac = getZodiac(bM,bD);

  // City data (from API) â€” needed early for life expectancy
  const ci = cityData;

  // Country-specific life expectancy (from World Bank API, falls back to global avg)
  const countryLE = lifeExpData; // {male, female, year, source} or null
  const lifeExp = countryLE ? (gender==='male' ? countryLE.male : countryLE.female) : (gender==='male'?71:76);
  const lifeExpSource = countryLE ? ((ci && ci.country ? ci.country : 'your country') + ' ' + countryLE.year) : 'global average';
  const yrsLeft = Math.max(0,lifeExp-age);
  const hM = height/100;
  const hFt = Math.floor(height/30.48);
  const hIn = Math.round((height/2.54)%12);

  // Name data (from API)
  const namePop = nameData.estimated_global;
  const nameCountries = nameData.countries;

  // â•â•â• BODY CALCULATIONS (medical averages) â•â•â•
  const heartbeats = daysAlive * 100000;     // 100k/day (AHA)
  const breaths = daysAlive * 23040;          // 16/min Ã— 1440 min
  const blinks = daysAlive * 19200;           // 15-20/min while awake
  const bloodMi = daysAlive * 12000;          // blood travels ~12,000 mi/day
  const skinKg = age * 1.5;                   // ~1.5kg/year
  const hairM = age * 0.15;                   // ~15cm/year
  const yrsSleep = (age * 0.33).toFixed(1);   // 1/3 of life
  const meals = daysAlive * 3;
  const dreams = daysAlive * 4;               // 4-6 dreams/night avg
  const stepsLife = daysAlive * 5000;         // global avg steps/day (Lancet 2022)
  const distKmWalk = stepsLife * 0.0007;      // avg stride ~70cm

  // â•â•â• DNA & ATOMS (scientific constants) â•â•â•
  const dnaKm = 2 * 37.2e12 / 1000;          // 2m per cell Ã— 37.2T cells
  const plutoDistKm = 5900000000;
  const plutoTrips = Math.round(dnaKm / (plutoDistKm * 2));
  const sunDistKm = 149600000;
  const sunTrips = Math.round(dnaKm / sunDistKm);
  const uniqueBasePairs = 3200000;            // 0.1% of 3.2B
  const cellsInBody = 37.2e12;
  const bacteriaInBody = 38e12;
  const atomsInBody = 7e27;
  const ironGrams = weight * 0.004;
  const goldMg = weight * 0.000002 * 1000;
  const lightKm = secondsAlive * 299792;
  const orbits = age;
  const orbitDistKm = orbits * 940000000;

  // â•â•â• HEIGHT (WHO global data) â•â•â•
  const wAvg = gender==='male'?171:159;
  const hDiff = height - wAvg;
  // Better percentile using normal distribution approximation
  // Male: mean=171, SD=7. Female: mean=159, SD=6.5
  const sd = gender==='male'?7:6.5;
  const zScore = hDiff / sd;
  // Approximate CDF using logistic approximation
  const tallerPct = Math.min(99.9, Math.max(0.1, Math.round((1/(1+Math.exp(-1.7*zScore)))*1000)/10));
  const stackEiffel = Math.round(330/hM);
  const stackBurj = Math.round(828/hM);
  const toMoon = Math.round(384400000/hM);

  // â•â•â• WEIGHT (biochemistry) â•â•â•
  const waterKg = weight*0.6;
  const oxygenKg = weight*0.65;
  const carbonKg = weight*0.18;
  const antCount = Math.round(weight/0.001);  // ant weighs ~1mg

  // â•â•â• BIRTHDAY â•â•â•
  const sameBday = Math.round(WORLD_POP/365);
  const worldPops={1950:2536e6,1960:3034e6,1970:3700e6,1980:4434e6,1990:5263e6,2000:6115e6,2010:6922e6,2020:7795e6,2025:8100e6};
  let popBorn=7e9;
  const yrs2=Object.keys(worldPops).map(Number).sort();
  for(let i=0;i<yrs2.length-1;i++){if(bY>=yrs2[i]&&bY<yrs2[i+1]){const f=(bY-yrs2[i])/(yrs2[i+1]-yrs2[i]);popBorn=Math.round(worldPops[yrs2[i]]+f*(worldPops[yrs2[i+1]]-worldPops[yrs2[i]]));}}

  // â•â•â• MILESTONES â•â•â•
  const billionthHB = new Date(bd.getTime() + (1e9/100000)*86400000);
  const tenKDay = new Date(bd.getTime() + 10000*86400000);
  function fmtDate(d){return monthNames[d.getMonth()]+' '+d.getDate()+', '+d.getFullYear()}

  // â•â•â• EXTRA FIELDS â•â•â•
  const { blood, hand, eyes, sleepHrs, languages, glasses, coffeePerDay: myCoffee, pets,
    relationship, kids, exercise, alcohol, chronotype, canSwim, canDrive,
    canBike, cookLevel, instrument, cpr, education, passport, tattoo, brokenBone, donatedBlood,
    momAge, dadAge, parentsStatus, siblingAges, momAlive, dadAlive,
    workHrsPerDay, homeMealsPerWeek, friendDaysPerWeek, relDuration, cigsPerDay } = extra;

  // â•â•â• FAMILY â•â•â•
  const sibPcts=[15,38,27,13,5,2];
  const sibPct = siblings<5?sibPcts[siblings]:sibPcts[5];

  // Mother/father age gap calculations
  const momHadYouAt = momAge > 0 ? momAge - age : 0;
  const dadHadYouAt = dadAge > 0 ? dadAge - age : 0;
  const parentAgeDiff = (momAge > 0 && dadAge > 0) ? Math.abs(dadAge - momAge) : 0;

  // Mother's age when she had you â€” global distribution
  const momAgePcts = {
    '15-19': 11, '20-24': 26, '25-29': 29, '30-34': 21, '35-39': 10, '40+': 3
  };
  let momAgeBracket = '', momAgeBracketPct = 0;
  if (momHadYouAt >= 15 && momHadYouAt <= 19) { momAgeBracket='15-19'; momAgeBracketPct=11; }
  else if (momHadYouAt >= 20 && momHadYouAt <= 24) { momAgeBracket='20-24'; momAgeBracketPct=26; }
  else if (momHadYouAt >= 25 && momHadYouAt <= 29) { momAgeBracket='25-29'; momAgeBracketPct=29; }
  else if (momHadYouAt >= 30 && momHadYouAt <= 34) { momAgeBracket='30-34'; momAgeBracketPct=21; }
  else if (momHadYouAt >= 35 && momHadYouAt <= 39) { momAgeBracket='35-39'; momAgeBracketPct=10; }
  else if (momHadYouAt >= 40) { momAgeBracket='40+'; momAgeBracketPct=3; }

  // Father's age brackets
  const dadAgePcts = {
    '15-19': 3, '20-24': 15, '25-29': 27, '30-34': 28, '35-39': 17, '40+': 10
  };
  let dadAgeBracket = '', dadAgeBracketPct = 0;
  if (dadHadYouAt >= 15 && dadHadYouAt <= 19) { dadAgeBracket='15-19'; dadAgeBracketPct=3; }
  else if (dadHadYouAt >= 20 && dadHadYouAt <= 24) { dadAgeBracket='20-24'; dadAgeBracketPct=15; }
  else if (dadHadYouAt >= 25 && dadHadYouAt <= 29) { dadAgeBracket='25-29'; dadAgeBracketPct=27; }
  else if (dadHadYouAt >= 30 && dadHadYouAt <= 34) { dadAgeBracket='30-34'; dadAgeBracketPct=28; }
  else if (dadHadYouAt >= 35 && dadHadYouAt <= 39) { dadAgeBracket='35-39'; dadAgeBracketPct=17; }
  else if (dadHadYouAt >= 40) { dadAgeBracket='40+'; dadAgeBracketPct=10; }

  // Parent age difference stats
  const parentGapPcts = {
    0: 3, 1: 8, 2: 14, 3: 16, 4: 14, 5: 12, 6: 8, 7: 6, 8: 5, 9: 4, 10: 3
  };
  // above 10 is ~7% combined
  const parentGapPct = parentAgeDiff <= 10 ? (parentGapPcts[parentAgeDiff] || 3) : (parentAgeDiff <= 15 ? 2 : 1);

  // Parents status stats
  const parentsData = {
    'together':     {pct:55, emoji:'ğŸ’‘', label:'Parents still together', fact:'About 55% of children grow up with both biological parents together â€” you\'re in the majority, but not by much'},
    'divorced':     {pct:25, emoji:'ğŸ’”', label:'Parents divorced/separated', fact:'~25% of families experience divorce. Children of divorce often develop higher emotional resilience and adaptability'},
    'single_mom':   {pct:11, emoji:'ğŸ‘©', label:'Raised by mother', fact:'~11% of children worldwide are raised by single mothers. Single mothers work an estimated 98 hours per week when combining paid and unpaid labor'},
    'single_dad':   {pct:3, emoji:'ğŸ‘¨', label:'Raised by father', fact:'Only ~3% of children are raised by single fathers â€” one of the rarest family structures globally'},
    'other_guardian':{pct:4, emoji:'ğŸ¤²', label:'Other guardian', fact:'~4% of children are raised by grandparents, relatives, or other guardians. The bond of chosen family is just as powerful'},
  };
  const parentInfo = parentsData[parentsStatus] || parentsData['together'];

  // Sibling age gap analysis
  const sibGaps = siblingAges.map(sa => Math.abs(age - sa)).sort((a,b)=>a-b);
  const sibGapPcts = { 1:12, 2:18, 3:16, 4:13, 5:10, 6:8, 7:6, 8:5 }; // gap in years â†’ % frequency

  // Family "total years alive"
  const familyTotalYears = age + momAge + dadAge + siblingAges.reduce((a,b)=>a+b, 0);
  const familyTotalHeartbeats = familyTotalYears * 365 * 100000;
  const familySize = 1 + (momAge>0?1:0) + (dadAge>0?1:0) + siblings;

  // Who's oldest, youngest
  const allAges = [{who:'You',age:age}];
  if(momAge>0) allAges.push({who: momAlive==='alive'?'Mom':'Mom ğŸ•Šï¸', age:momAge});
  if(dadAge>0) allAges.push({who: dadAlive==='alive'?'Dad':'Dad ğŸ•Šï¸', age:dadAge});
  siblingAges.forEach((sa,i) => allAges.push({who: siblings===1?'Sibling':'Sibling '+(i+1), age:sa}));
  allAges.sort((a,b) => b.age - a.age);

  // Time left with parents (based on life expectancy)
  const momLifeExp = countryLE ? countryLE.female : 81; // female, country-adjusted
  const dadLifeExp = countryLE ? countryLE.male : 76; // male, country-adjusted
  const momYearsLeft = momAlive === 'alive' && momAge > 0 ? Math.max(0, momLifeExp - momAge) : 0;
  const dadYearsLeft = dadAlive === 'alive' && dadAge > 0 ? Math.max(0, dadLifeExp - dadAge) : 0;
  // Assume you see parents ~200 hours/year as adult, ~3000 hours/year as child
  const momHoursLeft = momAlive === 'alive' && momAge > 0 ? Math.round(momYearsLeft * (age > 18 ? 200 : 3000)) : 0;
  const dadHoursLeft = dadAlive === 'alive' && dadAge > 0 ? Math.round(dadYearsLeft * (age > 18 ? 200 : 3000)) : 0;

  // Percentage with both parents alive at your age
  const bothAliveAtAgePct = age < 20 ? 93 : age < 30 ? 88 : age < 40 ? 80 : age < 50 ? 65 : age < 60 ? 45 : age < 70 ? 25 : 10;

  // â•â•â• JOB CLASSIFICATION (direct lookup from dropdown) â•â•â•
  const JOB_DB = {
    'doctor':       {cat:'Healthcare â€” Doctor',icon:'ğŸ¥',hrsWeek:52,meetPct:0.06,retireAge:63,stress:'very high',global:10000000,fact:'You\'ll wash your hands ~45,000 more times than the average person',standHrs:0.6,coffee:3.5,salary:'$100k-350k'},
    'nurse':        {cat:'Healthcare â€” Nursing',icon:'ğŸ¥',hrsWeek:42,meetPct:0.04,retireAge:60,stress:'very high',global:28000000,fact:'You\'ll walk ~6,000 km more than an office worker during shifts',standHrs:0.75,coffee:3.0,salary:'$40k-90k'},
    'dentist':      {cat:'Healthcare â€” Dental',icon:'ğŸ¦·',hrsWeek:38,meetPct:0.04,retireAge:63,stress:'moderate',global:2600000,fact:'You\'ll look inside approximately 80,000 mouths in your career',standHrs:0.5,coffee:2.5,salary:'$70k-200k'},
    'therapist':    {cat:'Psychology / Therapy',icon:'ğŸ§ ',hrsWeek:40,meetPct:0.03,retireAge:65,stress:'moderate',global:6000000,fact:'You\'ll listen to approximately 35,000 hours of people\'s life stories',standHrs:0.1,coffee:2.8,salary:'$45k-120k'},
    'veterinarian': {cat:'Veterinary Medicine',icon:'ğŸ¾',hrsWeek:45,meetPct:0.04,retireAge:62,stress:'high',global:700000,fact:'You\'ll treat approximately 20,000 more animals â€” each one someone\'s family',standHrs:0.6,coffee:3.0,salary:'$60k-150k'},
    'researcher':   {cat:'Research & Science',icon:'ğŸ”¬',hrsWeek:47,meetPct:0.08,retireAge:67,stress:'moderate',global:9000000,fact:'You\'ll read approximately 15,000 more papers and write ~50 of your own',standHrs:0.2,coffee:3.8,salary:'$40k-120k'},
    'professor':    {cat:'University Professor',icon:'ğŸ“',hrsWeek:50,meetPct:0.12,retireAge:67,stress:'moderate',global:4000000,fact:'You\'ll grade approximately 50,000 more assignments and exams',standHrs:0.4,coffee:3.5,salary:'$50k-150k'},
    'teacher':      {cat:'Education â€” Teacher',icon:'ğŸ“–',hrsWeek:44,meetPct:0.10,retireAge:62,stress:'moderate',global:70000000,fact:'You\'ll say "please pay attention" approximately 30,000 more times',standHrs:0.6,coffee:2.8,salary:'$30k-75k'},
    'student':      {cat:'Student / Intern',icon:'ğŸ“š',hrsWeek:35,meetPct:0.05,retireAge:65,stress:'moderate',global:200000000,fact:'You\'ll take approximately 3,000 more exams in your academic journey',standHrs:0.2,coffee:2.5,salary:'$0-25k'},
    'software_engineer':{cat:'Software Engineering',icon:'ğŸ’»',hrsWeek:43,meetPct:0.15,retireAge:60,stress:'moderate',global:28000000,fact:'You\'ll type approximately 90 million more keystrokes and debug 50,000 errors',standHrs:0.1,coffee:3.2,salary:'$60k-250k'},
    'data_scientist':{cat:'Data Science / ML',icon:'ğŸ¤–',hrsWeek:44,meetPct:0.14,retireAge:60,stress:'moderate',global:5000000,fact:'You\'ll train thousands of models â€” most of them will be garbage and that\'s ok',standHrs:0.1,coffee:3.5,salary:'$70k-200k'},
    'it_support':   {cat:'IT Support / Sysadmin',icon:'ğŸ–¥ï¸',hrsWeek:42,meetPct:0.08,retireAge:62,stress:'moderate',global:15000000,fact:'You\'ll say "have you tried turning it off and on again?" at least 10,000 more times',standHrs:0.2,coffee:3.0,salary:'$35k-100k'},
    'designer':     {cat:'Design (UI/UX/Graphic)',icon:'ğŸ¨',hrsWeek:40,meetPct:0.12,retireAge:65,stress:'moderate',global:15000000,fact:'You\'ll press Ctrl+Z approximately 2 million more times',standHrs:0.1,coffee:2.5,salary:'$40k-130k'},
    'photographer': {cat:'Photography / Video',icon:'ğŸ“¸',hrsWeek:38,meetPct:0.05,retireAge:68,stress:'low',global:4000000,fact:'You\'ll take approximately 2 million more photos â€” and delete 80% of them',standHrs:0.5,coffee:2.2,salary:'$25k-90k'},
    'architect':    {cat:'Architecture',icon:'ğŸ—ï¸',hrsWeek:45,meetPct:0.15,retireAge:65,stress:'moderate',global:3000000,fact:'Buildings you design will likely outlast you by 100+ years',standHrs:0.2,coffee:3.0,salary:'$50k-150k'},
    'lawyer':       {cat:'Law â€” Attorney',icon:'âš–ï¸',hrsWeek:52,meetPct:0.14,retireAge:65,stress:'very high',global:12000000,fact:'You\'ll read the equivalent of 4,000 novels in legal documents',standHrs:0.15,coffee:3.5,salary:'$60k-300k'},
    'judge':        {cat:'Law â€” Judge/Paralegal',icon:'ğŸ›ï¸',hrsWeek:44,meetPct:0.10,retireAge:67,stress:'high',global:3000000,fact:'Your decisions will directly affect tens of thousands of lives',standHrs:0.2,coffee:2.5,salary:'$50k-200k'},
    'accountant':   {cat:'Accounting / Audit',icon:'ğŸ§®',hrsWeek:44,meetPct:0.12,retireAge:63,stress:'moderate',global:12000000,fact:'You\'ll process approximately 5 million numbers in your career',standHrs:0.05,coffee:2.5,salary:'$40k-120k'},
    'banker':       {cat:'Banking / Finance',icon:'ğŸ¦',hrsWeek:46,meetPct:0.18,retireAge:62,stress:'high',global:10000000,fact:'You\'ll handle the equivalent of billions in transactions',standHrs:0.1,coffee:2.8,salary:'$50k-180k'},
    'trader':       {cat:'Trading / Investments',icon:'ğŸ“ˆ',hrsWeek:55,meetPct:0.10,retireAge:55,stress:'very high',global:2000000,fact:'You\'ll make approximately 500,000 financial decisions under pressure',standHrs:0.1,coffee:4.0,salary:'$80k-500k+'},
    'manager':      {cat:'Management',icon:'ğŸ‘”',hrsWeek:48,meetPct:0.35,retireAge:63,stress:'high',global:25000000,fact:'You\'ll spend more time in meetings than some people spend sleeping',standHrs:0.15,coffee:3.2,salary:'$50k-200k'},
    'executive':    {cat:'Executive Leadership',icon:'ğŸ¢',hrsWeek:55,meetPct:0.40,retireAge:62,stress:'very high',global:5000000,fact:'40% of your work time will be meetings â€” that\'s 22,000 hours of talking',standHrs:0.15,coffee:3.8,salary:'$100k-1M+'},
    'consultant':   {cat:'Consulting',icon:'ğŸ’¡',hrsWeek:50,meetPct:0.30,retireAge:60,stress:'high',global:8000000,fact:'You\'ll create approximately 15,000 PowerPoint slides in your career',standHrs:0.15,coffee:3.5,salary:'$60k-250k'},
    'hr':           {cat:'HR / Recruiting',icon:'ğŸ¤',hrsWeek:42,meetPct:0.25,retireAge:63,stress:'moderate',global:7000000,fact:'You\'ll read approximately 100,000 CVs/resumes in your career',standHrs:0.1,coffee:2.5,salary:'$40k-120k'},
    'marketer':     {cat:'Marketing / Advertising',icon:'ğŸ“¢',hrsWeek:42,meetPct:0.22,retireAge:63,stress:'moderate',global:18000000,fact:'You\'ll write approximately 5 million words in emails and campaigns',standHrs:0.1,coffee:2.8,salary:'$35k-150k'},
    'sales':        {cat:'Sales / Real Estate',icon:'ğŸ¤',hrsWeek:45,meetPct:0.10,retireAge:62,stress:'high',global:20000000,fact:'You\'ll hear "no" approximately 200,000 times â€” and keep going',standHrs:0.3,coffee:2.5,salary:'$30k-200k+'},
    'retail':       {cat:'Retail / Cashier',icon:'ğŸ›’',hrsWeek:38,meetPct:0.03,retireAge:60,stress:'moderate',global:150000000,fact:'You\'ll say "How can I help you?" approximately 250,000 more times',standHrs:0.8,coffee:1.8,salary:'$20k-45k'},
    'journalist':   {cat:'Journalism',icon:'ğŸ“°',hrsWeek:45,meetPct:0.08,retireAge:65,stress:'high',global:5000000,fact:'You\'ll write approximately 8 million more words professionally',standHrs:0.15,coffee:3.5,salary:'$30k-100k'},
    'editor':       {cat:'Editing / Content',icon:'âœï¸',hrsWeek:40,meetPct:0.08,retireAge:67,stress:'moderate',global:4000000,fact:'You\'ll fix approximately 3 million typos and grammatical errors',standHrs:0.05,coffee:3.0,salary:'$35k-90k'},
    'chef':         {cat:'Chef / Culinary',icon:'ğŸ‘¨â€ğŸ³',hrsWeek:50,meetPct:0.02,retireAge:58,stress:'very high',global:15000000,fact:'You\'ll chop approximately 200,000 kg of ingredients in your career',standHrs:0.85,coffee:4.0,salary:'$25k-100k'},
    'barista':      {cat:'Barista / Bartender',icon:'â˜•',hrsWeek:36,meetPct:0.01,retireAge:55,stress:'moderate',global:10000000,fact:'You\'ll make approximately 500,000 drinks â€” you probably make them in your sleep by now',standHrs:0.9,coffee:5.0,salary:'$18k-40k'},
    'waiter':       {cat:'Waiter / Hospitality',icon:'ğŸ½ï¸',hrsWeek:38,meetPct:0.01,retireAge:55,stress:'moderate',global:40000000,fact:'You\'ll walk an extra 20,000 km on shift â€” like walking halfway around Earth',standHrs:0.9,coffee:2.0,salary:'$18k-50k'},
    'hotel':        {cat:'Hotel / Tourism',icon:'ğŸ¨',hrsWeek:42,meetPct:0.05,retireAge:60,stress:'moderate',global:20000000,fact:'You\'ll greet approximately 200,000 guests with a smile (even on bad days)',standHrs:0.6,coffee:2.5,salary:'$22k-70k'},
    'construction': {cat:'Construction',icon:'ğŸ”¨',hrsWeek:45,meetPct:0.02,retireAge:58,stress:'high',global:120000000,fact:'You\'ll lift the equivalent of 5 million kg over your remaining career',standHrs:0.85,coffee:2.0,salary:'$25k-80k'},
    'electrician':  {cat:'Electrician / Plumber',icon:'ğŸ”§',hrsWeek:42,meetPct:0.02,retireAge:60,stress:'moderate',global:15000000,fact:'You\'ll wire enough cable to stretch from your city to the next country',standHrs:0.8,coffee:2.2,salary:'$30k-85k'},
    'mechanic':     {cat:'Mechanic / Technician',icon:'ğŸ”§',hrsWeek:44,meetPct:0.02,retireAge:60,stress:'moderate',global:18000000,fact:'You\'ll fix approximately 15,000 more machines that humans somehow broke',standHrs:0.7,coffee:2.0,salary:'$28k-75k'},
    'carpenter':    {cat:'Carpenter / Trades',icon:'ğŸªš',hrsWeek:42,meetPct:0.02,retireAge:58,stress:'moderate',global:10000000,fact:'Things you build with your hands will shelter families for generations',standHrs:0.85,coffee:2.0,salary:'$28k-70k'},
    'driver':       {cat:'Driver / Trucker',icon:'ğŸš›',hrsWeek:48,meetPct:0.01,retireAge:58,stress:'moderate',global:30000000,fact:'You\'ll drive further for work than most astronauts travel in space',standHrs:0.05,coffee:3.5,salary:'$25k-70k'},
    'pilot':        {cat:'Pilot / Aviation',icon:'âœˆï¸',hrsWeek:40,meetPct:0.05,retireAge:60,stress:'high',global:800000,fact:'You\'ll fly the equivalent of 100+ trips around Earth in your career',standHrs:0.1,coffee:3.0,salary:'$60k-250k'},
    'delivery':     {cat:'Delivery / Courier',icon:'ğŸ“¦',hrsWeek:42,meetPct:0.01,retireAge:58,stress:'moderate',global:25000000,fact:'You\'ll deliver to approximately 500,000 doorsteps',standHrs:0.4,coffee:2.5,salary:'$22k-50k'},
    'musician':     {cat:'Music / DJ',icon:'ğŸµ',hrsWeek:35,meetPct:0.03,retireAge:70,stress:'moderate',global:10000000,fact:'You\'ll practice for approximately 20,000 more hours â€” hello, mastery',standHrs:0.4,coffee:2.0,salary:'$15k-100k+'},
    'actor':        {cat:'Actor / Performer',icon:'ğŸ­',hrsWeek:35,meetPct:0.05,retireAge:70,stress:'high',global:3000000,fact:'You\'ll pretend to be someone else for more hours than you spend being yourself at work',standHrs:0.6,coffee:2.0,salary:'$15k-200k+'},
    'athlete':      {cat:'Sports / Coaching',icon:'âš½',hrsWeek:38,meetPct:0.03,retireAge:55,stress:'high',global:12000000,fact:'Your body endures 3Ã— more physical stress than the average worker',standHrs:0.8,coffee:1.2,salary:'$20k-500k+'},
    'fitness':      {cat:'Fitness / Personal Training',icon:'ğŸ’ª',hrsWeek:36,meetPct:0.02,retireAge:58,stress:'moderate',global:5000000,fact:'You\'ll demonstrate approximately 500,000 exercises and count a million reps',standHrs:0.85,coffee:1.5,salary:'$20k-70k'},
    'farmer':       {cat:'Agriculture / Farming',icon:'ğŸŒ¾',hrsWeek:55,meetPct:0.01,retireAge:70,stress:'moderate',global:880000000,fact:'You work in the world\'s largest profession â€” nearly 1 billion people worldwide',standHrs:0.9,coffee:1.5,salary:'$15k-80k'},
    'police':       {cat:'Police / Detective',icon:'ğŸš”',hrsWeek:44,meetPct:0.06,retireAge:55,stress:'very high',global:15000000,fact:'You\'ll interact with approximately 100,000 people in the line of duty',standHrs:0.5,coffee:3.5,salary:'$35k-100k'},
    'military':     {cat:'Military / Security',icon:'ğŸ›¡ï¸',hrsWeek:50,meetPct:0.05,retireAge:52,stress:'very high',global:27000000,fact:'Your job demands peak physical and mental condition â€” less than 1% of people qualify',standHrs:0.6,coffee:3.0,salary:'$25k-120k'},
    'firefighter':  {cat:'Firefighter / Paramedic',icon:'ğŸš’',hrsWeek:48,meetPct:0.03,retireAge:55,stress:'very high',global:4000000,fact:'You\'ll save an estimated 300+ lives directly in your career',standHrs:0.7,coffee:3.0,salary:'$30k-85k'},
    'social_worker':{cat:'Social Work / NGO',icon:'ğŸ’š',hrsWeek:40,meetPct:0.10,retireAge:63,stress:'high',global:6000000,fact:'You\'ll positively impact approximately 10,000 lives in your career',standHrs:0.3,coffee:2.5,salary:'$28k-60k'},
    'civil_servant':{cat:'Government / Civil Service',icon:'ğŸ›ï¸',hrsWeek:38,meetPct:0.15,retireAge:63,stress:'moderate',global:50000000,fact:'Your work affects policy for millions of citizens â€” even if it feels like paperwork',standHrs:0.1,coffee:2.5,salary:'$30k-100k'},
    'entrepreneur': {cat:'Entrepreneur / Startup',icon:'ğŸš€',hrsWeek:60,meetPct:0.20,retireAge:70,stress:'very high',global:600000000,fact:'You\'ll work 60+ hour weeks â€” but you\'ll never feel like you\'re "working for someone else"',standHrs:0.2,coffee:4.0,salary:'$0-âˆ'},
    'freelancer':   {cat:'Freelancer / Self-employed',icon:'ğŸ ',hrsWeek:40,meetPct:0.08,retireAge:68,stress:'moderate',global:300000000,fact:'You\'ll send approximately 20,000 invoices and chase 5,000 late payments',standHrs:0.15,coffee:3.5,salary:'varies'},
    'homemaker':    {cat:'Homemaker / Caregiver',icon:'ğŸ¡',hrsWeek:52,meetPct:0.0,retireAge:75,stress:'high',global:500000000,fact:'If paid market rate for all tasks (cooking, cleaning, teaching, nursing), you\'d earn ~$180k/year',standHrs:0.7,coffee:2.0,salary:'unpaid (worth ~$180k)'},
    'retired':      {cat:'Retired',icon:'ğŸŒ…',hrsWeek:0,meetPct:0.0,retireAge:0,stress:'low',global:750000000,fact:'Congratulations â€” you have approximately 90,000 hours of free time ahead',standHrs:0.3,coffee:2.0,salary:'pension'},
    'other':        {cat:'General Profession',icon:'ğŸ’¼',hrsWeek:40,meetPct:0.08,retireAge:65,stress:'moderate',global:null,fact:'You\'ll spend roughly a third of your waking life at work',standHrs:0.3,coffee:2.5,salary:'varies'},
  };

  const jobProfile = JOB_DB[job] || JOB_DB['other'];
  const jobLabel = document.getElementById('f-job').selectedOptions[0].text;

  const workYrs = Math.max(0, jobProfile.retireAge - Math.max(age, 22));
  const weeklyHrs = jobProfile.hrsWeek;
  const workWeeks = workYrs * 52;
  const workHrs = workWeeks * weeklyHrs;
  const mondaysLeft = workWeeks;
  const meetingHrs = Math.round(workHrs * jobProfile.meetPct);
  const standingHrs = Math.round(workHrs * jobProfile.standHrs);
  const sittingHrs = workHrs - standingHrs;
  const coffeeTotal = Math.round(workYrs * 260 * jobProfile.coffee);
  const commuteHrs = Math.round(workYrs * 260 * 0.83);

  // â•â•â• FOOD & DRINK (personalized with BMR, exercise, cooking, job) â•â•â•
  // Harris-Benedict BMR based on YOUR weight, height, age, gender
  const bmr = gender==='male'
    ? Math.round(88.362 + 13.397*weight + 4.799*height - 5.677*age)
    : Math.round(447.593 + 9.247*weight + 3.098*height - 4.330*age);
  // Activity multiplier from YOUR exercise frequency
  const activityMult = exercise===0?1.2:exercise<=2?1.375:exercise<=4?1.55:1.725;
  const tdee = Math.round(bmr * activityMult); // your daily calorie needs
  const totalCaloriesEaten = tdee * daysAlive;
  const foodKgPerYear = Math.round(tdee / 1800 * (gender==='male'?900:730)); // scaled to your TDEE
  const foodKgLife = foodKgPerYear * age;
  const foodKgLeft = foodKgPerYear * yrsLeft;
  // Water needs scale with YOUR weight: ~35ml per kg body weight
  const waterLitersDay = Math.round(weight * 35) / 1000;
  const waterLitersLife = waterLitersDay * daysAlive;
  const waterLitersLeft = waterLitersDay * yrsLeft * 365;
  const sugarKgYear = 24;
  const sugarKgLife = sugarKgYear * age;
  const chickenPerYear = 27;
  const eggsPerYear = 150;
  const pizzaSlicesLife = age * 46;
  const teaspoonsSaltLife = age * 365 * 1.5;
  // Cooking: YOUR homemade meals per week directly drives this
  const homeMealsPct = Math.round(homeMealsPerWeek / 21 * 100); // 21 = 3 meals Ã— 7 days
  const takeoutMealsPerWeek = 21 - homeMealsPerWeek;
  const costPerHomeMeal = 4; // ~$4 avg ingredient cost
  const costPerTakeout = 15; // ~$15 avg restaurant/takeout
  const weeklyFoodCost = homeMealsPerWeek * costPerHomeMeal + takeoutMealsPerWeek * costPerTakeout;
  const weeklyFoodCostAllTakeout = 21 * costPerTakeout;
  const cookSavingsPerYear = Math.round((weeklyFoodCostAllTakeout - weeklyFoodCost) * 52);
  const cookSavedLife = cookSavingsPerYear * Math.max(0, age - 16);
  const cookSavings = {no:0, basic:1500, good:3500, pro:5500};
  const mealsCookedSelf = Math.round(homeMealsPerWeek * 52 * Math.max(0, age - 10));
  const takeoutMealsLife = Math.round(takeoutMealsPerWeek * 52 * Math.max(0, age - 10));

  // â•â•â• SCREEN TIME (personalized with job, generation, chronotype) â•â•â•
  // Work screen time based on YOUR job type
  const deskJobs = ['software_dev','data_analyst','designer','writer','marketing','finance','hr','legal','consultant','project_manager','product_manager','accountant','admin','customer_service','researcher','economist'];
  const isDesk = deskJobs.includes(job);
  const workScreenHrs = isDesk ? Math.min(workHrsPerDay, workHrsPerDay) : Math.max(1, workHrsPerDay * (1 - (jobProfile ? jobProfile.standHrs : 0.5)));
  // Personal screen time based on YOUR generation
  const genScreenHrs = bY>=1997?4.5:bY>=1981?3.5:bY>=1965?2.5:1.5;
  // Night owls get +0.5 hrs late-night scrolling
  const chronoBonus = chronotype==='night'?0.5:0;
  const genLabel = bY>=1997?'Gen Z':bY>=1981?'Millennial':bY>=1965?'Gen X':'Boomer';
  const screenHrsDay = Math.round((workScreenHrs + genScreenHrs + chronoBonus)*10)/10;
  const screenHrsLife = Math.round(screenHrsDay * daysAlive);
  const screenYrsLife = (screenHrsLife / 8760).toFixed(1);
  const phoneTouchesDay = bY>=1997?3200:bY>=1981?2617:bY>=1965?1800:1000; // YOUR generation's phone habits
  const phoneTouchesLife = phoneTouchesDay * daysAlive;
  const scrollMilesLife = Math.round((bY>=1997?120:bY>=1981?90:bY>=1965?50:20) * Math.max(0,age-(bY>=1997?10:bY>=1981?20:30)));
  const workScreenTotal = Math.round(workScreenHrs * (jobProfile ? (age-(jobProfile.retireAge>age?18:0)) : Math.max(0,age-18)) * 250); // work days

  // â•â•â• YOUR AGE ON OTHER PLANETS â•â•â•
  const mercuryAge = (age / 0.24).toFixed(1);
  const venusAge = (age / 0.62).toFixed(1);
  const marsAge = (age / 1.88).toFixed(1);
  const jupiterAge = (age / 11.86).toFixed(1);
  const saturnAge = (age / 29.46).toFixed(1);
  const neptuneAge = (age / 164.8).toFixed(2);

  // â•â•â• BODY FLUIDS & PRODUCTION (personalized with weight, height, exercise) â•â•â•
  // YOUR blood volume: ~70ml per kg of body weight
  const bloodVolumeLiters = (weight * 70 / 1000).toFixed(1);
  const salivaLiters = age * 365 * 1;
  const tearsLiters = gender==='female' ? age * 0.09 : age * 0.06; // women produce ~50% more emotional tears
  const bloodPumped = daysAlive * 7571;
  const swimPoolSize = 50000;
  const poolsFilled = (bloodPumped / swimPoolSize).toFixed(0);
  // YOUR skin surface area (DuBois formula) using YOUR height + weight
  const skinAreaM2 = (0.007184 * Math.pow(height, 0.725) * Math.pow(weight, 0.425)).toFixed(2);
  const skinAreaBedSheets = (parseFloat(skinAreaM2) / 3.7).toFixed(1); // king bed sheet ~3.7mÂ²
  // Sweat: YOUR exercise adds significant sweat production
  const restSweatLDay = 0.5; // 0.5L/day at rest
  const exerciseSweatL = exercise * 1.0; // ~1L per workout hour
  const totalSweatLife = Math.round((restSweatLDay * daysAlive) + (exerciseSweatL * 52 * Math.max(0,age-16)));
  // Urine: YOUR coffee intake increases output (coffee is a mild diuretic)
  const urineBaseL = 1.5; // liters/day
  const urineCoffeeBonus = myCoffee * 0.15; // each coffee adds ~150ml
  const urineTotalLife = Math.round((urineBaseL + urineCoffeeBonus) * daysAlive);

  // â•â•â• SOCIAL NETWORK / PEOPLE (personalized with job, city, languages, family) â•â•â•
  const dunbarNumber = 150;
  const closeCircle = 5;
  const casualFriends = 50;
  const acquaintances = 1500;
  // YOUR job determines social exposure: teachers/doctors/salespeople meet way more
  const socialJobs = {teacher:120,doctor:50,nurse:40,dentist:30,salesperson:80,lawyer:35,marketing:45,hr:60,customer_service:70,retail:50,restaurant:40,bartender:60,pilot:30,police:25,firefighter:15,real_estate:40};
  const jobPeoplePerWeek = socialJobs[job] || (isDesk ? 15 : 25);
  // YOUR city size affects random encounters
  const cityPopFactor = ci ? Math.min(2.0, Math.max(0.5, ci.population / 1000000)) : 1.0;
  // YOUR friend days add social encounters beyond work
  const friendPeoplePerWeek = friendDaysPerWeek * 4; // ~4 people per social outing
  const totalPeoplePerWeek = jobPeoplePerWeek + friendPeoplePerWeek;
  const peopleMet = Math.round(totalPeoplePerWeek * 52 * Math.max(0,age-5) * cityPopFactor);
  // Friend time calculations
  const friendHoursPerWeek = friendDaysPerWeek * 3.5; // ~3.5h per hangout
  const friendHoursLife = Math.round(friendHoursPerWeek * 52 * Math.max(0, age - 5));
  const friendHoursLeft = Math.round(friendHoursPerWeek * 52 * yrsLeft);
  // Isolation risk
  const sociallyActive = friendDaysPerWeek >= 2;
  // YOUR languages expand your social reach
  const langReach = languages * 1500000000; // each language ~1.5B speakers potential
  const handshakes = Math.round(age * 365 * (isDesk ? 3 : 1.5));
  const conversations = Math.round(daysAlive * (jobPeoplePerWeek > 40 ? 10 : 6));
  const wordsSpoken = daysAlive * 16000;
  const wordsHeard = daysAlive * 20000;
  const timeLaughed = Math.round(age * 365 * 6 / 60);
  // YOUR family + kids expand your network
  const familyNetwork = 2 + siblings + kids * 20; // each kid brings ~20 parent contacts via school
  const hugsGiven = Math.round(age * 365 * (relationship==='married'||relationship==='dating' ? 3 : kids>0 ? 4 : 1));
  const photosOf = Math.round(age > 15 ? (age - 15) * 2000 + 500 : age * 50);
  const degreesReach = [dunbarNumber, dunbarNumber**2, dunbarNumber**3, dunbarNumber**4, dunbarNumber**5, dunbarNumber**6];
  const knownByEstimate = Math.round(peopleMet * 0.3);

  // â•â•â• COMPUTER SCIENCE / YOUR DIGITAL SELF â•â•â•
  // Name as data
  const nameBytes = new TextEncoder().encode(name).length;
  const nameBits = nameBytes * 8;
  const nameBinary = Array.from(name).map(c => c.charCodeAt(0).toString(2).padStart(8,'0')).join(' ');
  const ageBinary = age.toString(2);
  const ageHex = '0x' + age.toString(16).toUpperCase();
  const ageOctal = '0o' + age.toString(8);

  // Simple hash of name (djb2)
  let nameHash = 5381;
  for(let i=0;i<name.length;i++) nameHash = ((nameHash << 5) + nameHash) + name.charCodeAt(i);
  nameHash = Math.abs(nameHash) >>> 0;
  const nameHashHex = '0x' + nameHash.toString(16).toUpperCase().padStart(8,'0');

  // DNA as storage: 3.2 billion base pairs Ã— 2 bits each = 800 MB
  // But with compression it's ~4MB (99.9% shared between humans)
  const dnaStorageMB = 800;
  const dnaCompressedMB = 4;
  const dnaUniqueKB = Math.round(uniqueBasePairs * 2 / 8 / 1024); // unique bits as KB

  // Brain storage and processing
  const brainStoragePB = 2.5; // ~2.5 petabytes estimated
  const brainStorageTB = 2500;
  const brainOpsPerSec = 1e16; // ~10 quadrillion operations/sec
  const brainWatts = 20; // brain uses ~20 watts
  const supercomputerWatts = 30000000; // Frontier uses ~21MW for similar ops
  const brainEfficiency = Math.round(supercomputerWatts / brainWatts);

  // Your life as data
  const wordsSpokenMB = (wordsSpoken * 5 / 1000000).toFixed(0); // ~5 bytes per word avg
  const photosGB = (photosOf * 4 / 1000).toFixed(1); // ~4MB per photo avg
  const memoryEventsLife = Math.round(daysAlive * 50); // ~50 memorable moments/day stored
  const neuronFiringsLife = daysAlive * 86400 * 1e11; // ~100 billion neurons, ~1 fire/sec avg

  // Your life as a program
  const heartbeatsAsClockSpeed = (100000/86400).toFixed(2); // heartbeats per second â‰ˆ Hz
  const breathsAsCycles = (23040/86400).toFixed(3); // breaths per second
  const cellsAsRAM = (cellsInBody * 1e-9).toFixed(1); // if each cell was 1 byte
  
  // IP addresses / passwords
  const passwordsLife = Math.max(0, (age-12)) * 15; // ~15 passwords/year since age 12
  const totalLogins = Math.max(0, (age-12)) * 365 * 8; // ~8 logins/day
  const emailsSent = Math.max(0, (age-15)) * 365 * 12; // ~12/day since age 15
  const googlesLife = Math.max(0, (age-12)) * 365 * 4; // ~4 searches/day

  // Blood type rarity
  const bloodRarity = {
    'O+': {pct:37.4, canGiveTo:'O+, A+, B+, AB+', canReceiveFrom:'O+, Oâˆ’', universal:false, fact:'Most common blood type in the world'},
    'O-': {pct:6.6, canGiveTo:'Everyone (universal donor!)', canReceiveFrom:'Oâˆ’ only', universal:true, fact:'Universal donor â€” your blood can save anyone\'s life'},
    'A+': {pct:35.7, canGiveTo:'A+, AB+', canReceiveFrom:'A+, Aâˆ’, O+, Oâˆ’', universal:false, fact:'Second most common â€” you\'re in good company'},
    'A-': {pct:6.3, canGiveTo:'A+, Aâˆ’, AB+, ABâˆ’', canReceiveFrom:'Aâˆ’, Oâˆ’', universal:false, fact:'Rare and valuable for emergencies'},
    'B+': {pct:8.5, canGiveTo:'B+, AB+', canReceiveFrom:'B+, Bâˆ’, O+, Oâˆ’', universal:false, fact:'Less than 1 in 12 people share your blood type'},
    'B-': {pct:1.5, canGiveTo:'B+, Bâˆ’, AB+, ABâˆ’', canReceiveFrom:'Bâˆ’, Oâˆ’', universal:false, fact:'Only 1.5% of people have this â€” incredibly rare'},
    'AB+': {pct:3.4, canGiveTo:'AB+ only', canReceiveFrom:'Everyone (universal receiver!)', universal:false, fact:'Universal receiver â€” you can receive from anyone'},
    'AB-': {pct:0.6, canGiveTo:'AB+, ABâˆ’', canReceiveFrom:'Aâˆ’, Bâˆ’, ABâˆ’, Oâˆ’', universal:false, fact:'Rarest blood type â€” only 1 in 167 people'},
    'unknown': {pct:0, canGiveTo:'', canReceiveFrom:'', universal:false, fact:'Consider getting tested â€” it could save your life or someone else\'s'},
  };
  const myBlood = bloodRarity[blood] || bloodRarity['unknown'];
  const bloodPeopleSame = blood !== 'unknown' ? Math.round(WORLD_POP * myBlood.pct / 100) : 0;

  // Handedness
  const handPct = hand === 'left' ? 10 : hand === 'ambidextrous' ? 1 : 89;
  const handPeople = Math.round(WORLD_POP * handPct / 100);
  const handFacts = {
    'left': 'Left-handers are more likely to be creative, excel in sports like baseball and tennis, and 6 US presidents were lefties',
    'right': 'Right-hand dominance is controlled by the left brain hemisphere â€” the same side that handles language and logic',
    'ambidextrous': 'Only ~1% of people are truly ambidextrous â€” you\'re in an extremely exclusive club',
  };

  // Eye color rarity
  const eyeRarity = {
    'brown': {pct:70, fact:'The original human eye color â€” every blue-eyed person shares a single ancestor from ~10,000 years ago'},
    'blue':  {pct:8, fact:'Caused by a genetic mutation ~10,000 years ago near the Black Sea â€” every blue-eyed person is distantly related'},
    'green': {pct:2, fact:'The rarest common eye color â€” caused by a unique combination of melanin and Rayleigh scattering of light'},
    'hazel': {pct:5, fact:'Your eye color can appear to change depending on lighting â€” a mix of brown and green pigments'},
    'gray':  {pct:3, fact:'Even rarer than green â€” gray eyes have almost no melanin and scatter light differently'},
    'amber': {pct:5, fact:'Sometimes called "wolf eyes" â€” caused by the pigment lipochrome, also found in wolves and eagles'},
  };
  const myEyes = eyeRarity[eyes] || eyeRarity['brown'];
  const eyePeopleSame = Math.round(WORLD_POP * myEyes.pct / 100);

  // Sleep calculations with personal sleep hours
  const actualSleepYrs = (sleepHrs * daysAlive / 8760).toFixed(1);
  const idealSleepHrs = 8;
  const sleepDiff = sleepHrs - idealSleepHrs;
  const sleepDebtHrs = sleepDiff < 0 ? Math.round(Math.abs(sleepDiff) * daysAlive) : 0;
  const sleepExcessHrs = sleepDiff > 0 ? Math.round(sleepDiff * daysAlive) : 0;
  const dreamsPerNight = sleepHrs >= 7 ? 5 : sleepHrs >= 5 ? 3 : 2;
  const totalDreams = dreamsPerNight * daysAlive;

  // Languages
  const langPcts = { 1: 60, 2: 25, 3: 10, 4: 3, 5: 1.5 }; // % of world population
  const langPct = langPcts[Math.min(languages, 5)] || 0.5;
  const avgWordsPerLang = 20000; // active vocabulary per language
  const totalVocabulary = languages * avgWordsPerLang;
  const polyglotLevel = languages >= 6 ? 'hyperpolyglot' : languages >= 4 ? 'polyglot' : languages >= 3 ? 'trilingual' : languages >= 2 ? 'bilingual' : 'monolingual';

  // Glasses
  const glassesPct = 75; // ~75% of adults use some vision correction
  const myopiaPct = 34; // ~34% of world is myopic, rising fast
  const correctedVisionFact = glasses === 'yes'
    ? 'Without modern optics, you\'d be at a serious survival disadvantage just 500 years ago'
    : 'You have naturally good vision â€” only about 25% of adults need no correction at all';

  // Coffee (personal input now!)
  const myCoffeeLifetime = Math.round(myCoffee * age * 365);
  const myCoffeeLeft = Math.round(myCoffee * yrsLeft * 365);
  const coffeineMg = myCoffee * 95; // ~95mg per cup
  const coffeineLifetimeKg = (coffeineMg * age * 365 / 1000000).toFixed(1);
  const coffeeWaterLiters = Math.round(myCoffeeLifetime * 0.14); // ~140ml per cup
  const coffeeBathtubs = (coffeeWaterLiters / 300).toFixed(0);
  const coffeeCostLifetime = Math.round(myCoffeeLifetime * 3.5); // ~$3.50 avg global

  // Pets
  const petYearsJoy = pets * age * 0.5;
  const petHeartbeatsShared = Math.round(petYearsJoy * 365 * 24 * 60 * 120);
  // YOUR exercise habit affects walk frequency
  const petWalksPerDay = exercise >= 3 ? 2.5 : exercise >= 1 ? 1.5 : 1.0;
  const petWalks = Math.round(petYearsJoy * 365 * petWalksPerDay);
  // YOUR sleep disruption from pets
  const petSleepDisrupt = pets > 0 ? Math.round(petYearsJoy * 365 * 0.3) : 0; // ~53% say pets wake them, ~20 min lost
  // YOUR weight vs pet: can you carry them?
  const avgPetKg = 15; // medium dog
  const petWeightRatio = (weight / avgPetKg).toFixed(0);
  // YOUR kids + pets
  const kidsWithPets = kids > 0 && pets > 0;
  // YOUR chronotype affects walk schedule
  const petWalkTime = chronotype==='early' ? 'sunrise walks' : chronotype==='night' ? 'late-night walks' : 'regular walks';

  // â•â•â• RELATIONSHIP (personalized with chronotype, job, languages, sleep, kids) â•â•â•
  const relStatus = {
    'single': {pct:40,emoji:'ğŸ’”',label:'Single',funFact:'You have complete control of the TV remote, the thermostat, and the entire bed'},
    'dating': {pct:25,emoji:'ğŸ’•',label:'In a relationship',funFact:'Couples in relationships say "I love you" an average of 1,424 times per year'},
    'married':{pct:30,emoji:'ğŸ’',label:'Married',funFact:'Married couples argue an average of 312 times per year â€” top topics: chores, money, and what to eat for dinner'},
    'divorced':{pct:4,emoji:'ğŸ“‹',label:'Divorced',funFact:'You survived one of the most stressful life events â€” studies rank it #2 after death of a spouse'},
    'widowed':{pct:1,emoji:'ğŸ•Šï¸',label:'Widowed',funFact:'Your shared memories are a testament to a life lived together'},
    'complicated':{pct:15,emoji:'ğŸ¤·',label:'It\'s complicated',funFact:'40% of people say their relationship status is "hard to define" â€” you\'re not alone'},
  };
  const rel = relStatus[relationship] || relStatus['single'];

  const inRel = relationship==='married'||relationship==='dating';
  const relYears = relDuration > 0 ? relDuration : (inRel ? Math.min(age-18, age*0.3) : 0);
  const relDays = Math.round(relYears * 365);
  const avgKissesPerDay = inRel ? 5 : 0.5;
  const kissesInRel = Math.round(avgKissesPerDay * relDays);
  const kissesLifetime = Math.round(avgKissesPerDay * daysAlive);
  const argumentsPerYear = relationship==='married' ? 312 : relationship==='dating' ? 156 : 0;
  const argumentsInRel = Math.round(argumentsPerYear * relYears);
  const argumentsLifetime = argumentsInRel;
  const dateNights = inRel ? Math.round(relYears * (relationship==='married' ? 26 : 52)) : 0;
  const iLoveYous = inRel ? Math.round(relYears * 1424) : 0;
  const textingPartnerHrs = inRel ? Math.round(relYears * 365 * 0.5) : 0;
  const relHoursShared = Math.round(relYears * 365 * (relationship==='married' ? 12 : 6));
  const relHoursLeft = inRel ? Math.round(yrsLeft * 365 * (relationship==='married' ? 12 : 6)) : 0;
  const singleYears = Math.max(0, (age - 16) - relYears);
  const pctAdultLifeInRel = age > 16 ? Math.round(relYears / Math.max(1, age - 16) * 100) : 0;
  // YOUR chronotype compatibility
  const chronoRelFact = inRel && chronotype==='night' ? 'Mismatched chronotypes argue 2Ã— more â€” night owls often clash with early-bird partners' :
    inRel && chronotype==='early' ? 'Early birds tend to be more satisfied in relationships â€” you get productive mornings while they sleep' : '';
  // YOUR job affects quality time
  const workHrsWeek = workHrsPerDay * 5;
  const qualityTimeHrsWeek = inRel ? Math.max(5, 168 - workHrsWeek - sleepHrs*7 - exercise - 35) * 0.4 : 0; // ~40% of free time with partner
  const qualityTimeYearHrs = Math.round(qualityTimeHrsWeek * 52);
  // YOUR languages in relationship
  const bilingualRelFact = inRel && languages >= 2 ? 'Bilingual couples switch languages during arguments â€” it literally changes the emotional register' : '';
  // YOUR sleep: shared bed stats
  const sharedBedSleepLoss = inRel ? Math.round(Math.min(age-18,age*0.4) * 365 * 0.4) : 0; // ~24 min/night lost sharing a bed
  // YOUR kids change the relationship
  const kidsRelFact = inRel && kids > 0 ? 'Relationship satisfaction dips after kids but rebounds â€” you\'re in the trenches, but it gets better' : '';

  // â•â•â• KIDS â•â•â•
  const diapersPerKid = 7300; // ~7,300 diapers per kid (birth to ~2.5yrs)
  const totalDiapers = kids * diapersPerKid;
  const sleepLostPerKid = 1095; // ~3 years of broken sleep per kid (first year especially)
  const totalSleepLostHrs = kids * sleepLostPerKid;
  const questionsPerDay = 300; // kids ask ~300 questions/day between ages 2-5
  const totalQuestions = kids * questionsPerDay * 365 * 3; // ~3 years of peak questioning
  const moneyPerKid = 310000; // avg cost to raise a child to 18 in developed world (~$310k)
  const mealsCooked = kids * 18 * 365 * 2; // 2 meals/day for 18 years

  // â•â•â• EXERCISE â•â•â•
  const gymDaysPerWeek = exercise;
  const gymSessionMinutes = 60;
  const gymHoursLife = Math.round(gymDaysPerWeek * gymSessionMinutes / 60 * 52 * Math.max(0, age - 16));
  const gymHoursLeft = Math.round(gymDaysPerWeek * gymSessionMinutes / 60 * 52 * yrsLeft);
  const caloriesBurnedPerSession = 400;
  const totalCaloriesBurned = gymDaysPerWeek * caloriesBurnedPerSession * 52 * Math.max(0, age - 16);
  const pizzaEquiv = Math.round(totalCaloriesBurned / 285); // 285 cal per pizza slice
  const weightLiftedEstimate = gymDaysPerWeek >= 2 ? Math.round(gymDaysPerWeek * 2000 * 52 * Math.max(0, age - 16)) : 0; // ~2000kg per session
  // Life expectancy bonus from exercise
  const exerciseLifeBonus = gymDaysPerWeek === 0 ? 0 : gymDaysPerWeek <= 2 ? 2.5 : gymDaysPerWeek <= 4 ? 4.2 : 4.5; // years added

  // â•â•â• ALCOHOL â•â•â•
  const drinksPerWeek = {never:0, rarely:0.2, social:2, regular:4, daily:7};
  const weeklyDrinks = drinksPerWeek[alcohol] || 0;
  const drinkingYears = Math.max(0, age - 18);
  const totalDrinksLife = Math.round(weeklyDrinks * 52 * drinkingYears);
  const alcoholCalories = totalDrinksLife * 150; // ~150 cal per drink avg
  const alcoholCostLife = Math.round(totalDrinksLife * 8); // ~$8 per drink avg (bar price)
  const alcoholLiters = (totalDrinksLife * 0.33).toFixed(0); // ~330ml per drink
  const pureAlcoholLiters = (totalDrinksLife * 0.33 * 0.05).toFixed(1); // ~5% ABV avg

  // â•â•â• SMOKING (cigarettes per day input) â•â•â•
  const isSmoker = cigsPerDay > 0;
  const smokingYears = isSmoker ? Math.max(0, age - 18) : 0;
  const totalCigsLife = cigsPerDay * 365 * smokingYears;
  const smokingCostLife = Math.round(totalCigsLife * 0.5); // ~$0.50 per cigarette avg
  const minutesLostSmoking = totalCigsLife * 11; // 11 min lost per cigarette (BMJ)
  const daysLostSmoking = Math.round(minutesLostSmoking / 1440);
  const yearsLostSmoking = (daysLostSmoking / 365).toFixed(1);
  const tarGrams = Math.round(totalCigsLife * 0.012 * 1000) / 1000; // ~12mg tar per cigarette
  const packsPerDay = (cigsPerDay / 20).toFixed(1);
  const smoking = cigsPerDay >= 10 ? 'yes' : cigsPerDay >= 1 ? 'social' : 'never'; // for backward compat

  // â•â•â• CHRONOTYPE â•â•â•
  const chronoData = {
    'early': {pct:25, emoji:'ğŸŒ…', label:'Early Bird', peakHrs:'9 AM - 12 PM', 
      fact:'Early birds earn 4-5% higher salaries on average and report higher life satisfaction. You\'ve seen more sunrises than 75% of people.',
      extraSunrises: Math.round(age * 365 * 0.7)},
    'night': {pct:25, emoji:'ğŸ¦‰', label:'Night Owl', peakHrs:'9 PM - 1 AM',
      fact:'Night owls tend to have higher IQs, more creativity, and better humor. The downside? Society is designed for morning people.',
      extraSunrises: Math.round(age * 365 * 0.1)},
    'neither': {pct:50, emoji:'ğŸ•', label:'Neither', peakHrs:'varies',
      fact:'You\'re a "third bird" â€” neither morning nor night dominant. You adapt to whatever schedule life throws at you.',
      extraSunrises: Math.round(age * 365 * 0.3)},
  };
  const chrono = chronoData[chronotype] || chronoData['neither'];
  const lateNightHours = chronotype === 'night' ? Math.round(age * 365 * 3) : Math.round(age * 365 * 1); // hours past midnight

  // â•â•â• LIFE SKILLS â•â•â•
  const canSwimPct = 56; // ~56% of world can swim
  const canDrivePct = 20; // only ~20% of world has driver's license
  const drivingKmYear = canDrive === 'yes' ? 15000 : 0;
  const drivingKmLife = drivingKmYear * Math.max(0, age - 18);
  const drivingHoursLife = Math.round(drivingKmLife / 50);
  const carAccidentOdds = canDrive === 'yes' ? '1 in 107' : 'much lower as non-driver';

  // Bicycle
  const canBikePct = 51; // ~51% of world's adults can ride a bike (varies hugely)
  // bikeKmLife calculated in cosmic speed section below

  // Cooking
  const cookData = {
    'no':    {pct:20, label:'Survival mode', meals:0, fact:'You\'ve spent $0 learning knife skills but probably $10,000+ on takeout and delivery'},
    'basic': {pct:40, label:'Can feed yourself', meals:Math.round(Math.max(0,age-16)*365*0.3), fact:'You can make eggs, pasta, and exactly 4 other things â€” and that\'s enough'},
    'good':  {pct:30, label:'Solid home cook', meals:Math.round(Math.max(0,age-14)*365*0.6), fact:'You\'ve probably impressed at least a few dinner guests â€” cooking is the most underrated life skill'},
    'pro':   {pct:10, label:'Kitchen master', meals:Math.round(Math.max(0,age-12)*365*0.8), fact:'You\'re in the top 10% â€” most people can barely boil water. You could survive the apocalypse.'},
  };
  const cook = cookData[cookLevel] || cookData['no'];
  const takeoutSaved = cook.meals * 8; // ~$8 saved per home-cooked meal vs eating out

  // Musical instrument
  const instrumentPct = 15; // ~15% of adults can play an instrument
  const practiceHoursEst = instrument === 'yes' ? Math.round(Math.max(0, age-8) * 200) : 0; // ~200hrs/year if you play
  const masteryThreshold = 10000; // 10,000 hour rule (Gladwell)

  // CPR / First Aid
  const cprPct = 2.5; // only ~2.5% of the world population knows CPR
  const cprSurvivalBoost = 2.5; // CPR doubles/triples survival rate

  // Education
  const eduData = {
    'none':     {pct:14, label:'No formal education', years:0, earningMult:0.6, fact:'14% of the world\'s adults have no formal education â€” yet some of the most successful people in history were self-taught', emoji:'ğŸ“–'},
    'school':   {pct:43, label:'High School', years:12, earningMult:1.0, fact:'A high school diploma puts you ahead of 57% of the global population in formal education', emoji:'ğŸ«'},
    'bachelor': {pct:15, label:'Bachelor\'s degree', years:16, earningMult:1.65, fact:'Only 15% of the world has a degree â€” bachelor\'s holders earn 65% more on average over their lifetime', emoji:'ğŸ“'},
    'master':   {pct:3, label:'Master\'s degree', years:18, earningMult:2.0, fact:'Only 3% of humans hold a master\'s â€” you\'ve spent roughly 2 years more in classrooms than 97% of people', emoji:'ğŸ“œ'},
    'phd':      {pct:1.1, label:'PhD / Doctorate', years:22, earningMult:2.3, fact:'Only 1.1% of the world has a PhD â€” you are quite literally one in a hundred. You\'ve spent ~22 years in formal education', emoji:'ğŸ“ğŸ“'},
  };
  const edu = eduData[education] || eduData['school'];
  const eduHoursInClassrooms = edu.years * 180 * 6; // ~180 school days Ã— 6 hours/day
  const examsEstimate = edu.years * 8; // ~8 exams per year
  const homeworkHours = Math.round(edu.years * 180 * 2); // ~2hrs homework/day
  const booksForSchool = Math.round(edu.years * 8); // ~8 textbooks/year
  const eduCost = education === 'phd' ? 250000 : education === 'master' ? 80000 : education === 'bachelor' ? 50000 : education === 'school' ? 15000 : 0;

  // Tattoo
  const tattooData = {
    'no':  {count:0, pct:62, fact:'62% of adults have zero tattoos. Your skin is an unwritten canvas.'},
    '1':   {count:1, pct:22, fact:'You remember it: the nervousness, the buzz of the needle, the "is this a mistake?" followed by "I love it."'},
    '2-5': {count:3.5, pct:12, fact:'The average tattooed person has 2-3 tattoos. You\'re building a collection â€” each one a chapter of your life.'},
    '6+':  {count:8, pct:4, fact:'Only 4% of people have 6+ tattoos. Your body is a gallery. The total ink in your skin weighs approximately '+(8*0.003).toFixed(3)+' grams.'},
  };
  const tat = tattooData[tattoo] || tattooData['no'];
  const tattooNeedles = Math.round(tat.count * 150); // ~150 needle pricks per second Ã— minutes... actually just total pricks estimate
  const tattooPricks = Math.round(tat.count * 150 * 60 * 1.5); // ~150/sec Ã— 60sec Ã— 1.5hrs avg per tattoo
  const tattooInkMl = (tat.count * 3).toFixed(0); // ~3ml ink per tattoo avg
  const tattooPain = tat.count * 90; // ~90 min avg per tattoo

  // Passport / travel
  const passportPct = 15; // only ~15% of world population has ever flown
  const avgFlights = passport === 'yes' ? Math.round(Math.max(0, age-18) * 2.5) : 0; // ~2.5 flights/year
  const flightKm = avgFlights * 2500; // avg flight ~2500km
  const flightCO2 = (flightKm * 0.000255).toFixed(1); // ~255g CO2 per km of flight
  const countriesVisited = passport === 'yes' ? Math.min(Math.round(Math.max(0,age-16) * 0.8), 50) : 0; // rough estimate

  // Broken bone
  const brokenBonePct = 40; // ~40% of people break a bone by age 65
  const totalBones = 206;

  // Blood donation
  const donationPct = 3; // only ~3% of eligible people donate blood
  const livesPerDonation = 3; // each donation can save up to 3 lives

  // â•â•â• RARITY SCORE â•â•â•

  // â•â•â• YOU'RE NEVER STILL â€” COSMIC SPEED (personalized with city, height, driving, exercise) â•â•â•
  const cityLat = ci ? ci.lat : 40;
  // YOUR height adds to Earth's rotation radius (you're further from center than a shorter person)
  const earthRadiusKm = 6371;
  const heightBonusKm = (height / 100) / 1000; // your height in km
  const earthRotationSpeed = Math.round(1670 * Math.cos(cityLat * Math.PI / 180));
  // Tall person vs short person speed difference at your latitude
  const rotationSpeedDiff = ((heightBonusKm / earthRadiusKm) * earthRotationSpeed * 1000).toFixed(1); // m/h faster than ground level
  const earthOrbitSpeed = 107226;
  const solarSystemSpeed = 828000;
  const galaxySpeed = 2100000;
  const totalCosmicSpeed = earthRotationSpeed + earthOrbitSpeed + solarSystemSpeed + galaxySpeed;
  const kmTraveledCosmic = totalCosmicSpeed * hoursAlive;
  const kmSincePageLoad = Math.round(totalCosmicSpeed / 3600);
  // YOUR personal movement on top of cosmic motion
  const walkKmLife = Math.round(stepsLife * 0.0007); // from steps
  const driveKmLife = canDrive==='yes' ? Math.round(Math.max(0,age-18) * 15000) : 0;
  const bikeKmLife = canBike==='yes' ? Math.round(Math.max(0,age-10) * (exercise>=2?2000:500)) : 0;
  const personalMovementKm = walkKmLife + driveKmLife + bikeKmLife;
  // YOUR flight distance
  const flightKmLife = passport==='yes' ? Math.round(Math.max(0,age-16) * 0.8 * 3000) : 0; // avg 0.8 flights/yr, 3000km each

  // â•â•â• ANIMAL COMPARISONS â•â•â•
  const animalsByHeight = [
    {name:'Chihuahua',cm:20},{name:'domestic cat',cm:25},{name:'penguin',cm:100},
    {name:'German Shepherd',cm:65},{name:'kangaroo',cm:150},{name:'gorilla',cm:170},
    {name:'human average',cm:170},{name:'ostrich',cm:210},{name:'grizzly bear (standing)',cm:240},
    {name:'horse',cm:180},{name:'moose',cm:210},{name:'polar bear (standing)',cm:300},
    {name:'giraffe',cm:550},{name:'elephant',cm:400},{name:'T-Rex',cm:370}
  ];
  const closestHeightAnimal = animalsByHeight.reduce((best,a)=>Math.abs(a.cm-height)<Math.abs(best.cm-height)?a:best);
  const giraffeCount = (height/550).toFixed(2);
  const antStackHeight = Math.round(height*10/1.5); // ant is ~1.5mm

  const animalsByWeight = [
    {name:'hamster',kg:0.03},{name:'rabbit',kg:2},{name:'cat',kg:4.5},{name:'fox',kg:6},
    {name:'dog (medium)',kg:20},{name:'cheetah',kg:50},{name:'giant panda',kg:100},
    {name:'lion',kg:190},{name:'gorilla',kg:160},{name:'dolphin',kg:150},
    {name:'grizzly bear',kg:270},{name:'horse',kg:500},{name:'polar bear',kg:450},
    {name:'cow',kg:700},{name:'giraffe',kg:1200},{name:'hippo',kg:1500},
    {name:'elephant',kg:6000},{name:'orca',kg:5400},{name:'blue whale',kg:140000}
  ];
  const closestWeightAnimal = animalsByWeight.reduce((best,a)=>Math.abs(a.kg-weight)<Math.abs(best.kg-weight)?a:best);
  const blueWhaleCount = (weight/140000*100).toFixed(3);
  const catCount = (weight/4.5).toFixed(1);
  const goldKgValue = weight * 78000; // ~$78k per kg of gold

  // â•â•â• GENERATION & ERA â•â•â•
  let generation = '', genEmoji = '', genYears = '', genFact = '';
  if(bY >= 2013) { generation='Gen Alpha'; genEmoji='ğŸ¤–'; genYears='2013-2025'; genFact='The first generation born entirely into the smartphone era'; }
  else if(bY >= 1997) { generation='Gen Z'; genEmoji='ğŸ“±'; genYears='1997-2012'; genFact='Digital natives â€” never knew a world without the internet'; }
  else if(bY >= 1981) { generation='Millennial'; genEmoji='ğŸ’»'; genYears='1981-1996'; genFact='Witnessed the birth of social media and the smartphone revolution'; }
  else if(bY >= 1965) { generation='Gen X'; genEmoji='ğŸ“¼'; genYears='1965-1980'; genFact='The "latchkey kids" â€” grew up with MTV and the fall of the Berlin Wall'; }
  else if(bY >= 1946) { generation='Baby Boomer'; genEmoji='ğŸŒ'; genYears='1946-1964'; genFact='Shaped by post-war prosperity, moon landings, and cultural revolution'; }
  else { generation='Silent Generation'; genEmoji='ğŸ“»'; genYears='1928-1945'; genFact='Grew up during the Great Depression and World War II'; }

  // Tech that existed when you were born
  const techTimeline = [];
  if(bY < 1990) techTimeline.push('no World Wide Web');
  else techTimeline.push('the Web existed');
  if(bY < 2007) techTimeline.push('no iPhone');
  else techTimeline.push('iPhones existed');
  if(bY < 2004) techTimeline.push('no Facebook');
  if(bY < 2005) techTimeline.push('no YouTube');
  if(bY < 2008) techTimeline.push('no Bitcoin');
  if(bY < 2010) techTimeline.push('no Instagram');
  if(bY < 1995) techTimeline.push('no Google');
  if(bY < 1998) techTimeline.push('no Google');
  if(bY < 2022) techTimeline.push('no ChatGPT');
  else techTimeline.push('ChatGPT existed');

  // â•â•â• CELL REPLACEMENT / BODY VERSIONS â•â•â•
  const bodyVersions = (age / 7.5).toFixed(1); // most cells replaced every 7-10 years
  const redBloodCellLifespan = 120; // days
  const rbcReplacements = Math.round(daysAlive / redBloodCellLifespan);
  const skinReplaced = Math.round(daysAlive / 28); // skin renews ~every 28 days
  const stomachLiningDays = 5; // stomach lining every 3-5 days
  const stomachReplacements = Math.round(daysAlive / stomachLiningDays);
  const skeletonReplacements = (age / 10).toFixed(1); // skeleton every ~10 years
  const tastebudReplacements = Math.round(daysAlive / 14); // taste buds every ~2 weeks
  // Cells that DON'T replace: most neurons, heart muscle, eye lens
  const originalParts = ['most brain neurons','eye lenses','inner ear cells','some heart muscle cells'];

  // â•â•â• TIME SPENT DOING THINGS (personalized with YOUR lifestyle) â•â•â•
  const toiletVisits = daysAlive * 7;
  const toiletHrs = Math.round(toiletVisits * 5 / 60);
  const showerHrs = Math.round(daysAlive * 0.9 * 8 / 60);
  const showerLiters = Math.round(daysAlive * 0.9 * 65);
  // YOUR job: commute + meetings
  const meetingHrsLife = jobProfile ? Math.round(jobProfile.meetPct * workHrsPerDay * 5 * 52 * Math.max(0,age-18)) : 0;
  const commuteHrsLife = Math.round(Math.max(0,age-18) * 250 * (ci && ci.population > 1000000 ? 1.5 : 0.75)); // big city = longer commute
  // YOUR coffee: time making/buying it
  const coffeeTimeHrs = Math.round(myCoffee * 5 * daysAlive / 60); // 5 min per cup
  // YOUR cooking skill determines kitchen time
  const cookMinPerDay = cookLevel==='no'?0:cookLevel==='basic'?15:cookLevel==='good'?35:cookLevel==='pro'?60:0;
  const cookingHrs = Math.round(cookMinPerDay * daysAlive * 0.7 / 60); // ~70% of days
  // YOUR exercise time
  const exerciseHrsLife = Math.round(exercise * 52 * Math.max(0,age-16));
  // YOUR pets: feeding + walking
  const petCareHrs = pets > 0 ? Math.round(pets * 30 * daysAlive / 60) : 0; // ~30 min/day per pet
  // YOUR kids: time spent on parenting tasks
  const kidsTimeHrs = kids > 0 ? Math.round(kids * 2 * 365 * Math.min(18, age > 20 ? age-20 : 0)) : 0; // ~2hrs/day per kid
  // YOUR glasses: cleaning time
  const glassesHrs = glasses==='yes' ? Math.round(daysAlive * 2 / 60) : 0; // ~2 min/day
  const waitingInLineHrs = Math.round(age * 38);
  // YOUR traffic: drivers spend more time in traffic
  const stuckTrafficHrs = canDrive==='yes' ? Math.round(age * 54) : Math.round(age * 15);
  const brushingTeethHrs = Math.round(daysAlive * 2 * 2 / 60);
  const eatingHrs = Math.round(daysAlive * 3 * 20 / 60);
  const gettingDressedHrs = Math.round(daysAlive * 10 / 60);
  const lookingForStuffHrs = Math.round(age * 2.5 * 24);
  // YOUR relationship affects decision paralysis
  const decidingWhatToEat = Math.round(age * 365 * (relationship==='married'||relationship==='dating' ? 15 : 8) / 60); // couples take longer
  const cleaningHrs = Math.round(age * 52 * (kids>0 ? 4 : 2)); // kids = 2x cleaning

  // â•â•â• WHAT IF SCENARIOS â•â•â•
  const dollarPerDay = (daysAlive * 1).toFixed(0); // $1/day since birth
  const dollarCompound = Math.round(1 * (Math.pow(1 + 0.07/365, daysAlive) - 1) / (0.07/365)); // compound at 7%
  const walkSinceBirth = Math.round(daysAlive * 5 * 24 / 1000);
  // If you read 1 page every toilet visit
  const pagesOnToilet = toiletVisits;
  const booksOnToilet = Math.round(pagesOnToilet / 300); // 300 pages/book
  // If you spent all sleeping time working instead at min wage
  const sleepHoursTotal = parseFloat(yrsSleep) * 8760;
  const sleepWageValue = Math.round(sleepHoursTotal * 12); // $12/hr rough global avg

  // â•â•â• WALKING TO PLACES â•â•â•
  const walkSpeedKmH = 5; // avg walking speed

  // â•â•â• PROBABILITY OF YOU (personalized with YOUR traits) â•â•â•
  const probParentsMeeting = 1/20000;
  const probRightSperm = 1/400000000;
  const probRightEgg = 1/100000;
  const probAncestors = Math.pow(1/20000, 150000);
  const coinFlipsEquiv = Math.round(Math.log2(400000000 * 100000 * 20000));
  // YOUR specific trait probabilities stacked
  const nameFreq = namePop / WORLD_POP;
  // Local name frequency â€” multiple estimation tiers
  const userCountryCodeEarly = ci ? (ci.countryCode || '') : '';
  const nameCountryMatchEarly = nameCountries.find(c => c.id === userCountryCodeEarly);
  const countryProbEarly = nameCountryMatchEarly ? nameCountryMatchEarly.prob : 0;
  const countryPopEarly = COUNTRY_POP[userCountryCodeEarly] || 50000000;
  let localNameFreq;
  let nameFreqSource = '';

  // Forebears data (from fetchNameData)
  const fb = nameData.forebears;
  const fbCountry = fb && fb.countries ? fb.countries.find(c => c.iso === userCountryCodeEarly) : null;

  if (fbCountry && fbCountry.incidence > 0) {
    // TIER 1: forebears per-country incidence (most accurate â€” 4B person database)
    localNameFreq = fbCountry.incidence / countryPopEarly;
    nameFreqSource = 'forebears.io: ' + fmtE(fbCountry.incidence) + ' people named ' + name + ' in ' + (ci?ci.country:'your country');
  } else if (fb && fb.world > 0 && countryProbEarly > 0.1) {
    // TIER 2: forebears world total Ã— nationalize country probability
    const fbCountryEstimate = fb.world * countryProbEarly;
    localNameFreq = fbCountryEstimate / countryPopEarly;
    nameFreqSource = 'forebears.io world (' + fmtE(fb.world) + ') Ã— nationalize ' + Math.round(countryProbEarly*100) + '%';
  } else if (countryProbEarly > 0.5) {
    // TIER 3: nationalize shows strong association â€” bypass genderize entirely
    // Calibrated: prob Ã— 0.006 â‰ˆ frequency in country (validated vs forebears)
    localNameFreq = countryProbEarly * 0.006;
    nameFreqSource = 'nationalize.io (' + Math.round(countryProbEarly*100) + '% ' + (ci?ci.country:'') + ')';
  } else if (countryProbEarly > 0.1) {
    // TIER 4: Bayesian from genderize + nationalize
    localNameFreq = Math.max(countryProbEarly * namePop / countryPopEarly, countryProbEarly * 0.002);
    nameFreqSource = 'Bayesian correction';
  } else if (nameFreq > 0.000001) {
    // TIER 5: genderize global frequency (OK for international names like "Maria", "Alexander")
    localNameFreq = nameFreq;
    nameFreqSource = 'genderize.io global';
  } else {
    // TIER 6: ALL APIs FAILED â€” estimate from country population
    // A person's own name in their own country is typically 0.05-0.5% of population
    // Use 0.1% as a conservative default for a locally-normal name
    localNameFreq = 0.001;
    nameFreqSource = 'population-based estimate (name APIs unavailable)';
  }
  const traitProbs = [];
  traitProbs.push({trait:'your name ('+name+')', prob: localNameFreq > 0 ? localNameFreq : nameFreq > 0 ? nameFreq : 0.0001});
  if(blood && blood!=='unknown') traitProbs.push({trait:blood+' blood', prob: myBlood.pct/100});
  traitProbs.push({trait:hand+'-handed', prob: handPct/100});
  traitProbs.push({trait:eyes+' eyes', prob: myEyes.pct/100});
  traitProbs.push({trait:'your height ('+height+'cm)', prob: 0.04});
  traitProbs.push({trait:edu.label+' education', prob: edu.pct/100});
  if(languages>=3) traitProbs.push({trait:languages+' languages', prob: 0.03});
  if(instrument==='yes') traitProbs.push({trait:'plays instrument', prob: 0.15});
  if(cpr==='yes') traitProbs.push({trait:'knows CPR', prob: 0.025});
  const traitProbProduct = traitProbs.reduce((acc,t)=>acc*t.prob, 1);
  const oneInTraits = Math.round(1/traitProbProduct);

  // â•â•â• ENVIRONMENTAL FOOTPRINT (personalized with YOUR transport, kids, lifestyle) â•â•â•
  const co2Base = 4.7; // tons/year global avg
  // YOUR transport adjustments
  const carCO2 = canDrive==='yes' ? 2.4 : 0; // avg car = 2.4 tons CO2/year
  const bikeSaving = canBike==='yes' && exercise>=2 ? -0.3 : 0; // bike commuters save ~0.3t/yr
  const flightCO2annual = passport==='yes' ? 1.5 : 0; // flyers avg ~1.5t more/year
  const co2PerYearTons = Math.round((co2Base + carCO2 + bikeSaving + flightCO2annual)*10)/10;
  const co2Lifetime = (co2PerYearTons * age).toFixed(0);
  const co2Left = (co2PerYearTons * yrsLeft).toFixed(0);
  const treesToOffset = Math.round(co2PerYearTons * age / 0.022);
  const trashKgYear = 300;
  const trashLifetime = Math.round(trashKgYear * age);
  const trashElephants = (trashLifetime / 5000).toFixed(1);
  const waterFootprintDay = 3800;
  const waterLifetimeLiters = waterFootprintDay * daysAlive;
  const olympicPools = Math.round(waterLifetimeLiters / 2500000);
  const plasticKgYear = 35;
  const plasticLifetime = Math.round(plasticKgYear * age);
  const electricityKWhYear = 3500;
  const electricityLifetime = electricityKWhYear * age;
  // YOUR kids multiply your footprint
  const kidsCO2 = kids * co2PerYearTons * 0.58; // each kid adds ~58% of your footprint
  const totalFamilyCO2 = (parseFloat(co2Lifetime) + kidsCO2 * age).toFixed(0);
  // YOUR lifetime driving distance
  const lifetimeDriveKm = canDrive==='yes' ? Math.round(Math.max(0,age-18) * 15000) : 0; // 15k km/yr avg driver
  const driveCarsCO2 = (lifetimeDriveKm * 0.00021).toFixed(1); // 210g CO2/km

    // â•â•â• ğŸ§¬ YOUR HEALTH AGE (cross-references: exercise, sleep, smoking, alcohol, BMI, diet) â•â•â•
  const bmi = weight / (hM * hM);
  const bmiCategory = bmi < 18.5 ? 'underweight' : bmi < 25 ? 'normal' : bmi < 30 ? 'overweight' : 'obese';
  let healthAgeOffset = 0;
  // Exercise: huge factor
  const exerciseOffset = exercise >= 5 ? -4 : exercise >= 3 ? -3 : exercise >= 1 ? -1 : +2;
  healthAgeOffset += exerciseOffset;
  // Sleep
  const sleepOffset = sleepHrs >= 7 && sleepHrs <= 9 ? -1 : sleepHrs >= 6 ? 0 : sleepHrs < 6 ? +2 : +1;
  healthAgeOffset += sleepOffset;
  // Smoking
  // Smoking offset scales with cigs/day: 1 cig = +0.5yr, 10 = +5yr, 20 = +8yr, 40 = +12yr
  const smokingOffset = cigsPerDay === 0 ? 0 : Math.min(15, Math.round(cigsPerDay * 0.5 * 10) / 10);
  healthAgeOffset += smokingOffset;
  // Alcohol
  const alcoholOffset = alcohol === 'heavy' ? +4 : alcohol === 'moderate' ? +1 : 0; // WHO: no safe level
  healthAgeOffset += alcoholOffset;
  // BMI
  const bmiOffset = bmi >= 18.5 && bmi < 25 ? -1 : bmi >= 25 && bmi < 30 ? +1 : bmi >= 30 ? +3 : +1;
  healthAgeOffset += bmiOffset;
  // Diet quality: homemade meals are a better proxy than cooking skill
  const dietOffset = homeMealsPerWeek >= 15 ? -1.5 : homeMealsPerWeek >= 10 ? -1 : homeMealsPerWeek >= 5 ? -0.5 : +1;
  healthAgeOffset += dietOffset;
  // Coffee (moderate = protective, per meta-analyses)
  const coffeeHealthOffset = myCoffee >= 2 && myCoffee <= 4 ? -0.5 : myCoffee > 4 ? +0.5 : 0;
  healthAgeOffset += coffeeHealthOffset;
  // Social connections: relationship + pets + kids + friend days
  const friendHealthOffset = friendDaysPerWeek >= 3 ? -1 : friendDaysPerWeek >= 1 ? -0.5 : +1;
  const socialOffset = (inRel ? -0.5 : 0) + (pets > 0 ? -0.5 : 0) + (kids > 0 ? -0.5 : 0) + friendHealthOffset;
  healthAgeOffset += socialOffset;
  const healthAge = Math.round((age + healthAgeOffset) * 10) / 10;
  const healthDiff = Math.round(healthAgeOffset * 10) / 10;
  const adjustedLifeExp = Math.round(lifeExp - healthAgeOffset);
  const adjustedYrsLeft = Math.max(0, adjustedLifeExp - age);
  // Build factors list
  const healthFactors = [];
  if (exerciseOffset < 0) healthFactors.push({factor: exercise+'Ã—/week exercise', impact: exerciseOffset, emoji: 'ğŸ‹ï¸'});
  if (exerciseOffset > 0) healthFactors.push({factor: 'no exercise', impact: exerciseOffset, emoji: 'ğŸ›‹ï¸'});
  if (sleepOffset < 0) healthFactors.push({factor: sleepHrs+'h sleep (optimal)', impact: sleepOffset, emoji: 'ğŸ˜´'});
  if (sleepOffset > 0) healthFactors.push({factor: sleepHrs+'h sleep (not enough)', impact: sleepOffset, emoji: 'â°'});
  if (smokingOffset > 0) healthFactors.push({factor: cigsPerDay+' cigarettes/day', impact: smokingOffset, emoji: 'ğŸš¬'});
  if (alcoholOffset > 0) healthFactors.push({factor: alcohol+' drinking', impact: alcoholOffset, emoji: 'ğŸ·'});
  if (bmiOffset < 0) healthFactors.push({factor: 'healthy BMI ('+bmi.toFixed(1)+')', impact: bmiOffset, emoji: 'âš–ï¸'});
  if (bmiOffset > 0) healthFactors.push({factor: bmiCategory+' BMI ('+bmi.toFixed(1)+')', impact: bmiOffset, emoji: 'âš–ï¸'});
  if (dietOffset < 0) healthFactors.push({factor: homeMealsPerWeek+' homemade meals/week', impact: dietOffset, emoji: 'ğŸ¥—'});
  if (dietOffset > 0) healthFactors.push({factor: 'only '+homeMealsPerWeek+' homemade meals/week', impact: dietOffset, emoji: 'ğŸ”'});
  if (coffeeHealthOffset !== 0) healthFactors.push({factor: myCoffee+' coffees/day', impact: coffeeHealthOffset, emoji: 'â˜•'});
  if (friendHealthOffset < 0) healthFactors.push({factor: friendDaysPerWeek+' days/week with friends', impact: friendHealthOffset, emoji: 'ğŸ‘«'});
  if (friendHealthOffset > 0) healthFactors.push({factor: 'rarely seeing friends ('+friendDaysPerWeek+' days/week)', impact: friendHealthOffset, emoji: 'ğŸ˜”'});
  const partnerPetKids = (inRel?'partner':'')+(pets>0?(inRel?'+':'')+'pet':'')+(kids>0?((inRel||pets>0)?'+':'')+'kids':'');
  if (partnerPetKids && socialOffset-friendHealthOffset < 0) healthFactors.push({factor: 'social bonds ('+partnerPetKids+')', impact: socialOffset-friendHealthOffset, emoji: 'â¤ï¸'});
  healthFactors.sort((a,b) => a.impact - b.impact); // best factors first

  // â•â•â• ğŸ“Š YOUR DAY (cross-references: sleep, job, commute, exercise, cooking, coffee, pets, screen, kids) â•â•â•
  const dayBreakdown = [];
  dayBreakdown.push({activity: 'ğŸ˜´ Sleep', hours: sleepHrs, color: '#6366f1'});
  const dayWorkHrs = workHrsPerDay;
  dayBreakdown.push({activity: 'ğŸ’¼ Work', hours: dayWorkHrs, color: '#f59e0b'});
  const dayCommuteHrs = workHrsPerDay > 0 ? (ci && ci.population > 1000000 ? 1.5 : 0.75) : 0;
  dayBreakdown.push({activity: 'ğŸš— Commute', hours: dayCommuteHrs, color: '#ef4444'});
  const dayScreenPersonal = genScreenHrs + chronoBonus;
  dayBreakdown.push({activity: 'ğŸ“± Personal screen', hours: dayScreenPersonal, color: '#8b5cf6'});
  const dayExerciseHrs = Math.round(exercise * 60 / 7) / 60; // spread across week
  if (dayExerciseHrs > 0) dayBreakdown.push({activity: 'ğŸ‹ï¸ Exercise', hours: Math.round(dayExerciseHrs * 10) / 10, color: '#10b981'});
  const dayCookHrs = cookMinPerDay / 60;
  if (dayCookHrs > 0) dayBreakdown.push({activity: 'ğŸ³ Cooking', hours: Math.round(dayCookHrs * 10) / 10, color: '#f97316'});
  const dayCoffeeHrs = Math.round(myCoffee * 5 / 60 * 10) / 10;
  if (dayCoffeeHrs > 0.1) dayBreakdown.push({activity: 'â˜• Coffee ritual', hours: dayCoffeeHrs, color: '#78350f'});
  const dayPetHrs = pets > 0 ? Math.round(pets * 30 / 60 * 10) / 10 : 0;
  if (dayPetHrs > 0) dayBreakdown.push({activity: 'ğŸ¾ Pet care', hours: dayPetHrs, color: '#a78bfa'});
  const dayKidsHrs = kids > 0 ? Math.round(kids * 2 * 10) / 10 : 0;
  if (dayKidsHrs > 0) dayBreakdown.push({activity: 'ğŸ‘¶ Kids', hours: Math.min(dayKidsHrs, 4), color: '#fb923c'});
  const dayFriendHrs = Math.round(friendDaysPerWeek * 3.5 / 7 * 10) / 10; // spread across week
  if (dayFriendHrs > 0.2) dayBreakdown.push({activity: 'ğŸ‘« Friends', hours: dayFriendHrs, color: '#f472b6'});
  const dayEatingHrs = 1.0;
  dayBreakdown.push({activity: 'ğŸ• Eating', hours: dayEatingHrs, color: '#ec4899'});
  const dayHygieneHrs = 0.5;
  dayBreakdown.push({activity: 'ğŸš¿ Hygiene', hours: dayHygieneHrs, color: '#06b6d4'});
  // Calculate free time as remainder
  const accountedHrs = dayBreakdown.reduce((s, d) => s + d.hours, 0);
  const freeTime = Math.max(0, Math.round((24 - accountedHrs) * 10) / 10);
  dayBreakdown.push({activity: 'âœ¨ Free time', hours: freeTime, color: '#22c55e'});

  // â•â•â• âš¡ YOUR CONTRADICTIONS (cross-references every input against every other) â•â•â•
  const contradictions = [];
  // Coffee Ã— Sleep
  if (myCoffee >= 3 && sleepHrs < 7) contradictions.push({emoji: 'â˜•ğŸ˜´', title: 'The Caffeine Loop', desc: myCoffee+' coffees/day + only '+sleepHrs+'h sleep â€” you\'re tired because you can\'t sleep because you drink coffee because you\'re tired'});
  if (myCoffee === 0 && sleepHrs < 6) contradictions.push({emoji: 'ğŸ˜´â“', title: 'No Coffee, No Sleep?', desc: 'You don\'t even drink coffee and still only sleep '+sleepHrs+' hours. What are you running on â€” pure chaos?'});
  // Smoking Ã— Exercise
  if (cigsPerDay > 0 && exercise >= 3) contradictions.push({emoji: 'ğŸš¬ğŸƒ', title: 'The Lung Paradox', desc: 'You exercise '+exercise+'Ã—/week but smoke '+cigsPerDay+' cigarettes/day â€” your lungs are literally fighting themselves. One habit adds years, the other takes them away.'});
  // Night Owl Ã— Job
  if (chronotype === 'night' && workHrsPerDay >= 8) contradictions.push({emoji: 'ğŸŒ™ğŸ’¼', title: 'Night Owl, Day Job', desc: 'Your brain peaks at 10pm but your '+workHrsPerDay+'h/day job needs you at 9am â€” you\'re fighting your biology '+Math.round(workYearsRemaining*250)+' more work days.'});
  if (chronotype === 'early' && (job === 'musician' || job === 'actor' || job === 'barista' || job === 'bartender')) contradictions.push({emoji: 'â˜€ï¸ğŸ­', title: 'Early Bird, Night Gig', desc: 'You wake at dawn but work nights â€” your circadian rhythm must be very confused.'});
  // Alcohol Ã— Exercise (calorie comparison)
  const alcoholCalWeek = alcohol === 'heavy' ? 3500 : alcohol === 'moderate' ? 1400 : alcohol === 'social' ? 500 : 0;
  const exerciseCalWeek = exercise * 400; // ~400 cal per workout session avg
  if (alcoholCalWeek > 0 && exerciseCalWeek > 0 && alcoholCalWeek >= exerciseCalWeek * 0.7) contradictions.push({emoji: 'ğŸ·ğŸ‹ï¸', title: 'The Calorie Seesaw', desc: 'You burn ~'+fmtE(exerciseCalWeek)+' cal/week exercising, then drink ~'+fmtE(alcoholCalWeek)+' cal/week back. The gym is basically sponsoring your bar tab.'});
  // Healthy food Ã— Unhealthy habits
  if (cookLevel === 'pro' && cigsPerDay >= 10) contradictions.push({emoji: 'ğŸ‘¨â€ğŸ³ğŸš¬', title: 'Chef\'s Paradox', desc: 'You cook like a pro (the healthiest diet possible) but smoke (the unhealthiest habit possible). Your body is getting very mixed signals.'});
  // Lots of coffee Ã— alcohol
  if (myCoffee >= 4 && (alcohol === 'heavy' || alcohol === 'moderate')) contradictions.push({emoji: 'â˜•ğŸ·', title: 'Upper + Downer', desc: myCoffee+' coffees to speed up, then '+alcohol+' drinking to slow down â€” your nervous system is on a daily rollercoaster.'});
  // CPR knowledge Ã— smoking
  if (cpr === 'yes' && cigsPerDay > 0) contradictions.push({emoji: 'ğŸ©ºğŸš¬', title: 'Save Lives, Risk Yours', desc: 'You know CPR (could save someone from cardiac arrest) while smoking '+cigsPerDay+' cigarettes/day (increasing your own cardiac risk by 2-4Ã—).'});
  // No exercise Ã— lots of pets
  if (exercise === 0 && pets >= 2) contradictions.push({emoji: 'ğŸ›‹ï¸ğŸ•', title: 'Sedentary Pet Parent', desc: 'Zero exercise but '+pets+' pets â€” those walks don\'t count? You\'re accidentally getting more exercise than you think.'});
  // Heavy drinker Ã— early bird
  if (alcohol === 'heavy' && chronotype === 'early') contradictions.push({emoji: 'ğŸ·â˜€ï¸', title: 'Morning Person, Evening Hobby', desc: 'You\'re an early bird who drinks heavily â€” how are you waking up at dawn?'});
  // Education Ã— No reading glasses
  if ((education === 'phd' || education === 'masters') && glasses === 'no') contradictions.push({emoji: 'ğŸ“ğŸ‘€', title: 'Scholar Eyes', desc: education === 'phd' ? 'A PhD without glasses? Only ~25% of PhDs escape unscathed after 20+ years of reading.' : 'A Master\'s without glasses â€” your eyes survived all that reading.'});
  // Single Ã— lots of kids
  if (relationship === 'single' && kids >= 3) contradictions.push({emoji: 'ğŸ’”ğŸ‘¶', title: 'Solo Superhero', desc: 'Single with '+kids+' kids â€” you\'re doing the work of two parents. '+Math.round(kids*2*365)+' hours/year of solo parenting.'});
  // Night owl Ã— kids
  if (chronotype === 'night' && kids > 0) contradictions.push({emoji: 'ğŸŒ™ğŸ‘¶', title: 'Night Owl vs. Tiny Humans', desc: 'Your brain wakes up at 10pm, but your '+kids+' kid'+(kids>1?'s':'')+' wake up at 6am. '+(kids>1?'They':'Your child')+' didn\'t read the memo about your chronotype.'});
  // Can swim but never exercises
  if (canSwim === 'yes' && exercise === 0) contradictions.push({emoji: 'ğŸŠğŸ›‹ï¸', title: 'Can Swim, Won\'t Move', desc: 'You learned to swim but exercise 0 times per week. That survival skill is collecting dust.'});
  // Instrument + no exercise (creative but sedentary)
  if (instrument === 'yes' && exercise === 0 && job !== 'musician') contradictions.push({emoji: 'ğŸ¸ğŸ›‹ï¸', title: 'Active Fingers, Still Body', desc: 'Your fingers get a workout but the rest of you doesn\'t â€” instrument players burn ~170 cal/hour though, so it\'s something.'});

  // New contradictions using new inputs
  if (workHrsPerDay >= 10 && exercise >= 3) contradictions.push({emoji: 'ğŸ’¼ğŸ‹ï¸', title: 'Workaholic Athlete', desc: workHrsPerDay+'h/day working AND '+exercise+'Ã—/week exercise â€” when do you sleep? You have only '+freeTime.toFixed(1)+'h of free time per day.'});
  if (workHrsPerDay >= 10 && friendDaysPerWeek >= 4) contradictions.push({emoji: 'ğŸ’¼ğŸ‘«', title: 'Overworked Socialite', desc: workHrsPerDay+'h/day at work but still see friends '+friendDaysPerWeek+' days/week â€” you\'re defying the space-time continuum.'});
  if (friendDaysPerWeek === 0 && pets >= 2) contradictions.push({emoji: 'ğŸ˜”ğŸ¾', title: 'Pets Over People', desc: '0 days/week with friends but '+pets+' pets â€” your social circle is entirely non-verbal.'});
  if (friendDaysPerWeek >= 5 && relationship === 'married' && relDuration > 5) contradictions.push({emoji: 'ğŸ‘«ğŸ’', title: 'Marriage + Full Social Calendar', desc: 'Married '+relDuration+' years AND friends '+friendDaysPerWeek+' days/week â€” your partner must be very secure (or very invited).'});
  if (homeMealsPerWeek <= 3 && cookLevel === 'pro') contradictions.push({emoji: 'ğŸ‘¨â€ğŸ³ğŸ”', title: 'Pro Chef, Never Cooks', desc: 'You CAN cook at a pro level but only make '+homeMealsPerWeek+' homemade meals/week â€” all that skill going to waste!'});
  if (homeMealsPerWeek >= 18 && cookLevel === 'no') contradictions.push({emoji: 'ğŸ³ğŸ˜…', title: 'Can\'t Cook, Always Cooking', desc: homeMealsPerWeek+' homemade meals/week but you say you can barely cook? You\'re either modest or eating a lot of cereal.'});
  if (workHrsPerDay <= 4 && (job === 'executive' || job === 'lawyer' || job === 'trader')) contradictions.push({emoji: 'ğŸ’¼ğŸ–ï¸', title: 'High-Powered Part-Timer', desc: 'A '+jobProfile.cat+' working only '+workHrsPerDay+'h/day? You\'ve either made it or you\'re about to get fired.'});
  if (friendDaysPerWeek === 0 && relationship === 'single' && kids === 0) contradictions.push({emoji: 'ğŸ ğŸ˜¶', title: 'The Hermit', desc: 'Single, no kids, 0 friend days/week â€” you spend ~'+fmtE(Math.round(freeTime*365))+' hours/year in pure solitude. Introverts would be jealous, but are you okay?'});

  // â•â•â• MATHEMATICAL YOU â•â•â•
  function isPrime(n) { if(n<2)return false; for(let i=2;i<=Math.sqrt(n);i++) if(n%i===0)return false; return true; }
  function fibonacci(n) { let a=0,b=1; while(b<n){[a,b]=[b,a+b];} return b===n; }
  function nextPrime(n) { let x=n+1; while(!isPrime(x))x++; return x; }
  function isPerfectSquare(n) { return Math.sqrt(n)%1===0; }
  const ageIsPrime = isPrime(age);
  const ageIsFibonacci = fibonacci(age);
  const ageIsPerfectSquare = isPerfectSquare(age);
  const nextPrimeAge = nextPrime(age);
  const ageFactorial = age <= 20 ? Array.from({length:age},(_, i)=>i+1).reduce((a,b)=>a*b, 1) : Infinity;
  const agePowerOf2 = Math.log2(age) % 1 === 0;
  // Birthday digits
  const bdDigits = bdStr.replace(/-/g, '');
  const bdDigitSum = bdDigits.split('').reduce((a,b)=>a+parseInt(b),0);
  // Collatz sequence length for age
  let collatzN = age, collatzSteps = 0;
  while(collatzN !== 1 && collatzSteps < 1000) { collatzN = collatzN%2===0 ? collatzN/2 : 3*collatzN+1; collatzSteps++; }

  // â•â•â• YOUR SENSES (personalized with glasses, instrument, languages, smoking, eyes) â•â•â•
  // YOUR vision: glasses affect color perception journey
  const colorsSeeable = 10000000;
  const colorsWithoutGlasses = glasses==='yes' ? Math.round(colorsSeeable * 0.7) : colorsSeeable; // uncorrected vision sees fewer
  // YOUR hearing: instrument training expands pitch detection
  const pitchesDetectable = instrument==='yes' ? 1500 : 300; // trained ear: 1500 vs untrained: 300 distinct pitches
  const smellsDetectable = cigsPerDay >= 10 ? 500000000000 : cigsPerDay >= 1 ? 750000000000 : 1000000000000; // smoking cuts smell by ~50%
  const tasteBuds = gender === 'male' ? 8000 : 10000;
  const tasteBudsSmoking = cigsPerDay >= 10 ? Math.round(tasteBuds * 0.7) : cigsPerDay >= 1 ? Math.round(tasteBuds * 0.85) : tasteBuds; // smoking dulls taste by ~30%
  // YOUR language vocabulary
  const vocabSize = languages * 50000; // ~50k words per fluent language
  const phonemesDetectable = Math.min(800, languages * 80 + 50); // bilingual brains detect more phonemes
  const booksRead = age > 10 ? Math.round((age - 10) * 4) : 0;
  const booksEquivWords = Math.round(wordsSpoken / 70000);
  const songsHeard = age > 5 ? Math.round((age - 5) * 365 * 10) : 0;
  const sunsetsSeen = Math.round(daysAlive * 0.15);
  const nightSkyStars = glasses==='yes' ? 2000 : 2500; // glasses wearers see slightly fewer without them
  // YOUR eye color affects light sensitivity
  const lightSensitivity = eyes==='blue'||eyes==='green' ? 'higher' : 'average'; // lighter eyes = more photosensitive
  const ageFreq = 1/80;
  const genderFreq = 0.5;
  const cityFreq = ci ? ci.population / WORLD_POP : 500000/WORLD_POP;
  const heightFreq = 0.04; // ~4% within Â±2cm (normal dist)
  const weightFreq = 0.05;
  const sibFreq = sibPct/100;
  const bloodFreq = blood && blood !== 'unknown' ? myBlood.pct / 100 : 1;
  const handFreq = handPct / 100;
  const eyeFreq = myEyes.pct / 100;
  const eduFreq = edu.pct / 100;
  const combinedProb = nameFreq * ageFreq * genderFreq * cityFreq * heightFreq * weightFreq * sibFreq * bloodFreq * handFreq * eyeFreq * eduFreq;
  const estMatches = Math.max(0, Math.round(WORLD_POP * combinedProb));
  const uniqueStr = estMatches < 1 ? '99.99999999' : (100-(combinedProb*100)).toFixed(8);

  // Time left
  const fridaysLeft = yrsLeft*52;
  const heartbeatsLeft = yrsLeft*365*100000;
  const pctLived = ((age/lifeExp)*100).toFixed(1);

  // â•â•â• BUILD HTML â•â•â•
  let h = '';

  // â”€â”€ NAME (from API) â”€â”€
  h += '<div class="category anim" style="animation-delay:.05s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ·ï¸</span><span class="cat-title">Your Name</span></div>';
  h += card('~'+fmt(namePop),'estimated people on Earth named <strong>'+name+'</strong>','color-accent');
  h += '<div class="fact-row">';
  h += cardS(fmt(Math.round(namePop/365)),name+'s born every day','color-pink');
  h += cardS('1 in '+fmt(Math.round(WORLD_POP/namePop)),'chance a stranger is named '+name,'color-cyan');
  h += '</div>';
  if(nameCountries.length>0){
    const topC = nameCountries.slice(0,3).map(c=>(COUNTRIES[c.id]||c.id)+' ('+Math.round(c.prob*100)+'%)').join(', ');
    h += card('Most common in:','<strong>'+topC+'</strong>','color-blue');
  }
  if(nameData.db_count>0){
    h += src('ğŸ“Š Source: ' + nameData.source);
  }
  h += '</div>';

  // â”€â”€ BODY â”€â”€
  h += '<div class="category anim" style="animation-delay:.1s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ«€</span><span class="cat-title">Your Body So Far</span></div>';
  h += card(fmtE(heartbeats),'heartbeats since birth','color-red');
  h += '<div class="fact-row">';
  h += cardS(fmtE(breaths),'breaths taken','color-blue');
  h += cardS(fmtE(blinks),'times blinked','color-cyan');
  h += '</div>';
  h += card(fmtE(bloodMi)+' miles','blood traveled â€” '+Math.round(bloodMi/93000000)+'Ã— to the Sun','color-pink');
  h += '<div class="fact-row">';
  h += cardS(skinKg.toFixed(1)+'kg','skin shed','color-orange');
  h += cardS(hairM.toFixed(1)+'m','hair grown','color-green');
  h += '</div>';
  h += card(fmtE(dreams)+' dreams','had â€” you forgot 95% of them','color-accent');
  h += '<div class="fact-row">';
  h += cardS(fmtE(meals),'meals eaten','color-orange');
  h += cardS(fmtE(Math.round(distKmWalk))+'km','walked','color-green');
  h += '</div>';
  h += card(yrsSleep+' years','sleeping ('+Math.round(parseFloat(yrsSleep)/age*100)+'% of life)','color-blue');
  h += src('ğŸ“Š Source: medical averages (AHA, WHO, sleep research)');
  h += '</div>';

  // â”€â”€ DNA â”€â”€
  h += '<div class="category anim" style="animation-delay:.15s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ§¬</span><span class="cat-title">DNA & Atoms</span></div>';
  h += dnaCard(fmt(dnaKm)+' km','DNA inside you â€” to Pluto and back <strong>'+plutoTrips+'Ã— times</strong>','color-accent');
  h += dnaCard(fmt(sunTrips)+'Ã—','trips to the Sun with your uncoiled DNA','color-orange');
  h += card('3.2 billion','base pairs â€” your personal genetic code','color-pink');
  h += card(fmtE(uniqueBasePairs),'base pairs uniquely yours â€” the 0.1% that makes you, you','color-cyan');
  h += '<div class="fact-row">';
  h += cardS('98.8%','shared with chimps','color-green');
  h += cardS('60%','shared with bananas','color-orange');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS('85%','shared with mice','color-blue');
  h += cardS('70%','shared with chickens','color-pink');
  h += '</div>';
  h += card(fmt(cellsInBody),'cells in your body â€” more than stars in the Milky Way','color-accent');
  h += card(fmt(bacteriaInBody),'bacteria living on you â€” more than your own cells','color-green');
  h += card(fmt(atomsInBody),'atoms â€” mostly forged in dying stars billions of years ago','color-cyan');
  h += '<div class="fact-row">';
  h += cardS(ironGrams.toFixed(1)+'g','iron in blood','color-red');
  h += cardS(goldMg.toFixed(2)+'mg','gold in body','color-orange');
  h += '</div>';
  h += card(fmt(lightKm)+' km','distance light traveled since you were born','color-blue');
  h += card(fmtE(orbits)+' orbits','around the Sun â€” '+fmt(orbitDistKm)+' km total','color-pink');
  h += src('ğŸ“Š Source: human genome project, biochemistry constants, physics');
  h += '</div>';

  // â”€â”€ RARITY â”€â”€
  h += '<div class="category anim" style="animation-delay:.2s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ†</span><span class="cat-title">Rarity Score</span></div>';

  // How many [gender] named [name] aged [age] live in [city]?
  const cityPop = ci ? ci.population : 500000;
  
  // Bayesian country correction for name frequency
  // Use forebears per-country data when available, else nationalize-based estimate
  const userCountryCode = ci ? ci.countryCode : '';
  const nameCountryMatch = nameCountries.find(c => c.id === userCountryCode);
  const countryProbForName = nameCountryMatch ? nameCountryMatch.prob : 0;
  const countryPopulation = COUNTRY_POP[userCountryCode] || 50000000;
  
  // localNameFreq already computed above with forebears/nationalize correction
  let nameInCityEstimate = Math.max(0, cityPop * localNameFreq * (1/80) * 0.5);
  // Sanity floor: in any city over 100K, there's almost certainly at least 1 person
  // with the same name, same age-decade, same gender
  if (cityPop > 100000 && nameInCityEstimate < 1) {
    nameInCityEstimate = Math.max(1, Math.round(cityPop / 500000));
    nameFreqSource += ' (floor applied: estimate was implausibly low)';
  }
  console.log('Name rarity debug:', {name, localNameFreq, nameFreqSource, cityPop, nameInCityEstimate, namePop, countryProbEarly, tier: nameFreqSource.split('(')[0].trim()});
  const nameInCityRounded = nameInCityEstimate < 1 ? nameInCityEstimate.toFixed(1) : Math.round(nameInCityEstimate);
  
  // Country estimate
  let nameInCountryEstimate = Math.round(countryPopulation * localNameFreq * (1/80) * 0.5);
  if (countryPopulation > 1000000 && nameInCountryEstimate < 5) {
    nameInCountryEstimate = Math.max(5, Math.round(countryPopulation / 500000));
  }

  // Forebears per-country data for display
  const fbDisplay = fb && fb.countries ? fb.countries.find(c => c.iso === userCountryCode) : null;

  h += '<div class="rarity-meter">';
  h += '<div style="font-size:14px;color:var(--text2);margin-bottom:12px"><strong style="color:#fff;font-size:18px">'+name+', '+age+', '+city+(ci&&ci.country?', '+ci.country:'')+'</strong></div>';
  h += '<div style="font-size:13px;color:var(--text2);margin-bottom:4px">Estimated <strong style="color:var(--accent2)">'+(gender==='male'?'males':'females')+'</strong> named <strong style="color:var(--accent2)">'+name+'</strong>, aged <strong style="color:var(--accent2)">'+age+'</strong>, living in <strong style="color:var(--accent2)">'+city+'</strong>:</div>';
  h += '<div class="rarity-big" style="color:var(--accent2)">~'+nameInCityRounded+'</div>';
  h += '<div class="rarity-label">'+(nameInCityEstimate < 1 ? 'less than 1 person â€” you are statistically <strong>the only one</strong>' : nameInCityEstimate < 5 ? 'you could probably count them on one hand' : nameInCityEstimate < 50 ? 'they would fit in a single room' : 'in a city of '+fmtE(cityPop))+'</div>';
  h += '</div>';

  if (nameInCountryEstimate !== null && nameInCountryEstimate > 0) {
    const countryCardText = fbDisplay ? fmtE(fbDisplay.incidence)+' total people named '+name+' in '+(ci?ci.country:'your country')+' (forebears.io) â†’ ~'+fmtE(nameInCountryEstimate)+' '+(gender==='male'?'males':'females')+' aged '+age : (gender==='male'?'males':'females')+' named '+name+', aged '+age+', estimated in '+((ci&&ci.country)?ci.country:'your country');
    h += card('~'+fmtE(nameInCountryEstimate), countryCardText, 'color-accent');
  }

  h += '<div class="rarity-meter" style="margin-top:12px">';
  h += '<div style="font-size:12px;color:var(--text2);margin-bottom:8px">Full uniqueness (name + age + gender + city + height + weight + blood + eyes + hand + education)</div>';
  h += '<div class="rarity-big">'+uniqueStr+'%</div>';
  h += '<div class="rarity-label">unique â€” more rare than this percentage of all humans</div>';
  const barW = Math.min(98,parseFloat(uniqueStr));
  h += '<div class="rarity-bar-bg"><div class="rarity-bar-fill" style="width:'+barW+'%"></div></div>';
  h += '</div>';
  h += card('~'+fmtE(estMatches),'estimated people on Earth match your exact combination of all traits','color-accent');
  if(estMatches<100) h += card('ğŸ¦„ Ultra Rare','fewer than 100 matches â€” practically one of a kind','color-pink');
  else if(estMatches<1000) h += card('ğŸ’ Very Rare','fewer than 1,000 matches worldwide','color-green');
  else if(estMatches<10000) h += card('âœ¨ Rare','fewer than 10,000 â€” could fill a small stadium','color-blue');
  else h += card('ğŸŒ Uncommon',fmtE(estMatches)+' matches â€” still less than 0.001% of humanity','color-cyan');
  h += src('ğŸ“Š Data: ' + nameFreqSource + '. Local freq: '+localNameFreq.toExponential(2)+'. cityPop ('+fmtE(cityPop)+') Ã— freq Ã— 1/80 ages Ã— 0.5 gender');
  h += '</div>';

  // â”€â”€ BIRTHDAY â”€â”€
  h += '<div class="category anim" style="animation-delay:.25s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ“…</span><span class="cat-title">Your Birthday</span></div>';
  h += card(dayOW,'born on a '+dayOW+' in '+monthNames[bM-1]+' '+bY,'color-accent');
  h += card(zodiac.s+' '+zodiac.n,zodiac.e+' sign â€” '+zodiac.t,'color-pink');
  h += '<div class="fact-row">';
  h += cardS(fmtE(daysAlive),'days alive','color-green');
  h += cardS(fmtE(hoursAlive),'hours alive','color-blue');
  h += '</div>';
  h += card(fmtE(sameBday),'people share your exact birthday','color-orange');
  h += card(fmt(popBorn),'world population when you were born â€” now '+fmt(WORLD_POP),'color-cyan');
  // Milestones
  h += card('ğŸ“Œ '+fmtDate(billionthHB),billionthHB>now?'your 1 billionth heartbeat â€” coming up!':'your 1 billionth heartbeat â€” already happened!','color-accent');
  h += card('ğŸ“Œ '+fmtDate(tenKDay),tenKDay>now?'your 10,000th day alive â€” mark your calendar':'your 10,000th day alive â€” already passed!','color-pink');
  h += '</div>';

  // â”€â”€ CITY (from API) â”€â”€
  h += '<div class="category anim" style="animation-delay:.3s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸŒ</span><span class="cat-title">Your City</span></div>';
  if(ci){
    const sameAge = Math.round(ci.population / 80); // uniform age distribution approximation
    h += card(fmtE(ci.population),'people in '+city+(ci.country?', '+ci.country:''),'color-accent');
    h += card('~'+fmtE(sameAge),'people in '+city+' are also around '+age+' years old','color-pink');

    const places=[{n:"Tokyo",la:35.68,lo:139.69},{n:"New York",la:40.71,lo:-74.01},{n:"London",la:51.51,lo:-0.13},{n:"Sydney",la:-33.87,lo:151.21},{n:"Cairo",la:30.04,lo:31.24},{n:"SÃ£o Paulo",la:-23.55,lo:-46.64}];
    const dists=places.map(p=>({n:p.n,km:distKm(ci.lat,ci.lon,p.la,p.lo)})).sort((a,b)=>a.km-b.km).slice(0,4);
    h += '<div class="fact-row">';
    dists.slice(0,2).forEach(d=>{h+=cardS(fmtE(d.km)+' km','to '+d.n,'color-blue')});
    h += '</div>';
    h += '<div class="fact-row">';
    dists.slice(2,4).forEach(d=>{h+=cardS(fmtE(d.km)+' km','to '+d.n,'color-cyan')});
    h += '</div>';
    // Antipodal point
    const antiLat = -ci.lat;
    const antiLon = ci.lon > 0 ? ci.lon - 180 : ci.lon + 180;
    if (antipodalData) {
      const antiIcon = antipodalData.isLand ? 'ğŸï¸' : 'ğŸŒŠ';
      h += card(antiIcon+' '+antipodalData.name,'your antipodal point â€” the exact opposite side of Earth from '+city+' ('+antiLat.toFixed(1)+'Â°, '+antiLon.toFixed(1)+'Â°). If you dug straight down through the Earth, you\'d end up '+(antipodalData.isLand?'on land!':'in the middle of the ocean'),'color-green');
    } else {
      h += card('ğŸ“ '+antiLat.toFixed(1)+'Â°, '+antiLon.toFixed(1)+'Â°','your antipodal point â€” the exact opposite side of Earth from '+city,'color-green');
    }
    h += src('ğŸ“Š Source: OpenStreetMap Nominatim (coordinates) + Wikidata (population) + haversine formula (distances)');
  } else {
    h += card(city,'your home city â€” coordinates unavailable, try a larger city name','color-accent');
  }
  h += '</div>';

  // â”€â”€ HEIGHT â”€â”€
  h += '<div class="category anim" style="animation-delay:.35s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ“</span><span class="cat-title">Your Height</span></div>';
  h += card(height+'cm','('+hFt+'\''+hIn+'") â€” taller than <strong>'+tallerPct+'%</strong> of '+(gender==='male'?'men':'women'),'color-accent');
  h += card((hDiff>0?'+':'')+hDiff.toFixed(0)+'cm','vs world average '+(gender==='male'?'male':'female')+' ('+wAvg+'cm)',hDiff>0?'color-green':'color-orange');
  h += '<div class="fact-row">';
  h += cardS(fmtE(stackEiffel)+'Ã—','= Eiffel Tower','color-pink');
  h += cardS(fmtE(stackBurj)+'Ã—','= Burj Khalifa','color-blue');
  h += '</div>';
  h += card(fmt(toMoon)+'Ã—','stacked to reach the Moon','color-cyan');
  h += src('ğŸ“Š Source: WHO global height data, normal distribution (Î¼='+wAvg+', Ïƒ='+sd+')');
  h += '</div>';

  // â”€â”€ WEIGHT â”€â”€
  h += '<div class="category anim" style="animation-delay:.4s">';
  h += '<div class="cat-header"><span class="cat-icon">âš–ï¸</span><span class="cat-title">Your Weight</span></div>';
  h += card(waterKg.toFixed(1)+'kg','is water â€” '+Math.round(waterKg/weight*100)+'% of you','color-blue');
  h += '<div class="fact-row">';
  h += cardS(oxygenKg.toFixed(1)+'kg','oxygen','color-cyan');
  h += cardS(carbonKg.toFixed(1)+'kg','carbon','color-orange');
  h += '</div>';
  h += card(fmtE(antCount)+' ants','needed to equal your weight','color-green');
  h += card('~$45,000,000','chemical value of your body\'s elements','color-pink');
  h += src('ğŸ“Š Source: biochemistry (60% water, 65% oxygen by mass, element ratios)');
  h += '</div>';

  // â”€â”€ JOB â”€â”€
  h += '<div class="category anim" style="animation-delay:.45s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ’¼</span><span class="cat-title">Your Job</span></div>';
  h += card(jobProfile.icon+' '+jobProfile.cat,weeklyHrs+'h/week Â· retire ~'+jobProfile.retireAge+' Â· stress: '+jobProfile.stress+' Â· salary range: '+jobProfile.salary,'color-accent');
  h += card(fmtE(workHrs)+' hours','of work remaining in your career','color-blue');
  h += '<div class="fact-row">';
  h += cardS(fmtE(mondaysLeft),'Monday mornings left','color-red');
  h += cardS(fmtE(workYrs),'years to retirement','color-orange');
  h += '</div>';
  h += card(fmtE(meetingHrs)+' hours','in meetings (~'+(meetingHrs/8760).toFixed(1)+' years) â€” '+Math.round(jobProfile.meetPct*100)+'% of work time','color-pink');
  h += '<div class="fact-row">';
  h += cardS(fmtE(standingHrs)+'h','standing at work','color-green');
  h += cardS(fmtE(sittingHrs)+'h','sitting at work','color-cyan');
  h += '</div>';
  h += card(fmtE(coffeeTotal)+' cups','of coffee before retirement (~'+jobProfile.coffee.toFixed(1)+'/day)','color-orange');
  h += card(fmtE(commuteHrs)+' hours','commuting (~'+(commuteHrs/8760).toFixed(1)+' years in transit)','color-blue');
  if(jobProfile.global){
    h += card(fmt(jobProfile.global),'people worldwide share your profession','color-accent');
    h += card('1 in '+fmtE(Math.round(WORLD_POP/jobProfile.global)),'people on Earth do what you do','color-cyan');
  }
  h += card('ğŸ’¡ Fun fact',jobProfile.fact,'color-pink');
  h += src('ğŸ“Š Source: job profile database ('+jobProfile.cat+': '+weeklyHrs+'h/wk, '+Math.round(jobProfile.meetPct*100)+'% meetings, retire '+jobProfile.retireAge+')');
  h += '</div>';


  // â”€â”€ FOOD & DRINK â”€â”€
  h += '<div class="category anim" style="animation-delay:.5s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ•</span><span class="cat-title">Food & Drink</span></div>';
  h += card(fmtE(tdee)+' cal/day','YOUR body burns '+fmtE(tdee)+' calories daily â€” based on your '+weight+'kg, '+height+'cm, and '+(exercise>0?exercise+'Ã—/week exercise':'sedentary lifestyle'),'color-accent');
  h += card(fmtE(foodKgLife)+' kg','of food consumed so far â€” about '+(foodKgLife/5000).toFixed(0)+' elephants worth','color-orange');
  h += card(fmtE(Math.round(waterLitersLife))+' liters','of water consumed â€” your '+weight+'kg body needs '+waterLitersDay.toFixed(1)+'L/day (that\'s '+(waterLitersLife/2500).toFixed(0)+' bathtubs so far)','color-blue');
  h += card(homeMealsPerWeek+'/21 meals homemade','you cook '+homeMealsPerWeek+' meals per week ('+homeMealsPct+'% homemade) â€” '+(homeMealsPerWeek>=15?'you\'re basically a home chef, saving $'+fmtE(cookSavingsPerYear)+'/year vs all takeout':homeMealsPerWeek>=7?'a healthy mix â€” saving $'+fmtE(cookSavingsPerYear)+'/year vs all takeout':homeMealsPerWeek>=3?'mostly eating out â€” spending ~$'+fmtE(Math.round(weeklyFoodCost*52))+'/year on food':'almost all takeout â€” ~$'+fmtE(Math.round(weeklyFoodCost*52))+'/year on food'),homeMealsPerWeek>=10?'color-green':'color-orange');
  h += card(fmtE(mealsCookedSelf)+' homemade meals','you\'ve cooked in your lifetime â€” vs '+fmtE(takeoutMealsLife)+' takeout/restaurant meals','color-pink');
  h += card('$'+fmtE(cookSavedLife)+' saved','by cooking at home over your lifetime â€” '+(cookSavedLife>50000?'that\'s a car':cookSavedLife>20000?'that\'s several vacations':'it adds up'),'color-cyan');
  h += src('ğŸ“Š Source: Harris-Benedict BMR equation, FAO food consumption, WHO nutrition guidelines');
  h += '</div>';

  // â”€â”€ SCREEN TIME â”€â”€
  h += '<div class="category anim" style="animation-delay:.52s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ“±</span><span class="cat-title">Screen Time</span></div>';
  h += card(screenHrsDay+' hrs/day','YOUR estimated screen time â€” '+workScreenHrs+'h from '+(isDesk?'your desk job':'work')+' + '+genScreenHrs+'h personal ('+generation+' average)'+(chronoBonus>0?' + 0.5h late-night owl scrolling':''),'color-accent');
  h += card(fmtE(screenHrsLife)+' hours','on screens so far â€” that\'s <strong>'+screenYrsLife+' years</strong> of your life','color-red');
  h += card(fmt(phoneTouchesLife),'phone touches in your lifetime â€” '+fmtE(phoneTouchesDay)+'/day ('+generation+' average)','color-pink');
  h += card(fmtE(scrollMilesLife)+' miles','scrolled on your phone â€” roughly '+Math.round(scrollMilesLife/25000*100)+'% around the Earth','color-blue');
  if (isDesk) h += card(fmtE(workScreenTotal)+' hours','staring at a work screen â€” that\'s '+(workScreenTotal/24).toFixed(0)+' full days of spreadsheets, emails, and Slack','color-orange');
  h += src('ğŸ“Š Source: screen time by generation (eMarketer), '+fmtE(phoneTouchesDay)+' touches/day (Dscout research, adjusted by generation)');
  h += '</div>';

  // â”€â”€ BODY FLUIDS â”€â”€
  h += '<div class="category anim" style="animation-delay:.54s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ’§</span><span class="cat-title">Body Production</span></div>';
  h += card(bloodVolumeLiters+' liters','of blood in your body right now â€” calculated from YOUR weight ('+weight+'kg Ã— 70ml/kg)','color-red');
  h += card(poolsFilled+' Olympic pools','your heart has pumped '+fmt(bloodPumped)+'L of blood â€” circulating your '+bloodVolumeLiters+'L about '+fmtE(Math.round(bloodPumped/parseFloat(bloodVolumeLiters)))+' times','color-pink');
  h += card(skinAreaM2+' mÂ²','YOUR skin surface area â€” calculated from your height ('+height+'cm) and weight ('+weight+'kg) using the DuBois formula','color-accent');
  h += card(fmtE(totalSweatLife)+' liters','of sweat produced â€” '+(exercise>0?'your '+exercise+'Ã—/week workouts add ~'+exerciseSweatL.toFixed(0)+'L/week extra':'minimal exercise means less sweat production'),'color-blue');
  h += card(fmtE(urineTotalLife)+' liters','of urine produced â€” '+(myCoffee>0?'your '+myCoffee+' coffee'+(myCoffee>1?'s':'')+'/day adds ~'+Math.round(urineCoffeeBonus*1000)+'ml/day (coffee is a diuretic)':'baseline ~1.5L/day'),'color-cyan');
  h += card(tearsLiters.toFixed(1)+' liters','of tears â€” '+(gender==='female'?'women produce ~50% more emotional tears than men':'men produce fewer emotional tears, but the same volume of basal tears'),'color-green');
  h += src('ğŸ“Š Source: DuBois body surface area formula, blood volume (70ml/kg), exercise physiology');
  h += '</div>';

  // â”€â”€ YOUR AGE ON OTHER PLANETS â”€â”€
  h += '<div class="category anim" style="animation-delay:.56s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸª</span><span class="cat-title">Your Age on Other Planets</span></div>';
  h += '<div class="fact-row">';
  h += cardS(mercuryAge,'years on Mercury','color-orange');
  h += cardS(venusAge,'years on Venus','color-pink');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS(marsAge,'years on Mars','color-red');
  h += cardS(jupiterAge,'years on Jupiter','color-accent');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS(saturnAge,'years on Saturn','color-cyan');
  h += cardS(neptuneAge,'years on Neptune','color-blue');
  h += '</div>';
  h += src('ğŸ“Š Source: planetary orbital periods (Mercury 0.24yr, Venus 0.62yr, Mars 1.88yr, Jupiter 11.86yr, Saturn 29.46yr, Neptune 164.8yr)');
  h += '</div>';

  // â”€â”€ SOCIAL NETWORK / PEOPLE â”€â”€
  h += '<div class="category anim" style="animation-delay:.58s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ¤</span><span class="cat-title">People & Connections</span></div>';
  h += card('~'+fmtE(peopleMet)+' people met','as a <strong>'+jobProfile.cat+'</strong> in <strong>'+city+'</strong> â€” '+jobPeoplePerWeek+'/week through work + '+friendPeoplePerWeek+'/week through social life ('+friendDaysPerWeek+' days with friends)','color-accent');
  h += card(fmtE(knownByEstimate),'people would recognize your face â€” '+(ci&&ci.population>1000000?'big cities mean more encounters':'smaller communities mean deeper connections'),'color-pink');
  h += card(fmtE(conversations)+' conversations','you\'ve had â€” '+(jobPeoplePerWeek>40?'your high-social job means ~10 conversations/day':'about 6 conversations per day on average'),'color-green');
  if (languages > 1) h += card(languages+' languages','giving you potential access to '+fmtE(langReach)+' speakers worldwide â€” '+Math.round(langReach/WORLD_POP*100)+'% of humanity','color-blue');
  if (kids > 0) h += card(fmtE(familyNetwork)+' people','in your extended social network â€” each of your '+kids+' kid'+(kids>1?'s':'')+' connects you to ~20 other parents through school and activities','color-cyan');
  h += card(fmtE(hugsGiven)+' hugs','given in your lifetime â€” '+(inRel?'couples hug ~3Ã—/day':'about 1 per day on average')+''+(kids>0?', plus '+kids+' kid'+(kids>1?'s':'')+' demanding hugs constantly':''),'color-orange');
  h += card(fmtE(friendHoursLife)+' hours','spent with friends â€” that\'s '+(friendHoursLife/24).toFixed(0)+' full days. '+(friendDaysPerWeek>=3?'You\'re highly social â€” this adds ~1 year to your life expectancy (Harvard longevity study)':friendDaysPerWeek>=1?'Moderate social life â€” even this frequency reduces mortality risk by 45%':'âš ï¸ Less than 1 day/week with friends â€” loneliness carries the health risk of smoking 15 cigarettes/day'),'color-blue');
  h += card(fmtE(friendHoursLeft)+' hours','of friend time remaining (at '+friendDaysPerWeek+' days/week Ã— '+yrsLeft+' years left) â€” '+(friendHoursLeft/24).toFixed(0)+' more days of laughing, eating, and doing nothing together','color-pink');
  h += src('ğŸ“Š Source: Harvard longevity study, Holt-Lunstad meta-analysis (social isolation), YOUR friend frequency');
  h += '</div>';

  // â”€â”€ COMPUTER SCIENCE / DIGITAL SELF â”€â”€
  h += '<div class="category anim" style="animation-delay:.6s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ’»</span><span class="cat-title">You as a Computer</span></div>';

  // Name in binary
  h += card('"'+name+'" in binary','<span style="font-family:Space Mono,monospace;font-size:11px;word-break:break-all;color:var(--accent2)">'+nameBinary+'</span>','color-accent');
  h += '<div class="fact-row">';
  h += cardS(nameBytes+' bytes','to store your name','color-blue');
  h += cardS(nameBits+' bits','your name in binary','color-cyan');
  h += '</div>';

  // Age in different bases
  h += card('Your age in code','<span style="font-family:Space Mono,monospace;font-size:14px;color:var(--accent2)">decimal: '+age+' Â· binary: '+ageBinary+' Â· hex: '+ageHex+' Â· octal: '+ageOctal+'</span>','color-green');

  // Hash
  h += card('hash("'+name+'")','<span style="font-family:Space Mono,monospace;font-size:16px;color:var(--orange)">'+nameHashHex+'</span><br><span style="font-size:12px;color:var(--text2)">Your name\'s unique fingerprint (djb2 hash) â€” change one letter and it\'s completely different</span>','color-orange');

  // Brain vs Computer
  h += dnaCard(brainStoragePB+' petabytes','your brain\'s estimated storage â€” that\'s <strong>'+fmtE(brainStorageTB)+' TB</strong>, enough for ~500 million songs or 4.3 billion photos','color-accent');
  h += card(fmt(brainOpsPerSec)+' ops/sec','your brain\'s processing power â€” comparable to the world\'s best supercomputers','color-pink');
  h += card(brainWatts+' watts','your brain runs on 20 watts â€” a dim lightbulb. The equivalent supercomputer needs <strong>'+fmt(supercomputerWatts)+' watts</strong>. Your brain is '+fmtE(brainEfficiency)+'Ã— more energy efficient','color-green');

  // DNA as storage
  h += card(dnaStorageMB+' MB','your DNA as a hard drive â€” 3.2 billion base pairs Ã— 2 bits each','color-blue');
  h += card(dnaCompressedMB+' MB','compressed â€” 99.9% of DNA is shared, only your unique part is <strong>'+dnaUniqueKB+' KB</strong>','color-cyan');

  // Your body as a system
  h += card(heartbeatsAsClockSpeed+' Hz','your heart\'s clock speed â€” '+heartbeatsAsClockSpeed+' beats per second','color-red');
  h += card(fmt(cellsInBody),'cells â€” if each cell were 1 byte of RAM, you\'d have '+cellsAsRAM+' GB of biological memory','color-accent');
  h += card(fmt(neuronFiringsLife),'total neuron firings in your lifetime â€” each one a tiny electrical signal carrying your thoughts','color-pink');

  // Digital footprint
  h += '<div class="fact-row">';
  h += cardS(fmtE(passwordsLife),'passwords created','color-orange');
  h += cardS(fmtE(totalLogins),'times logged in','color-blue');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS(fmtE(emailsSent),'emails sent','color-cyan');
  h += cardS(fmtE(googlesLife),'Google searches','color-green');
  h += '</div>';
  h += card(photosGB+' GB','of photos exist of you (~'+fmtE(photosOf)+' photos at ~4MB each)','color-pink');

  // Fun: your life as a progress bar
  const progressBar = 'â–ˆ'.repeat(Math.round(parseFloat(pctLived)/5)) + 'â–‘'.repeat(20-Math.round(parseFloat(pctLived)/5));
  h += card('Your life','<span style="font-family:Space Mono,monospace;font-size:16px;letter-spacing:2px;color:var(--accent2)">'+progressBar+'</span> <span style="font-size:13px;color:var(--text2)">'+pctLived+'% complete</span>','color-accent');

  h += src('ğŸ“Š Source: brain storage (Salk Institute), processing (AI Impacts), DNA encoding (2 bits/base pair), digital behavior research');
  h += '</div>';

  // â”€â”€ TIME SPENT â”€â”€
  h += '<div class="category anim" style="animation-delay:.62s">';
  h += '<div class="cat-header"><span class="cat-icon">â°</span><span class="cat-title">Time Spent Doing Things</span></div>';
  if (meetingHrsLife > 0) h += card(fmtE(meetingHrsLife)+' hours','in work meetings â€” at '+workHrsPerDay+'h/day, your job ('+jobProfile.cat+') is '+Math.round(jobProfile.meetPct*100)+'% meetings','color-red');
  if (commuteHrsLife > 0) h += card(fmtE(commuteHrsLife)+' hours','commuting â€” '+(ci&&ci.population>1000000?'living in a big city ('+city+') means ~1.5h/day':'~45 min/day average commute'),'color-orange');
  h += card(fmtE(stuckTrafficHrs)+' hours','stuck in traffic â€” '+(canDrive==='yes'?'as a driver, you spend ~54h/year in gridlock':'even without driving, ~15h/year on delayed buses/trains'),'color-pink');
  if (coffeeTimeHrs > 0) h += card(fmtE(coffeeTimeHrs)+' hours','making/buying your '+myCoffee+' daily coffee'+(myCoffee>1?'s':'')+' â€” ~5 min per cup adds up','color-accent');
  if (cookingHrs > 0) h += card(fmtE(cookingHrs)+' hours','cooking â€” as a '+cookLevel+' cook, ~'+cookMinPerDay+' min/day in the kitchen','color-green');
  if (exerciseHrsLife > 0) h += card(fmtE(exerciseHrsLife)+' hours','exercising â€” '+exercise+'Ã—/week since age 16','color-blue');
  if (petCareHrs > 0) h += card(fmtE(petCareHrs)+' hours','caring for your '+pets+' pet'+(pets>1?'s':'')+' â€” ~30 min/day of feeding, walking, and attention','color-cyan');
  if (kidsTimeHrs > 0) h += card(fmtE(kidsTimeHrs)+' hours','on active parenting â€” ~2h/day per kid for '+kids+' kid'+(kids>1?'s':''),'color-pink');
  if (glasses==='yes') h += card(fmtE(glassesHrs)+' hours','cleaning your glasses â€” ~2 min/day of smudge-fighting adds up','color-accent');
  h += card(fmtE(decidingWhatToEat)+' hours','deciding what to eat â€” '+(inRel?'couples take ~15 min/day (the eternal "I don\'t know, what do YOU want?")':'~8 min/day of solo menu paralysis'),'color-orange');
  h += card(fmtE(cleaningHrs)+' hours','cleaning â€” '+(kids>0?'with '+kids+' kid'+(kids>1?'s':'')+', that\'s 2Ã— more than a child-free person':'about 2h/week at the cleaning grind'),'color-blue');
  h += src('ğŸ“Š Source: OECD Time Use Survey, personalized by YOUR job, lifestyle, and household');
  h += '</div>';

  // â”€â”€ ğŸ“Š YOUR DAY â”€â”€
  h += '<div class="category anim" style="animation-delay:.63s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ“Š</span><span class="cat-title">Your Day (24 Hours)</span></div>';
  // Build bar chart
  h += '<div style="margin-bottom:16px">';
  const dayTotal = dayBreakdown.reduce((s,d)=>s+d.hours, 0);
  dayBreakdown.forEach(function(d) {
    const pct = (d.hours / 24 * 100).toFixed(1);
    if (d.hours >= 0.2) {
      h += '<div style="display:flex;align-items:center;margin-bottom:4px;gap:8px">';
      h += '<div style="width:130px;font-size:12px;color:var(--muted);text-align:right;flex-shrink:0">'+d.activity+'</div>';
      h += '<div style="flex:1;background:var(--card-bg);border-radius:4px;height:22px;overflow:hidden">';
      h += '<div style="width:'+pct+'%;background:'+d.color+';height:100%;border-radius:4px;min-width:2px"></div>';
      h += '</div>';
      h += '<div style="width:45px;font-size:12px;color:var(--text);font-family:Space Mono,monospace;flex-shrink:0">'+d.hours.toFixed(1)+'h</div>';
      h += '</div>';
    }
  });
  h += '</div>';
  h += card(freeTime+'h free','out of 24 â€” that\'s '+Math.round(freeTime/24*100)+'% of your day that\'s truly yours'+(freeTime<2?' â€” you barely have time to breathe':freeTime<4?' â€” not much, but you make it work':' â€” a solid chunk of freedom'),'color-green');
  if (freeTime < dayWorkHrs) h += card('Work > Free time','you spend '+dayWorkHrs+'h working but only '+freeTime+'h on yourself â€” your job owns '+Math.round(dayWorkHrs/24*100)+'% of your waking life','color-red');
  if (sleepHrs + dayWorkHrs + dayCommuteHrs > 18) h += card('âš ï¸ Overloaded day','sleep ('+sleepHrs+'h) + work ('+dayWorkHrs+'h) + commute ('+dayCommuteHrs+'h) = '+Math.round((sleepHrs+dayWorkHrs+dayCommuteHrs)*10)/10+'h â€” that leaves almost nothing','color-red');
  h += src('ğŸ“Š Source: YOUR inputs â€” sleep, job hours, commute, exercise, cooking, coffee, pets, kids');
  h += '</div>';

  // â”€â”€ PROBABILITY OF YOU â”€â”€
  h += '<div class="category anim" style="animation-delay:.64s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ²</span><span class="cat-title">The Probability of You</span></div>';
  // Show YOUR specific trait combination
  h += dnaCard('1 in '+fmtE(oneInTraits),'the odds of YOUR specific combination of traits existing in one person','color-accent');
  let traitList = traitProbs.map(t => t.trait + ' ('+Math.round(t.prob*100)+'%)').join(' Ã— ');
  h += card('Your trait stack',''+traitList+' â€” multiply them all together and you get your uniqueness','color-pink');
  if (blood && blood !== 'unknown') h += card(blood+' blood Ã— '+(hand==='left'?'left':'right')+'-handed Ã— '+eyes+' eyes','just these 3 traits narrow you to '+Math.round(myBlood.pct * handPct * myEyes.pct / 10000)+'% of the population','color-blue');
  h += card('1 in 400,000,000','the sperm lottery alone â€” then multiply by YOUR name rarity, blood type, eye color, education, and every skill you\'ve acquired','color-red');
  h += card('0%... but 100%','the mathematical probability of someone with YOUR exact combination of traits, name, and life choices is essentially zero. Yet here you are.','color-green');
  h += src('ğŸ“Š Source: Trait probability analysis using YOUR personal data, Dr. Ali Binazir\'s framework');
  h += '</div>';

  // â”€â”€ ENVIRONMENTAL FOOTPRINT â”€â”€
  h += '<div class="category anim" style="animation-delay:.66s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸŒ</span><span class="cat-title">Your Environmental Footprint</span></div>';
  h += card(co2PerYearTons+' tons/year','YOUR annual COâ‚‚ â€” baseline 4.7t + '+(canDrive==='yes'?'driving (+2.4t)':'no car (0t)')+' + '+(passport==='yes'?'flights (+1.5t)':'no flights (0t)')+''+(bikeSaving<0?' âˆ’ cycling (âˆ’0.3t)':''),'color-orange');
  h += card(co2Lifetime+' tons total','your lifetime carbon footprint so far','color-red');
  if (canDrive==='yes') h += card(fmtE(lifetimeDriveKm)+' km driven','producing '+driveCarsCO2+' tons of COâ‚‚ â€” that\'s '+Math.round(lifetimeDriveKm/40075)+' trips around Earth','color-pink');
  if (passport==='yes') h += card(fmtE(flightKmLife)+' km flown','producing ~'+(flightCO2annual*Math.max(0,age-16)).toFixed(0)+' tons of COâ‚‚ â€” aviation is '+(Math.round(flightCO2annual/co2PerYearTons*100))+'% of your annual footprint','color-cyan');
  if (canBike==='yes'&&exercise>=2) h += card('-0.3 tons/year','saved by cycling â€” your bike habit offsets ~'+(0.3/co2PerYearTons*100).toFixed(0)+'% of your annual footprint','color-green');
  h += card(fmtE(treesToOffset)+' trees','needed to offset '+co2Lifetime+' tons â€” '+(treesToOffset/400).toFixed(1)+' football fields of forest','color-green');
  if (kids > 0) h += card(totalFamilyCO2+' tons','YOUR family\'s total footprint â€” each of your '+kids+' kid'+(kids>1?'s':'')+' adds ~58% of your annual output','color-accent');
  h += card(co2Left+' tons','you\'ll still produce at this rate â€” '+(canBike==='yes'||canDrive==='no'?'your lower-car lifestyle helps':'switching to cycling or public transit could cut this significantly'),'color-blue');
  h += src('ğŸ“Š Source: World Bank (4.7t base), EPA vehicle emissions (210g/km), ICAO flight emissions');
  h += '</div>';

  // â”€â”€ MATHEMATICAL YOU â”€â”€
  h += '<div class="category anim" style="animation-delay:.68s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ”¢</span><span class="cat-title">Mathematical You</span></div>';
  h += card(ageIsPrime?'âœ… PRIME!':'âŒ Not prime','your age ('+age+') is '+(ageIsPrime?'a prime number â€” indivisible, unique, irreducible. Just like you.':'not prime. Your next prime birthday: <strong>'+nextPrimeAge+'</strong>'),ageIsPrime?'color-green':'color-orange');
  h += card(ageIsFibonacci?'âœ… FIBONACCI!':'âŒ Not Fibonacci','your age '+(ageIsFibonacci?'is part of the Fibonacci sequence (1,1,2,3,5,8,13,21,34,55,89...) â€” nature\'s favorite pattern':'is not in the Fibonacci sequence â€” the golden ratio skipped you this year'),ageIsFibonacci?'color-green':'color-orange');
  if(ageIsPerfectSquare) h += card('âœ… PERFECT SQUARE','your age is '+Math.sqrt(age)+'Â² â€” mathematically satisfying','color-green');
  if(agePowerOf2) h += card('âœ… POWER OF 2','your age is 2^'+Math.log2(age)+' â€” you\'re living in binary perfection','color-green');
  h += card(collatzSteps+' steps','it takes your age ('+age+') to reach 1 in the Collatz sequence â€” the famous unsolved problem in mathematics','color-accent');
  h += card('Digit sum: '+bdDigitSum,'your birthday digits ('+bdDigits+') add up to '+bdDigitSum+(isPrime(bdDigitSum)?' â€” which is prime!':'')+'. In numerology this is your "life path number"','color-pink');
  if(age<=20) h += card(age+'! = '+fmtE(ageFactorial),'your age factorial â€” multiply every number from 1 to '+age,'color-blue');
  h += src('ğŸ“Š Source: number theory, Collatz conjecture (still unsolved since 1937)');
  h += '</div>';

  // â”€â”€ YOUR SENSES â”€â”€
  h += '<div class="category anim" style="animation-delay:.7s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ‘€</span><span class="cat-title">Your Senses</span></div>';
  h += card(myEyes.emoji+' '+eyes+' eyes â€” '+myEyes.pct+'% of people','only '+myEyes.pct+'% share your eye color'+(glasses==='yes'?' â€” with glasses, you see the full ~10M colors your '+eyes+' eyes can detect. Without them, only ~7M (30% reduction in sharpness)':' â€” your uncorrected vision captures the full ~10M color range'),'color-accent');
  h += card(fmtE(pitchesDetectable)+' distinct pitches','your ear can detect â€” '+(instrument==='yes'?'playing an instrument trained your ear to hear 5Ã— more pitch variations than non-musicians (1,500 vs 300)':'untrained ears detect ~300 pitches â€” learning an instrument would boost this to 1,500'),'color-pink');
  h += card(fmtE(smellsDetectable)+' scents',(cigsPerDay>0?'your nose can detect â€” <strong>your '+cigsPerDay+' cigarettes/day '+(cigsPerDay>=10?'has cut this in half':'has reduced this by ~25%')+'</strong>. Non-smokers detect ~1 trillion':'your nose can detect â€” more than any scientific instrument on Earth'),'color-green');
  h += card(fmtE(tasteBudsSmoking)+' taste buds',(cigsPerDay>=10?'on your tongue â€” '+cigsPerDay+' cigs/day has dulled ~30% of them. You\'re tasting a muted version of food.':cigsPerDay>=1?'on your tongue â€” even '+cigsPerDay+' cigs/day dulls ~15% of your taste buds.':(gender==='female'?'on your tongue â€” women have ~25% more than men, making you a more sensitive taster':'on your tongue â€” detecting 5 basic tastes across '+fmtE(tasteBudsSmoking)+' receptors')),'color-orange');
  if (languages > 1) h += card(fmtE(vocabSize)+' words','in your vocabulary across '+languages+' languages â€” bilingual brains can detect '+phonemesDetectable+' distinct speech sounds (monolinguals: ~50)','color-blue');
  else h += card('~50,000 words','in your vocabulary â€” learning a second language would double this and let your brain detect 130+ speech sounds instead of ~50','color-blue');
  h += src('ğŸ“Š Source: Vision research, pitch perception (trained vs untrained ear), olfactory studies (Science 2014), smoking impact on senses');
  h += '</div>';

  // â”€â”€ COSMIC SPEED â”€â”€
  h += '<div class="category anim" style="animation-delay:.72s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸš€</span><span class="cat-title">You\'re Never Still</span></div>';
  h += card(fmtE(earthRotationSpeed)+' km/h','Earth\'s rotation at <strong>'+city+'</strong> ('+Math.abs(cityLat).toFixed(1)+'Â° latitude) â€” '+(Math.abs(cityLat)<25?'near the equator, you\'re spinning at near-maximum speed!':Math.abs(cityLat)>55?'at high latitude, you spin slower than people at the equator':'mid-latitude gives you moderate rotational speed'),'color-accent');
  h += dnaCard(fmtE(totalCosmicSpeed)+' km/h','your TOTAL cosmic speed right now â€” sitting in '+city+', you\'re hurtling through the universe','color-pink');
  h += card(fmtE(personalMovementKm)+' km','YOU have personally traveled on Earth â€” '+fmtE(walkKmLife)+' km walked'+(driveKmLife>0?', '+fmtE(driveKmLife)+' km driven':'')+(bikeKmLife>0?', '+fmtE(bikeKmLife)+' km cycled':'')+(flightKmLife>0?', '+fmtE(flightKmLife)+' km flown':''),'color-green');
  if (personalMovementKm > 0) h += card(((personalMovementKm/40075)*100).toFixed(1)+'% of Earth','your personal movement equals '+Math.round(personalMovementKm/40075*10)/10+' trips around the planet','color-blue');
  h += card(fmt(kmTraveledCosmic)+' km','distance through space since birth â€” '+(personalMovementKm>0?'the cosmos moved you '+fmtE(Math.round(kmTraveledCosmic/personalMovementKm))+' times further than you\'ve ever walked, driven, or flown combined':'the cosmos carried you entirely without your effort'),'color-cyan');
  h += src('ğŸ“Š Source: Earth rotation at YOUR latitude (1,670 Ã— cos('+Math.abs(cityLat).toFixed(1)+'Â°)), YOUR transport modes');
  h += '</div>';

  // â”€â”€ ANIMAL COMPARISONS â”€â”€
  h += '<div class="category anim" style="animation-delay:.74s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ¦</span><span class="cat-title">Animal Comparisons</span></div>';
  h += card('Closest match: '+closestHeightAnimal.name,'at '+closestHeightAnimal.cm+'cm, the '+closestHeightAnimal.name+' is the animal closest to your height ('+height+'cm)','color-accent');
  h += card(fmtE(antStackHeight)+' ants','stacked on top of each other to reach your height','color-green');
  h += card(giraffeCount+' giraffes','you are '+giraffeCount+' giraffes tall','color-orange');
  h += card('Weight twin: '+closestWeightAnimal.name,'at '+closestWeightAnimal.kg+'kg â€” closest animal to your weight ('+weight+'kg)','color-pink');
  h += card(catCount+' cats','you weigh as much as '+catCount+' house cats','color-blue');
  h += card(blueWhaleCount+'%','of a blue whale â€” you\'d need '+(140000/weight).toFixed(0)+' of you to match one','color-cyan');
  h += card('$'+fmt(goldKgValue),'what you\'d be worth if made of solid gold (at current prices)','color-orange');
  h += src('ğŸ“Š Source: average animal sizes (National Geographic, WWF data)');
  h += '</div>';

  // â”€â”€ GENERATION & ERA â”€â”€
  h += '<div class="category anim" style="animation-delay:.76s">';
  h += '<div class="cat-header"><span class="cat-icon">'+genEmoji+'</span><span class="cat-title">Your Generation</span></div>';
  h += card(genEmoji+' '+generation,'born '+bY+' ('+genYears+') â€” '+genFact,'color-accent');
  h += card('When you were born:',techTimeline.slice(0,4).join(' Â· '),'color-blue');
  const ageIn2000 = 2000 - bY;
  if(ageIn2000 >= 0 && ageIn2000 <= 100) h += card('Y2K','you were '+ageIn2000+' years old when the world thought computers would end civilization','color-pink');
  const ageIn2020 = 2020 - bY;
  if(ageIn2020 >= 0 && ageIn2020 <= 100) h += card('COVID-19','you were '+ageIn2020+' when the pandemic hit â€” one of the defining events of your generation','color-orange');
  const iphone2007 = 2007 - bY;
  if(iphone2007 >= 0 && iphone2007 <= 100) h += card('First iPhone','you were '+iphone2007+' when the smartphone revolution began (2007)','color-cyan');
  h += src('ğŸ“Š Source: Pew Research Center generational definitions');
  h += '</div>';

  // â”€â”€ BODY VERSIONS â”€â”€
  h += '<div class="category anim" style="animation-delay:.78s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ”„</span><span class="cat-title">Body Versions</span></div>';
  h += card('Version '+bodyVersions,'of yourself â€” most of your cells have been replaced '+bodyVersions+' times. You\'re literally not the same person you were 10 years ago','color-accent');
  h += '<div class="fact-row">';
  h += cardS(fmtE(rbcReplacements)+'Ã—','red blood cells replaced (every 120 days)','color-red');
  h += cardS(fmtE(skinReplaced)+'Ã—','entire skin replaced (every 28 days)','color-pink');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS(fmtE(stomachReplacements)+'Ã—','stomach lining replaced (every 5 days)','color-orange');
  h += cardS(fmtE(tastebudReplacements)+'Ã—','taste buds replaced (every 2 weeks)','color-green');
  h += '</div>';
  h += card(skeletonReplacements+'Ã—','entire skeleton rebuilt â€” bones completely renew every ~10 years','color-blue');
  h += card('Original parts:','<strong>'+originalParts.join(', ')+'</strong> â€” these have been with you since the beginning and will never be replaced','color-cyan');
  h += src('ğŸ“Š Source: cell biology (Red Cross, Nature Cell Biology, Stanford cell turnover studies)');
  h += '</div>';

  // â”€â”€ WHAT IF â”€â”€
  h += '<div class="category anim" style="animation-delay:.8s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ’­</span><span class="cat-title">What If?</span></div>';
  h += card('$'+fmtE(parseInt(dollarPerDay)),'if you\'d saved $1 every day since birth','color-accent');
  h += card('$'+fmtE(dollarCompound),'if that $1/day was invested at 7% annual return â€” compound interest is magic','color-green');
  h += card(fmtE(booksOnToilet)+' books','you could have read if you read 1 page per toilet visit â€” that\'s an entire library','color-pink');
  h += card('$'+fmtE(sleepWageValue),'you\'d have earned if you worked minimum wage instead of sleeping â€” but please don\'t','color-orange');
  if(ci) {
    const walkToTokyo = Math.round(distKm(ci.lat,ci.lon,35.68,139.69) / walkSpeedKmH / 24);
    const walkToNY = Math.round(distKm(ci.lat,ci.lon,40.71,-74.01) / walkSpeedKmH / 24);
    const walkToSydney = Math.round(distKm(ci.lat,ci.lon,-33.87,151.21) / walkSpeedKmH / 24);
    h += card(fmtE(walkToTokyo)+' days','to walk non-stop from '+city+' to Tokyo ('+fmtE(distKm(ci.lat,ci.lon,35.68,139.69))+' km at 5 km/h)','color-blue');
    if(walkToNY !== walkToTokyo) h += card(fmtE(walkToNY)+' days','to walk from '+city+' to New York','color-cyan');
  }
  h += card(fmtE(Math.round(daysAlive * 2000))+' calories','if you\'d eaten nothing but pizza since birth, that\'s '+fmtE(Math.round(daysAlive*2000/285))+' slices (~285 cal/slice)','color-red');
  h += src('ğŸ“Š Source: S&P 500 avg 7% return, walking speed 5 km/h, compound interest formula');
  h += '</div>';

  // â”€â”€ BLOOD TYPE â”€â”€
  if (blood && blood !== 'unknown') {
    h += '<div class="category anim" style="animation-delay:.82s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸ©¸</span><span class="cat-title">Your Blood</span></div>';
    h += card('Type '+blood+' â€” '+myBlood.pct+'%','of the world population. '+myBlood.fact,'color-red');
    h += card(fmt(bloodPeopleSame),'people on Earth share your blood type','color-accent');
    h += card('You can donate to:','<strong>'+myBlood.canGiveTo+'</strong>','color-green');
    h += card('You can receive from:','<strong>'+myBlood.canReceiveFrom+'</strong>','color-blue');
    if (blood === 'O-') h += dnaCard('ğŸ¦¸ Universal Donor','your blood type can be given to ANYONE in an emergency â€” you are literally a walking life-saver','color-green');
    if (blood === 'AB+') h += dnaCard('ğŸ§² Universal Receiver','you can receive blood from anyone â€” in an emergency, any blood bank can help you','color-green');
    if (blood === 'AB-') h += card('ğŸ’ Rarest type','only 1 in ~167 people shares your blood â€” hospitals desperately need you to donate','color-pink');
    h += src('ğŸ“Š Source: American Red Cross blood type distribution data');
    h += '</div>';
  }

  // â”€â”€ HANDEDNESS â”€â”€
  h += '<div class="category anim" style="animation-delay:.84s">';
  h += '<div class="cat-header"><span class="cat-icon">âœ‹</span><span class="cat-title">Your Dominant Hand</span></div>';
  h += card((hand==='left'?'ğŸ¤š':'âœ‹')+' '+hand.charAt(0).toUpperCase()+hand.slice(1)+'-handed â€” '+handPct+'%','of the world population. '+handFacts[hand],'color-accent');
  h += card(fmt(handPeople),'people share your hand dominance','color-blue');
  if (hand === 'left') {
    h += card('Famous lefties','Leonardo da Vinci, Einstein, Obama, Jimi Hendrix, Oprah, Bill Gates, Lionel Messi','color-pink');
    h += card('Lefty tax','You\'ve had to adapt to a right-handed world: scissors, desks, can openers, notebooks, guitars â€” all designed against you','color-orange');
  }
  if (hand === 'ambidextrous') h += card('1 in 100','true ambidexterity is extremely rare â€” some researchers believe it correlates with higher creativity','color-green');
  h += src('ğŸ“Š Source: handedness research (McManus, 2019), ~10% left-handed globally');
  h += '</div>';

  // â”€â”€ EYE COLOR â”€â”€
  h += '<div class="category anim" style="animation-delay:.86s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ‘ï¸</span><span class="cat-title">Your Eyes</span></div>';
  h += card(eyes.charAt(0).toUpperCase()+eyes.slice(1)+' eyes â€” '+myEyes.pct+'%','of the world. '+myEyes.fact,'color-accent');
  h += card(fmt(eyePeopleSame),'people share your eye color','color-blue');
  if (glasses === 'yes') {
    h += card('ğŸ‘“ Vision corrected',correctedVisionFact,'color-orange');
    h += card(fmtE(myopiaPct)+'%','of the world is near-sighted â€” and it\'s increasing rapidly due to screen time','color-pink');
  } else {
    h += card('ğŸ‘ï¸ Natural vision',correctedVisionFact,'color-green');
  }
  h += src('ğŸ“Š Source: World Atlas eye color distribution, WHO vision data');
  h += '</div>';

  // â”€â”€ YOUR SLEEP â”€â”€
  h += '<div class="category anim" style="animation-delay:.88s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ˜´</span><span class="cat-title">Your Sleep</span></div>';
  h += card(actualSleepYrs+' years','spent sleeping so far at your '+sleepHrs+'h/night rate','color-blue');
  h += card(fmtE(totalDreams)+' dreams','approximately '+dreamsPerNight+' dreams per night Ã— '+fmtE(daysAlive)+' nights alive','color-pink');
  if (sleepDebtHrs > 0) h += card(fmtE(sleepDebtHrs)+' hours','of sleep debt â€” you\'re '+fmtE(sleepDebtHrs)+' hours behind the recommended 8h/night. That\'s '+(sleepDebtHrs/24).toFixed(0)+' full days of lost sleep','color-red');
  if (sleepExcessHrs > 0) h += card(fmtE(sleepExcessHrs)+' hours','of bonus sleep vs the 8h recommendation â€” '+(sleepExcessHrs/24).toFixed(0)+' extra days in dreamland','color-green');
  h += card(fmtE(Math.round(sleepHrs * yrsLeft * 365))+' hours','of sleep still ahead of you â€” that\'s '+((sleepHrs*yrsLeft*365)/8760).toFixed(1)+' more years with your eyes closed','color-cyan');
  h += src('ğŸ“Š Source: sleep science (avg '+dreamsPerNight+' dreams/night at '+sleepHrs+'h), WHO recommended 7-9h/night');
  h += '</div>';

  // â”€â”€ LANGUAGES â”€â”€
  h += '<div class="category anim" style="animation-delay:.9s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ—£ï¸</span><span class="cat-title">Languages</span></div>';
  h += card('You are '+polyglotLevel,'speaking '+languages+' language'+(languages>1?'s':'')+' â€” only ~'+langPct+'% of the world speaks this many','color-accent');
  h += card('~'+fmtE(totalVocabulary)+' words','your estimated active vocabulary across all languages (~20,000 per language)','color-blue');
  if (languages >= 2) h += card('ğŸ§  Bilingual advantage','research shows multilingual brains have denser gray matter, better multitasking, and delayed onset of dementia by ~4.5 years','color-green');
  if (languages >= 4) h += card('ğŸŒ Top '+langPct+'%','you speak more languages than '+(100-langPct)+'% of Earth\'s population â€” there are only ~7,000 languages total and you know '+languages+' of them','color-pink');
  h += card(fmtE(Math.round(7000/languages))+'Ã—','more languages exist that you don\'t speak â€” 7,000 living languages on Earth','color-orange');
  h += src('ğŸ“Š Source: Ethnologue (7,000 languages), bilingual cognition research (Bialystok et al.)');
  h += '</div>';

  // â”€â”€ COFFEE â”€â”€
  if (myCoffee > 0) {
    h += '<div class="category anim" style="animation-delay:.92s">';
    h += '<div class="cat-header"><span class="cat-icon">â˜•</span><span class="cat-title">Your Coffee Habit</span></div>';
    h += card(fmtE(myCoffeeLifetime)+' cups','of coffee consumed in your lifetime at '+myCoffee+' cups/day','color-orange');
    h += card(fmtE(myCoffeeLeft)+' cups','still to drink before you die','color-accent');
    h += card(coffeineLifetimeKg+' kg','of pure caffeine consumed â€” at '+coffeineMg+'mg/day','color-red');
    h += card('$'+fmtE(coffeeCostLifetime),'spent on coffee (at ~$3.50/cup average)','color-pink');
    h += card(fmtE(coffeeWaterLiters)+' liters','of coffee liquid â€” '+coffeeBathtubs+' bathtubs full','color-blue');
    h += src('ğŸ“Š Source: personal input ('+myCoffee+' cups/day), avg 95mg caffeine/cup, ~$3.50 avg cost');
    h += '</div>';
  }

  // â”€â”€ PETS â”€â”€
  if (pets > 0) {
    h += '<div class="category anim" style="animation-delay:.94s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸ¾</span><span class="cat-title">Your Pets</span></div>';
    h += card(pets+' pet'+(pets>1?'s':'')+' Â· ~'+fmtE(Math.round(petYearsJoy))+' pet-years','of companionship so far'+(exercise>=2?' â€” your active lifestyle means ~'+petWalksPerDay.toFixed(1)+' walks/day together':exercise>=1?' â€” about '+petWalksPerDay.toFixed(1)+' walks/day together':' â€” about '+petWalksPerDay.toFixed(1)+' walk/day together'),'color-accent');
    h += card(fmtE(petCareHrs)+' hours','you\'ve spent feeding, walking, and caring for your pet'+(pets>1?'s':'')+' â€” that\'s '+(petCareHrs/24).toFixed(0)+' full days','color-green');
    h += card(fmtE(petWalks)+' walks','together â€” '+(chronotype==='early'?'as an early bird, these are sunrise walks â˜€ï¸':chronotype==='night'?'as a night owl, many of these are late-night strolls ğŸŒ™':'a mix of morning and evening routes'),'color-blue');
    if (petSleepDisrupt > 0) h += card('~'+fmtE(petSleepDisrupt)+' times','your pet has woken you up â€” at your '+sleepHrs+'h/night schedule, that\'s roughly '+(petSleepDisrupt*20/60).toFixed(0)+' hours of lost sleep','color-orange');
    if (kidsWithPets) h += card(kids+' kid'+(kids>1?'s':'')+' + '+pets+' pet'+(pets>1?'s':''),'your household is a small zoo â€” studies show kids raised with pets develop stronger empathy and immune systems','color-pink');
    h += src('ğŸ“Š Source: YOUR exercise frequency, chronotype, and household composition');
    h += '</div>';
  }

  // â”€â”€ RELATIONSHIP â”€â”€
  h += '<div class="category anim" style="animation-delay:.96s">';
  h += '<div class="cat-header"><span class="cat-icon">'+rel.emoji+'</span><span class="cat-title">Love & Relationships</span></div>';
  h += card(rel.emoji+' '+rel.label+' â€” '+rel.pct+'% of adults',''+rel.funFact,'color-pink');
  if (relationship === 'single') {
    h += card(relDuration > 0 ? fmtE(Math.round(relDuration*365))+' days single' : 'Single','you\'ve '+(relDuration>0?'been single for '+relDuration+' year'+(relDuration>1?'s':'')+' â€” that\'s '+fmtE(Math.round(relDuration*365*16))+' waking hours of complete autonomy':'been navigating solo')+(singleYears>0?' ('+singleYears.toFixed(0)+' of '+(age-16)+' adult years single â€” '+Math.round(singleYears/(age-16)*100)+'%)':''),'color-accent');
    if (friendDaysPerWeek >= 2) h += card('ğŸ‘« '+friendDaysPerWeek+' days/week with friends','your social life fills the gap â€” you spend ~'+fmtE(Math.round(friendHoursPerWeek*52))+' hours/year with friends, which is more quality time than most married couples get','color-green');
    else h += card('âš ï¸ '+friendDaysPerWeek+' day'+(friendDaysPerWeek===1?'':'s')+'/week with friends','being single with low social contact doubles loneliness risk â€” even adding 1 more friend day/week makes a huge difference','color-orange');
  }
  if (relationship === 'dating') {
    h += card(relYears.toFixed(1)+' years together','that\'s ~'+fmtE(relHoursShared)+' hours shared so far â€” '+(relYears>5?'well beyond the 3-year itch':relYears>3?'past the honeymoon phase â€” the real partnership begins':relYears>1?'still in the golden window':'the exciting early days'),'color-accent');
    h += card(fmtE(dateNights)+' date nights','over '+relYears.toFixed(1)+' years (~1/week) â€” plus '+fmtE(argumentsInRel)+' arguments and '+fmtE(iLoveYous)+' "I love you"s','color-pink');
    h += card(fmtE(relHoursLeft)+' hours left','of quality time ahead â€” but your '+workHrsPerDay+'h/day job takes '+(Math.round(workHrsPerDay/(workHrsPerDay+6)*100))+'% of your waking weekday','color-blue');
    if (chronoRelFact) h += card('â° Chronotype clash?',chronoRelFact,'color-orange');
  }
  if (relationship === 'married') {
    h += card(relYears.toFixed(1)+' years married','~'+fmtE(relHoursShared)+' hours together â€” '+(relYears>25?'silver anniversary territory â€” you\'ve spent more time with this person than with anyone else alive':relYears>10?'over a decade â€” you\'ve shared '+fmtE(argumentsInRel)+' arguments and '+fmtE(iLoveYous)+' "I love you"s':relYears>5?'past the adjustment phase â€” satisfaction typically starts climbing again now':'the newlywed years â€” enjoy the honeymoon glow'),'color-accent');
    h += card(fmtE(relHoursLeft)+' hours left','with your spouse (~12h/day) â€” your '+workHrsPerDay+'h/day job takes '+Math.round(workHrsPerDay/12*100)+'% of your shared daytime','color-blue');
    h += card(pctAdultLifeInRel+'% of adult life','spent in this relationship â€” '+(pctAdultLifeInRel>70?'this person IS your adult life':pctAdultLifeInRel>50?'more than half your adult memories include them':pctAdultLifeInRel>30?'a significant chapter of your story':'a meaningful but not dominant chapter'),'color-pink');
    if (chronoRelFact) h += card('â° Chronotype factor',chronoRelFact,'color-orange');
    if (kids > 0) h += card('Post-kids time','with '+kids+' kid'+(kids>1?'s':'')+', couples get ~30 min/day of uninterrupted conversation â€” down from ~2 hours pre-kids','color-green');
  }
  if (relationship === 'divorced') {
    if (relDuration > 0) h += card(relDuration+' year'+(relDuration>1?'s':'')+' since divorce','you\'ve rebuilt '+fmtE(Math.round(relDuration*365*16))+' waking hours of life on your own terms','color-accent');
    h += card(pctAdultLifeInRel+'% of adult life in relationships','you spent '+(age-16-singleYears).toFixed(0)+' years in relationships and '+singleYears.toFixed(0)+' years single','color-blue');
    if (friendDaysPerWeek >= 2) h += card('ğŸ‘« Strong social network',''+friendDaysPerWeek+' days/week with friends â€” your social bonds are your foundation now','color-green');
    if (kids > 0) h += card(kids+' kid'+(kids>1?'s':''),'co-parenting is '+Math.round(kids*2*365)+' hours/year of coordination â€” children of divorce often develop exceptional resilience','color-pink');
  }
  h += src('ğŸ“Š Source: Gottman Institute, personalized by YOUR chronotype, work hours, and family');
  h += '</div>';

  // â”€â”€ KIDS â”€â”€
  if (kids > 0) {
    h += '<div class="category anim" style="animation-delay:.97s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸ‘¶</span><span class="cat-title">Parenthood</span></div>';
    h += card(kids+' kid'+(kids>1?'s':''),'each one a universe of chaos, joy, and sleep deprivation','color-accent');
    h += card(fmtE(totalDiapers)+' diapers','changed â€” that\'s '+(totalDiapers*0.15).toFixed(0)+' kg of... well, you know','color-orange');
    h += card(fmtE(totalSleepLostHrs)+' hours','of sleep lost to your kids â€” '+(totalSleepLostHrs/24).toFixed(0)+' full days of zombie mode','color-red');
    h += card(fmtE(totalQuestions)+' questions','answered from "why is the sky blue?" to "why?" to "but why?" to "WHY?"','color-pink');
    h += card('$'+fmtE(kids * moneyPerKid),'estimated cost to raise your '+kids+' kid'+(kids>1?'s':'')+' to age 18 ($310k per child avg)','color-blue');
    h += card(fmtE(mealsCooked)+' meals','you\'ll cook for your children â€” and hear "I\'m not hungry" for at least half of them','color-green');
    h += src('ğŸ“Š Source: USDA child-rearing cost data (~$310k/child), pediatric sleep studies');
    h += '</div>';
  }

  // â”€â”€ EXERCISE / FITNESS â”€â”€
  h += '<div class="category anim" style="animation-delay:.98s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ‹ï¸</span><span class="cat-title">Exercise & Fitness</span></div>';
  if (gymDaysPerWeek === 0) {
    h += card('ğŸ›‹ï¸ 0 days/week','you don\'t exercise. Only ~25% of adults meet recommended activity levels, so... you\'re in the majority','color-orange');
    h += card('+'+exerciseLifeBonus.toFixed(1)+' years','life expectancy bonus from exercise: <strong>none</strong>. Even 15 min/day of walking adds ~3 years.','color-red');
  } else {
    h += card(gymDaysPerWeek+'Ã—/week','you exercise '+gymDaysPerWeek+' times per week â€” that puts you in the top '+(gymDaysPerWeek>=4?'5':'25')+'% of adults globally','color-green');
    h += card(fmtE(gymHoursLife)+' hours','spent exercising so far â€” that\'s '+(gymHoursLife/24).toFixed(0)+' full days of sweat','color-accent');
    h += card(fmtE(Math.round(totalCaloriesBurned))+' calories','burned â€” equivalent to '+fmtE(pizzaEquiv)+' slices of pizza','color-orange');
    if (weightLiftedEstimate > 0) h += card(fmtE(weightLiftedEstimate)+' kg','estimated total weight lifted â€” '+fmtE(Math.round(weightLiftedEstimate/6000))+' elephants','color-blue');
    h += card('+'+exerciseLifeBonus.toFixed(1)+' years','estimated life expectancy bonus from your exercise habit','color-green');
    h += card(fmtE(gymHoursLeft)+' hours','of workouts still ahead of you â€” keep going','color-cyan');
  }
  h += src('ğŸ“Š Source: WHO physical activity guidelines, Harvard longevity studies, ~400cal/session avg');
  h += '</div>';

  // â”€â”€ ALCOHOL â”€â”€
  if (alcohol !== 'never') {
    h += '<div class="category anim" style="animation-delay:.99s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸ·</span><span class="cat-title">Alcohol</span></div>';
    h += card(fmtE(totalDrinksLife)+' drinks','consumed since age 18 (~'+weeklyDrinks.toFixed(1)+'/week)','color-accent');
    h += card(alcoholLiters+' liters','of alcoholic beverages â€” '+pureAlcoholLiters+' liters of pure ethanol','color-orange');
    h += card(fmtE(alcoholCalories)+' calories','from alcohol alone â€” that\'s '+Math.round(alcoholCalories/3500)+' lbs ('+((alcoholCalories/3500)*0.45).toFixed(0)+' kg) of body fat equivalent','color-red');
    h += card('$'+fmtE(alcoholCostLife),'estimated spent on alcohol (at ~$8/drink average)','color-pink');
    if (weeklyDrinks > 14) h += card('âš ï¸ Heavy use','more than 14 drinks/week significantly increases health risks â€” your liver is working overtime','color-red');
    h += src('ğŸ“Š Source: NIAAA drink definitions, ~150 cal/drink avg, WHO alcohol guidelines');
    h += '</div>';
  } else {
    h += '<div class="category anim" style="animation-delay:.99s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸ·</span><span class="cat-title">Alcohol</span></div>';
    h += card('ğŸš« Teetotaler','you don\'t drink â€” only ~30% of the global population abstains entirely. Your liver thanks you.','color-green');
    h += card('$0','spent on alcohol â€” while the average person spends $50,000+ in a lifetime','color-accent');
    h += src('ğŸ“Š Source: WHO global alcohol report');
    h += '</div>';
  }

  // â”€â”€ SMOKING â”€â”€
  if (cigsPerDay > 0) {
    h += '<div class="category anim" style="animation-delay:1s">';
    h += '<div class="cat-header"><span class="cat-icon">ğŸš¬</span><span class="cat-title">Smoking</span></div>';
    h += card(cigsPerDay+' cigarettes/day','that\'s '+packsPerDay+' packs/day, or '+fmtE(cigsPerDay*365)+' cigarettes per year','color-accent');
    h += card(fmtE(totalCigsLife)+' cigarettes','smoked over ~'+smokingYears+' years (since age 18)','color-orange');
    h += card(fmtE(daysLostSmoking)+' days of life lost','each cigarette costs ~11 minutes. At '+cigsPerDay+'/day, you\'re losing <strong>'+Math.round(cigsPerDay*11)+' minutes every single day</strong>. Total: '+yearsLostSmoking+' years.','color-red');
    h += card('$'+fmtE(smokingCostLife),'burned â€” literally. At $0.50/cigarette, that\'s $'+fmtE(Math.round(cigsPerDay*365*0.5))+'/year going up in smoke','color-pink');
    h += card(tarGrams+' grams','of tar deposited in your lungs â€” '+(tarGrams>100?'your lungs are carrying the weight of a small apple in tar':'building up with every cigarette'),'color-orange');
    h += card('$'+fmtE(Math.round(cigsPerDay*365*0.5*yrsLeft))+' more','you\'ll spend on cigarettes over the remaining '+yrsLeft+' years if you don\'t quit','color-red');
    h += src('ğŸ“Š Source: BMJ (11 min/cigarette), WHO tobacco, YOUR input: '+cigsPerDay+' cigs/day');
    h += '</div>';
  }

  // â”€â”€ ğŸ§¬ YOUR HEALTH AGE â”€â”€
  h += '<div class="category anim" style="animation-delay:1.015s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ§¬</span><span class="cat-title">Your Health Age</span></div>';
  const healthColor = healthDiff <= -3 ? 'color-green' : healthDiff <= 0 ? 'color-blue' : healthDiff <= 3 ? 'color-orange' : 'color-red';
  h += dnaCard(healthAge+' years old','your estimated biological age â€” '+(healthDiff<0?Math.abs(healthDiff)+' years <strong>younger</strong> than your actual age of '+age:'your body is '+healthDiff+' years <strong>older</strong> than your chronological age of '+age),healthColor);
  h += card('BMI: '+bmi.toFixed(1)+' ('+bmiCategory+')','at '+height+'cm and '+weight+'kg â€” '+(bmiCategory==='normal'?'right in the healthy range âœ…':bmiCategory==='overweight'?'slightly above optimal â€” exercise helps offset this':bmiCategory==='obese'?'significantly impacts health age â€” this is the biggest single factor you can change':'below optimal â€” gaining healthy weight would help'),'color-accent');
  h += card('Adjusted life expectancy: '+adjustedLifeExp,'based on your habits, you may '+(healthDiff<0?'live '+Math.abs(Math.round(healthDiff))+' years LONGER':'lose ~'+Math.round(healthDiff)+' years')+' vs the '+lifeExpSource+' average of '+lifeExp+' â€” that\'s '+(adjustedYrsLeft)+' years from now','color-pink');
  // Factor breakdown
  h += '<div class="cat-header" style="margin-top:16px;font-size:14px"><span class="cat-icon">ğŸ“‹</span><span class="cat-title" style="color:var(--muted)">What\'s Aging You (and What\'s Not)</span></div>';
  healthFactors.forEach(function(f) {
    const factorColor = f.impact < 0 ? 'color-green' : f.impact > 0 ? 'color-red' : 'color-blue';
    h += card(f.emoji+' '+(f.impact>0?'+':'')+f.impact+' years',f.factor,factorColor);
  });
  if (healthDiff < -2) h += card('ğŸ† Well done','your lifestyle is adding years to your life â€” keep it up','color-green');
  if (healthDiff > 3) h += card('âš ï¸ Room to improve','small changes (especially '+(smokingOffset>0?'quitting ('+cigsPerDay+' cigs/day)':exerciseOffset>0?'starting exercise':sleepOffset>0?'more sleep':'diet')+') could dramatically lower your health age','color-orange');
  h += src('âš ï¸ Disclaimer: this is a fun estimate, NOT medical advice. Based on population-level studies (Lancet, WHO, NIH, BMJ). Consult a doctor for real health assessments.');
  h += '</div>';

  // â”€â”€ CHRONOTYPE â”€â”€
  h += '<div class="category anim" style="animation-delay:1.02s">';
  h += '<div class="cat-header"><span class="cat-icon">'+chrono.emoji+'</span><span class="cat-title">Your Chronotype</span></div>';
  h += card(chrono.emoji+' '+chrono.label,'~'+chrono.pct+'% of people share your chronotype. Peak productivity: <strong>'+chrono.peakHrs+'</strong>','color-accent');
  h += card('ğŸ’¡',chrono.fact,'color-blue');
  h += card(fmtE(chrono.extraSunrises)+' sunrises','you\'ve probably actually witnessed ('+(chronotype==='early'?'way more than most!':'most people sleep through them')+')','color-orange');
  h += card(fmtE(lateNightHours)+' hours','spent awake past midnight','color-pink');
  h += src('ğŸ“Š Source: chronobiology research, circadian rhythm studies');
  h += '</div>';

  // â”€â”€ LIFE SKILLS â”€â”€
  h += '<div class="category anim" style="animation-delay:1.04s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ§°</span><span class="cat-title">Life Skills Scorecard</span></div>';

  // Count skills
  const skillsList = [
    canSwim==='yes', canDrive==='yes', canBike==='yes', cookLevel!=='no',
    instrument==='yes', cpr==='yes', education!=='none'&&education!=='school', passport==='yes'
  ];
  const skillCount = skillsList.filter(Boolean).length;
  const skillBar = 'ğŸŸ¢'.repeat(skillCount) + 'âš«'.repeat(8 - skillCount);
  h += card(skillBar+' '+skillCount+'/8 skills','unlocked. You\'re in the '+(skillCount>=7?'top 2%':skillCount>=5?'top 15%':skillCount>=3?'top 40%':'bottom 50%')+' of humans by skill diversity','color-accent');

  // Swimming
  h += card(canSwim==='yes'?'ğŸŠ Can swim âœ…':'ğŸŠ Can\'t swim âŒ',canSwim==='yes'?'You\'re in the '+canSwimPct+'% â€” '+(100-canSwimPct)+'% of the world cannot swim. Drowning is the 3rd leading cause of accidental death globally.':'You\'re among the '+(100-canSwimPct)+'% who can\'t â€” ~236,000 people drown every year. It\'s never too late to learn.',canSwim==='yes'?'color-green':'color-red');

  // Driving
  h += card(canDrive==='yes'?'ğŸš— Can drive âœ…':'ğŸš— Can\'t drive âŒ',canDrive==='yes'?'Only '+canDrivePct+'% of humans have a license. You\'ve driven ~'+fmtE(drivingKmLife)+' km ('+(drivingKmLife/40075).toFixed(1)+'Ã— around Earth) in '+fmtE(drivingHoursLife)+' hours.':'You\'re in the '+(100-canDrivePct)+'% majority â€” you\'ll save ~$'+fmtE(Math.round(yrsLeft*9000))+' over your lifetime by not owning a car.',canDrive==='yes'?'color-green':'color-orange');

  // Bicycle
  h += card(canBike==='yes'?'ğŸš² Can ride a bike âœ…':'ğŸš² Can\'t ride a bike âŒ',canBike==='yes'?'~'+canBikePct+'% of adults worldwide can ride. You\'ve cycled approximately '+fmtE(bikeKmLife)+' km in your life. A bike is the most energy-efficient vehicle ever invented.':'~'+(100-canBikePct)+'% of adults can\'t either â€” mostly due to never having access to one as a child. It only takes ~3 hours to learn as an adult.',canBike==='yes'?'color-green':'color-orange');

  // Cooking
  h += card('ğŸ³ Cooking: '+cook.label+(cookLevel!=='no'?' âœ…':' âŒ'),cook.fact+(cook.meals>0?' You\'ve cooked approximately '+fmtE(cook.meals)+' meals, saving ~$'+fmtE(takeoutSaved)+' vs eating out.':''),cookLevel!=='no'?'color-green':'color-orange');

  // Instrument
  h += card(instrument==='yes'?'ğŸ¸ Plays instrument âœ…':'ğŸ¸ No instrument âŒ',instrument==='yes'?'Only '+instrumentPct+'% of adults can play one. You\'ve practiced ~'+fmtE(practiceHoursEst)+' hours ('+(practiceHoursEst >= masteryThreshold ? 'ğŸ¯ past the 10,000-hour mastery threshold!' : Math.round(practiceHoursEst/masteryThreshold*100)+'% to the 10,000-hour "mastery" mark')+'). Musicians have 30% thicker nerve fibers connecting brain hemispheres.':'85% of adults can\'t play an instrument. Learning one at any age strengthens memory and slows cognitive decline.',instrument==='yes'?'color-green':'color-orange');

  // CPR
  h += card(cpr==='yes'?'ğŸ©º Knows CPR âœ…':'ğŸ©º No CPR training âŒ',cpr==='yes'?'Only '+cprPct+'% of the world knows CPR â€” you are literally a potential life-saver walking around. CPR doubles or triples cardiac arrest survival rates.':'97.5% of people don\'t know CPR either. In a cardiac arrest, every minute without CPR reduces survival by 10%. A 4-hour course could make you a life-saver.',cpr==='yes'?'color-green':'color-red');

  // Education
  h += card(edu.emoji+' '+edu.label+(education!=='none'?' âœ…':' âŒ'),'top '+edu.pct+'% globally. '+edu.fact,education!=='none'&&education!=='school'?'color-green':'color-orange');
  h += '<div class="fact-row">';
  h += cardS(fmtE(eduHoursInClassrooms)+'h','in classrooms','color-blue');
  h += cardS(fmtE(examsEstimate),'exams taken','color-pink');
  h += '</div>';
  h += '<div class="fact-row">';
  h += cardS(fmtE(homeworkHours)+'h','doing homework','color-orange');
  h += cardS(fmtE(booksForSchool),'textbooks used','color-cyan');
  h += '</div>';
  if (eduCost > 0) h += card('~$'+fmtE(eduCost),'estimated total cost of your education','color-accent');
  h += card(edu.earningMult+'Ã—','lifetime earning multiplier vs no education â€” education is the single biggest predictor of lifetime income','color-green');

  // Tattoo
  h += card(tat.count>0?'ğŸ–‹ï¸ '+tattoo+' tattoo'+(tat.count>1?'s':'')+' âœ…':'ğŸ–‹ï¸ No tattoos',tat.fact,tat.count>0?'color-accent':'color-orange');
  if (tat.count > 0) {
    h += card(fmtE(tattooPricks)+' needle pricks','your skin endured (~150 pricks per second Ã— ~90 min per tattoo)','color-red');
    h += card(tattooInkMl+' ml','of ink permanently embedded under your skin','color-pink');
    h += card(fmtE(tattooPain)+' minutes','of voluntary pain â€” and you chose to do it','color-orange');
  }

  // Passport / travel
  h += card(passport==='yes'?'ğŸ›‚ Has passport âœ…':'ğŸ›‚ No passport âŒ',passport==='yes'?'Only ~'+passportPct+'% of the world\'s population has ever boarded a plane. You\'ve taken ~'+fmtE(avgFlights)+' flights covering ~'+fmtE(flightKm)+' km, visiting an estimated '+countriesVisited+' countries (out of 195). Your flights produced ~'+flightCO2+' tons of COâ‚‚.':'~85% of humans have never been on a plane. International travel is one of the biggest privileges that people take for granted.',passport==='yes'?'color-green':'color-orange');

  // Broken bone
  h += card(brokenBone==='yes'?'ğŸ¦´ Broken a bone âœ…':'ğŸ¦´ Never broken a bone ğŸ’ª',brokenBone==='yes'?'You\'re in the ~'+brokenBonePct+'%. You have '+totalBones+' bones â€” breaking one actually makes it stronger at the fracture site due to extra calcium deposits.':'You\'re in the lucky '+(100-brokenBonePct)+'% who\'ve kept all '+totalBones+' bones intact. Your skeleton completely rebuilds itself every ~10 years anyway.',brokenBone==='yes'?'color-orange':'color-green');

  // Blood donation
  h += card(donatedBlood==='yes'?'ğŸ©¸ Blood donor âœ…':'ğŸ©¸ Never donated âŒ',donatedBlood==='yes'?'Only '+donationPct+'% of eligible people donate. Each donation saves up to '+livesPerDonation+' lives. If you\'ve donated regularly, you may have saved dozens of people â€” most of whom you\'ll never meet.':'97% of eligible people never donate either. One donation takes ~1 hour and saves up to 3 lives. You have ~5 liters of blood and your body replaces the donated amount within 24-48 hours.',donatedBlood==='yes'?'color-green':'color-red');

  h += src('ğŸ“Š Source: WHO, Red Cross, cycling federation data, Gladwell 10k-hour rule, typing speed research');
  h += '</div>';

  // â”€â”€ FAMILY â”€â”€
  h += '<div class="category anim" style="animation-delay:.5s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</span><span class="cat-title">Your Family</span></div>';

  // Family overview
  h += card('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family of '+familySize, allAges.map(a => a.who + ' (' + a.age + ')').join(' Â· '), 'color-accent');
  h += card(fmtE(familyTotalYears)+' years','your family has been alive combined â€” that\'s '+fmtE(familyTotalHeartbeats)+' total heartbeats across all members','color-pink');

  // Parents status
  h += card(parentInfo.emoji+' '+parentInfo.label+' â€” '+parentInfo.pct+'%',parentInfo.fact,'color-blue');

  // Mother
  if (momAge > 0) {
    const momAgeLabel = momAlive === 'alive' ? 'ğŸ‘© Mom is '+momAge+' â€” she was '+momHadYouAt+' when you were born' : 'ğŸ•Šï¸ Mom was '+momHadYouAt+' when you were born (age '+momAge+' at passing)';
    h += card(momAgeLabel, momAgeBracketPct > 0 ? momAgeBracketPct+'% of mothers have their child at age '+momAgeBracket+'. '+(momHadYouAt<=19?'Teen motherhood â€” only 11% of births globally. She gave up a huge part of her youth for you.':momHadYouAt>=35?'She was in the '+(100-momAgeBracketPct)+'th percentile â€” later motherhood is increasingly common but was rare a generation ago.':momHadYouAt>=25&&momHadYouAt<=29?'The most common age bracket globally â€” peak fertility meets life stability.':'') : '','color-green');
    if (momAlive === 'alive' && age > 18) {
      h += card('â³ ~'+fmtE(momHoursLeft)+' hours','estimated quality time left with your mom (~200 hrs/year as an adult). That\'s only '+Math.round(momHoursLeft/24)+' full days. <strong>Call her.</strong>','color-red');
    }
    if (momAlive === 'passed') {
      const momYearsWithYou = Math.min(momAge, age);
      h += card('ğŸ’š '+momYearsWithYou+' years','you had together. That\'s approximately '+fmtE(momYearsWithYou*365*8)+' hours of shared life â€” every one of them mattered.','color-blue');
    }
  }

  // Father
  if (dadAge > 0) {
    const dadAgeLabel = dadAlive === 'alive' ? 'ğŸ‘¨ Dad is '+dadAge+' â€” he was '+dadHadYouAt+' when you were born' : 'ğŸ•Šï¸ Dad was '+dadHadYouAt+' when you were born (age '+dadAge+' at passing)';
    h += card(dadAgeLabel, dadAgeBracketPct > 0 ? dadAgeBracketPct+'% of fathers have a child at age '+dadAgeBracket+'. '+(dadHadYouAt>=40?'Only 10% of dads are 40+ â€” he had more life experience to share with you.':dadHadYouAt<=24?'Young dad â€” only 18% of fathers are under 25. He grew up alongside you.':'The most common age range for fatherhood.') : '','color-green');
    if (dadAlive === 'alive' && age > 18) {
      h += card('â³ ~'+fmtE(dadHoursLeft)+' hours','estimated quality time left with your dad (~200 hrs/year). That\'s '+Math.round(dadHoursLeft/24)+' full days. <strong>Make them count.</strong>','color-red');
    }
    if (dadAlive === 'passed') {
      const dadYearsWithYou = Math.min(dadAge, age);
      h += card('ğŸ’š '+dadYearsWithYou+' years','you had together. ~'+fmtE(dadYearsWithYou*365*8)+' hours of shared life. He shaped who you are.','color-blue');
    }
  }

  // Both parents alive/lost stat
  if (momAlive === 'alive' && dadAlive === 'alive') {
    h += card('ğŸ’š Both parents alive','at age '+age+', approximately '+bothAliveAtAgePct+'% of people still have both parents. '+(bothAliveAtAgePct<50?'You\'re among the lucky minority â€” cherish every moment.':'Don\'t take it for granted.'),'color-green');
  } else if (momAlive === 'passed' && dadAlive === 'passed') {
    h += card('ğŸ•Šï¸ Both parents gone','only ~'+(100-bothAliveAtAgePct)+'% of people your age have lost both parents. The strength it takes to keep going is immeasurable.','color-blue');
  } else if (momAlive === 'passed' || dadAlive === 'passed') {
    h += card('ğŸ•Šï¸ Lost '+(momAlive==='passed'?'your mother':'your father'),'approximately '+(age<40?'12':'25-40')+'% of people your age have lost a parent. Grief never fully leaves â€” it just becomes part of who you are.','color-blue');
  }

  // Parent age difference
  if (parentAgeDiff > 0) {
    h += card(parentAgeDiff+' year gap','between your parents â€” '+parentGapPct+'% of couples have this exact age difference. '+(parentAgeDiff<=2?'Almost the same age â€” they grew up in the same era, same music, same memories.':parentAgeDiff<=5?'A common gap â€” close enough to share generational references.':parentAgeDiff<=10?'A noticeable gap â€” they grew up with different music, different presidents, different world events.':'A large gap â€” they essentially grew up in different eras. '+Math.max(momAge,dadAge)+' vs '+Math.min(momAge,dadAge)+' means one was '+(parentAgeDiff)+' when the other was born.'),'color-orange');
  }

  // Siblings
  h += card(siblings===0?'Only child ğŸ‘¤':siblings+' sibling'+(siblings>1?'s':'')+' '+siblingAges.map(a=>('('+a+')')).join(' '),sibPct+'% of people globally have '+siblings+' sibling'+(siblings!==1?'s':'')+(siblings===0?'. Only children tend to have higher IQs on average but report more loneliness.':''),'color-accent');

  // Sibling age gaps
  if (siblingAges.length > 0) {
    siblingAges.forEach((sa, i) => {
      const gap = Math.abs(age - sa);
      const older = sa > age;
      const gapPct = sibGapPcts[gap] || (gap > 8 ? 3 : 5);
      let gapFact = '';
      if (gap <= 1) gapFact = 'Irish twins! Less than 2 years apart â€” you probably shared everything: clothes, friends, fights.';
      else if (gap <= 2) gapFact = 'Classic close-gap siblings â€” intense rivalry as kids, best friends as adults.';
      else if (gap <= 4) gapFact = 'The sweet spot â€” close enough to play together, far enough to have your own identity.';
      else if (gap <= 7) gapFact = 'Different school eras â€” by the time one starts, the other\'s already a veteran.';
      else if (gap <= 12) gapFact = 'Almost a generation apart â€” one was in diapers while the other was a teenager.';
      else gapFact = 'A huge gap â€” you grew up in completely different worlds. One was basically a second parent.';

      const sibLabel = siblings===1 ? 'Sibling' : 'Sibling '+(i+1);
      h += card((older?'ğŸ‘† ':'ğŸ‘‡ ')+sibLabel+': '+gap+' year'+(gap!==1?'s':'')+' '+(older?'older':'younger'),gapPct+'% of siblings have a '+gap+'-year gap. '+gapFact,'color-cyan');
    });

    // Birth order
    const allKidsAges = [age, ...siblingAges].sort((a,b) => b-a);
    const birthOrder = allKidsAges.indexOf(age) + 1;
    const birthOrderLabel = birthOrder === 1 ? 'Oldest child' : birthOrder === allKidsAges.length ? 'Youngest child' : 'Middle child';
    const birthOrderFacts = {
      'Oldest child': 'Firstborns are overrepresented among CEOs, presidents, and astronauts. They tend to be more responsible and achievement-oriented.',
      'Youngest child': 'Last-borns are more likely to be risk-takers, comedians, and entrepreneurs. They learned to get attention by being charming.',
      'Middle child': 'Middle children are the best negotiators â€” caught between siblings, they became diplomats. They\'re also the most independent and loyal friends.',
    };
    h += card('ğŸ‘‘ '+birthOrderLabel+' (#'+birthOrder+' of '+(siblings+1)+')',birthOrderFacts[birthOrderLabel] || 'Birth order shapes personality more than most people realize.','color-pink');

    if(siblings>0) h += card(fmtE(Math.round(siblings*3.5*365)),'estimated arguments with your sibling'+(siblings>1?'s':'')+' during childhood (~3.5 per day)','color-orange');
  }

  h += src('ğŸ“Š Source: UN fertility data (maternal age brackets), birth order research (Sulloway, 1996), sibling gap demographics');
  h += '</div>';

  // â”€â”€ âš¡ YOUR CONTRADICTIONS â”€â”€
  if (contradictions.length > 0) {
    h += '<div class="category anim" style="animation-delay:.53s">';
    h += '<div class="cat-header"><span class="cat-icon">âš¡</span><span class="cat-title">Your Contradictions</span></div>';
    h += card(contradictions.length+' contradiction'+(contradictions.length>1?'s':''),'we found in your inputs â€” because humans are beautifully inconsistent','color-accent');
    contradictions.forEach(function(c) {
      h += card(c.emoji+' '+c.title, c.desc, 'color-orange');
    });
    h += src('ğŸ“Š Source: YOUR inputs cross-referenced against each other');
    h += '</div>';
  }

  // â”€â”€ WHAT'S LEFT â”€â”€
  h += '<div class="category anim" style="animation-delay:.55s">';
  h += '<div class="cat-header"><span class="cat-icon">ğŸ’€</span><span class="cat-title">What\'s Left</span></div>';
  h += card(pctLived+'%','of your statistical life is behind you','color-red');
  h += '<div class="fact-row">';
  h += cardS(fmtE(fridaysLeft),'Fridays left','color-pink');
  h += cardS(yrsLeft.toString(),'summers left','color-orange');
  h += '</div>';
  h += card(fmtE(yrsLeft*365),'sunrises remaining','color-accent');
  h += card(fmt(heartbeatsLeft),'heartbeats remaining','color-red');
  h += src('ğŸ“Š Source: life expectancy '+lifeExp+' years ('+(countryLE?'World Bank API, '+lifeExpSource:'global average')+', '+(gender==='male'?'male':'female')+')');
  h += '</div>';

  // â”€â”€ SHARE CARD â”€â”€
  h += '<div class="share-card anim" style="animation-delay:.6s">';
  h += '<div class="share-name">'+name+'</div>';
  h += '<div class="share-sub">COUNTED</div>';
  h += '<div class="share-stats">';
  h += '<div class="share-stat"><div class="share-stat-num">'+fmt(heartbeats)+'</div><div class="share-stat-label">Heartbeats</div></div>';
  h += '<div class="share-stat"><div class="share-stat-num">'+fmtE(fridaysLeft)+'</div><div class="share-stat-label">Fridays Left</div></div>';
  h += '<div class="share-stat"><div class="share-stat-num">'+plutoTrips+'Ã—</div><div class="share-stat-label">DNAâ†’Pluto</div></div>';
  h += '<div class="share-stat"><div class="share-stat-num">'+marsAge+'</div><div class="share-stat-label">Yrs on Mars</div></div>';
  h += '</div>';
  h += '<div class="share-quote">"'+name+' is '+uniqueStr+'% unique, with '+fmtE(fridaysLeft)+' Fridays left and enough DNA to reach Pluto '+plutoTrips+' times."</div>';
  h += '</div>';

  h += '<div style="margin-top:32px;padding:16px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06)">';
  h += '<p style="color:var(--muted);font-size:11px;line-height:1.6;margin:0;text-align:center">';
  h += 'âš ï¸ <strong>Disclaimer:</strong> COUNTED is for entertainment and educational purposes only. All statistics are estimates based on population averages and publicly available research. ';
  h += 'The "Health Age" section is NOT medical advice â€” consult a healthcare professional for real assessments. ';
  h += 'Name rarity estimates depend on third-party APIs and may be inaccurate for some names. ';
  h += 'No personal data is sent to our servers â€” all processing happens in your browser.';
  h += '</p></div>';

  h += '<button class="reset-btn" onclick="reset()">âš¡ Count Someone Else</button>';

  document.getElementById('results-container').innerHTML = h;
  show('screen-results');
  } catch(err) {
    show('screen-form');
    document.getElementById('form-error').textContent='âš ï¸ Error: '+err.message;
    document.getElementById('form-error').style.display='block';
  }
}

function clearCache() {
  // Clear memory cache
  Object.keys(memoryCache).forEach(k => delete memoryCache[k]);
  // Clear localStorage cache
  try {
    Object.keys(localStorage).filter(k => k.startsWith('counted_')).forEach(k => localStorage.removeItem(k));
  } catch(e) {}
  // Visual feedback
  const btn = event.target;
  btn.textContent = 'âœ“ CACHE CLEARED';
  setTimeout(() => { btn.textContent = 'CLEAR CACHE'; }, 2000);
}

function reset(){show('screen-form')}
</script>
</body>
</html>
